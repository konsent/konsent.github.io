<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>íƒœì–‘ì˜ ì œêµ­ - ì¼ë³¸êµ° Erasmus (í†µí•©)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#1f1f1f; --nav:#2a2a2a; --text:#e8e8e8; }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); color:var(--text); font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    header { padding:14px 18px; background:var(--nav); border-bottom:1px solid #3a3a3a; }
    header h1 { margin:0; font-size:18px; }
    nav { display:flex; gap:8px; padding:10px 12px; background:#242424; border-bottom:1px solid #3a3a3a; flex-wrap:wrap; }
    nav button {
      padding:8px 12px; border:1px solid #3a3a3a; background:#303030; color:var(--text);
      border-radius:8px; cursor:pointer; font-size:14px;
    }
    nav button.active { background:#3d5a98; border-color:#3d5a98; }
    .viewport { height: calc(100vh - 112px); /* header+nav+footer ì—¬ìœ  */ }
    .frame { display:none; width:100%; height:100%; border:0; background:#111; }
    .frame.active { display:block; }
    footer { padding:8px 12px; background:#242424; border-top:1px solid #3a3a3a; font-size:12px; color:#bbb; }

    #calculator-btn {
        transition: transform 0.2s, background 0.2s !important;
        background: linear-gradient(145deg, #ff9500, #e87b00) !important;
        border: none !important;
        outline: none !important;
    }

    #calculator-btn:hover {
        background: linear-gradient(145deg, #e87b00, #cc6b00) !important;
        transform: translateY(-2px) scale(1.08) !important;
    }

    #calc-display {
        border-radius: 8px !important;
        transition: background 0.2s !important;
        background: #1c2526 !important;
        border: none !important;
        outline: none !important;
    }

    #calc-history li {
        background: #2e2e2e !important;
        padding: 6px !important;
        margin: 4px 0 !important;
        border-radius: 4px !important;
        color: #ffffff !important;
        font-size: 11px !important;
    }

    /* ê³„ì‚°ê¸° ë²„íŠ¼ ì „ìš© ìŠ¤íƒ€ì¼ (í…ìŠ¤íŠ¸ ì¤‘ì•™ ì •ë ¬, iOS ìŠ¤íƒ€ì¼) */
    #calculator-modal > div > button.calc-btn {
        padding: 12px !important;
        font-size: 16px !important;
        border-radius: 50% !important; /* ì›í˜• ë²„íŠ¼ */
        cursor: pointer !important;
        width: 100% !important;
        aspect-ratio: 1 / 1 !important; /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ */
        box-sizing: border-box !important;
        text-align: center !important;
        line-height: 1.2 !important;
        min-height: 54px !important; /* ë²„íŠ¼ í¬ê¸° */
        max-width: 54px !important; /* ë²„íŠ¼ ë„ˆë¹„ ì œí•œ */
        margin: 0 auto !important; /* ì¤‘ì•™ ì •ë ¬ */
        display: flex !important; /* í…ìŠ¤íŠ¸ ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
        align-items: center !important;
        justify-content: center !important;
        transition: transform 0.1s, background 0.1s !important;
        font-family: -apple-system, sans-serif !important;
        font-weight: 500 !important;
        border: none !important;
        outline: none !important;
        background: none !important; /* ì™¸ë¶€ ë°°ê²½ ì´ˆê¸°í™” */
    }

    #calculator-modal > div > button.calc-btn:hover {
        transform: scale(1.12) !important;
    }

    #calculator-modal > div > button.calc-btn-number {
        background: linear-gradient(145deg, #333333, #2b2b2b) !important; /* ìˆ«ì ë²„íŠ¼: iOS ë‹¤í¬ íšŒìƒ‰ */
        color: #ffffff !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.4) !important;
    }

    #calculator-modal > div > button.calc-btn-number:hover {
        background: linear-gradient(145deg, #2b2b2b, #232323) !important;
    }

    #calculator-modal > div > button.calc-btn-primary {
        background: linear-gradient(145deg, #ff6200, #d45200) !important; /* ê³±ì…ˆ ë²„íŠ¼: iOS ì§„í•œ ì˜¤ë Œì§€ */
        color: #ffffff !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.4) !important;
    }

    #calculator-modal > div > button.calc-btn-primary:hover {
        background: linear-gradient(145deg, #d45200, #b44600) !important;
    }

    #calculator-modal > div > button.calc-btn-secondary {
        background: linear-gradient(145deg, #d4d4d2, #bcbcbc) !important; /* ê¸°ëŠ¥ ë²„íŠ¼: iOS ë°ì€ íšŒìƒ‰ */
        color: #000000 !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.4) !important;
    }

    #calculator-modal > div > button.calc-btn-secondary:hover {
        background: linear-gradient(145deg, #bcbcbc, #a4a4a4) !important;
    }

    #calculator-modal > div > button.calc-btn-operator {
        background: linear-gradient(145deg, #ff9500, #e87b00) !important; /* ì—°ì‚° ë²„íŠ¼: iOS ì˜¤ë Œì§€ */
        color: #ffffff !important;
        box-shadow: 0 4px 8px rgba(0,0,0,0.4) !important;
    }

    #calculator-modal > div > button.calc-btn-operator:hover {
        background: linear-gradient(145deg, #e87b00, #cc6b00) !important;
    }

    /* ì¶”ê°€: í† ê¸€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #history-toggle {
        transition: transform 0.2s !important;
    }

    #history-toggle.open {
        transform: rotate(180deg) !important;
    }

    /* ì¶”ê°€: ë“œë˜ê·¸ ì•¤ ë“œë¡­ ìŠ¤íƒ€ì¼ */
    #allied-text, #japanese-text {
        border: 1px dashed #fff;
        min-height: 60px;
        padding: 2px;
        border-radius: 4px;
        color: white;
        text-align: center;
        font-size: 20px;
    }




    #dice-btn {
        transition: transform 0.2s, background 0.2s !important;
        background: linear-gradient(145deg, #28a745, #218838) !important;
        border: none !important;
        outline: none !important;
    }

    #dice-btn:hover {
        background: linear-gradient(145deg, #218838, #1c6d32) !important;
        transform: translateY(-2px) scale(1.08) !important;
    }

    .dice-btn {
        position: relative;
        overflow: hidden;
    }

    .dice-btn.spin {
        animation: spin 0.7s ease-in-out !important;
        background: linear-gradient(145deg, #f8f9fa, #dee2e6) !important;
    }

    @keyframes spin {
        0% { transform: rotateY(0deg) scale(1); opacity: 1; }
        50% { transform: rotateY(180deg) scale(1.1); opacity: 0.8; }
        100% { transform: rotateY(360deg) scale(1); opacity: 1; }
    }




    .impl-note {
            font-style: italic;
            font-size: 14px;
            color: #ffffff;
            line-height: 1.6;
            margin: 4px 0;
        }
    
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #3c3c3c;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
    
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #4a4a4a;
            border-radius: 8px;
            color: #ffffff;
            border: 1px solid #5c5c5c;
        }
    
        .header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
        }
    
        .header p {
            margin: 8px 0 0 0;
            font-size: 1rem;
            font-weight: 400;
        }
    
        .progress-bar {
            background: #4a4a4a;
            border-radius: 5px;
            height: 6px;
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid #5c5c5c;
        }
    
        .progress-fill {
            background: #4682b4;
            height: 100%;
            border-radius: 5px;
            transition: width 0.3s ease;
            width: 0%;
        }
    
        .step-section {
            background: #3c3c3c;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #5c5c5c;
        }
    
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
    
        .step-number {
            background: #4682b4;
            color: #ffffff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            margin-right: 15px;
        }
    
        .step-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #d8d8d8;
            margin: 0;
        }
    
        .condition-box {
            background: #4a4a4a;
            border-left: 4px solid #4682b4;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-size: 1rem;
            line-height: 1.5;
            color: #c8c8c8;
        }
    
        .condition-box strong {
            color: #4682b4;
            font-size: 1.1rem;
        }
    
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
    
        .btn {
            padding: 10px 30px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.1s ease;
            text-transform: uppercase;
            min-width: 100px;
            font-family: 'Georgia', 'Times New Roman', Times, serif;
        }
    
        .btn-yes {
            background: #2e8b57;
            color: #ffffff;
        }
    
        .btn-yes:hover {
            background: #257a4b;
            transform: translateY(-2px);
        }
    
        .btn-no {
            background: #696969;
            color: #ffffff;
        }
    
        .btn-no:hover {
            background: #585858;
            transform: translateY(-2px);
        }
    
        .btn-primary {
            background: #4682b4;
            color: #ffffff;
        }
    
        .btn-primary:hover {
            background: #3a6b9a;
            transform: translateY(-2px);
        }
    
        .btn-secondary {
            background: #5c5c5c;
            color: #ffffff;
        }
    
        .btn-secondary:hover {
            background: #4b4b4b;
            transform: translateY(-2px);
        }
    
        .btn-back {
            background: #5c5c5c;
            color: #ffffff;
        }
    
        .btn-back:hover {
            background: #4b4b4b;
            transform: translateY(-2px);
        }
    
        .path-history {
            background: #4a4a4a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid #2e8b57;
        }
    
        .path-step {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: #3c3c3c;
            border-radius: 5px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
    
        .path-step .step-icon {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.8rem;
        }
    
        .path-step.yes .step-icon {
            background: #2e8b57;
            color: #ffffff;
        }
    
        .path-step.no .step-icon {
            background: #696969;
            color: #ffffff;
        }
    
        .dice-section {
            background: #4a4a4a;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            border: 1px solid #5c5c5c;
        }
    
        .dice-result {
            font-size: 3rem;
            font-weight: bold;
            color: #d8d8d8;
            margin: 15px 0;
        }
    
        .result-section {
            background: #2e8b57;
            color: #ffffff;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-top: 15px;
            border: 1px solid #3c3c3c;
        }
    
        .result-section h2 {
            margin: 0 0 15px 0;
            font-size: 2rem;
            display: none;
        }
    
        .result-section p {
            margin: 10px 0;
            font-size: 32px;
            white-space: pre-line;
            font-weight: bold;
            font-style: italic;
        }
    
        .strategy-details {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
        }
    
        .strategy-list {
            text-align: left;
            margin: 15px 0;
            list-style: none;
            padding: 0;
        }
    
        .strategy-list li {
            margin: 8px 0;
            padding: 8px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }
    
        .sub-priority-list {
            list-style: none;
            padding-left: 20px;
            margin-top: 5px;
        }
    
        .sub-priority-list li {
            margin: 5px 0;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            border-left: 2px solid rgba(255, 255, 255, 0.4);
            font-size: 0.9rem;
        }
    
        .hidden {
            display: none;
        }
    
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 180px;
            }
            
        }
    </style>
  </style>
</head>
<body>
  <header><h1>íƒœì–‘ì˜ ì œêµ­ Erasmus</h1></header>

  <nav id="tabs">
    <button data-target="early" class="active">ì „ìŸ ì´ˆê¸°</button>
    <button data-target="mid">ì „ìŸ ì¤‘ê¸°</button>
    <button data-target="late">ì „ìŸ ë§ê¸°</button>
    <button data-target="card">ì¹´ë“œ ì„ íƒ</button>
    <button data-target="task">íƒœìŠ¤í¬ í¬ìŠ¤ êµ¬ì„±</button>
    <button data-target="resp">ëŒ€ì‘</button>
    <button data-target="pbm">PBM</button>
    <button data-target="offensive">ê³µì„¸ ì ˆì°¨</button>
  </nav>

  <div class="viewport">
    <!-- ê° í˜ì´ì§€ë¥¼ ê²©ë¦¬í•  iframeë“¤ -->
    <iframe id="frame-early" class="frame active"></iframe>
    <iframe id="frame-mid"   class="frame"></iframe>
    <iframe id="frame-late"  class="frame"></iframe>
    <iframe id="frame-card"  class="frame"></iframe>
    <iframe id="frame-task"  class="frame"></iframe>
    <iframe id="frame-resp"  class="frame"></iframe>
    <iframe id="frame-pbm"   class="frame"></iframe>
    <iframe id="frame-offensive"   class="frame"></iframe>
  </div>

  <!-- ê³„ì‚°ê¸° -->

  <div id="calculator-btn" style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: linear-gradient(145deg, #ff9500, #e87b00); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; z-index: 1000; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: transform 0.2s, background 0.2s;">+</div>

    <div id="calculator-modal" style="position: fixed; bottom: 90px; right: 20px; width: 390px; background: linear-gradient(145deg, #1c2526, #2e2e2e); border-radius: 16px; padding: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); display: none; z-index: 1000; box-sizing: border-box;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
            <div id="allied-box" style="width: 48%; background: #4682b4; border-radius: 8px; padding: 15px; color: white; position: relative;">
                <span style="font-weight: bold;">ì—°í•©êµ°</span>
                <div id="allied-text" style="margin-top: 5px; background: rgba(255,255,255,0.1); padding: 5px; border-radius: 4px; min-height: 30px; word-wrap: break-word;"></div>
                <button onclick="clearBox('allied-text')" style="position: absolute; top: 5px; right: 5px; background: none; border: none; color: white; font-size: 12px; cursor: pointer;">X</button>
            </div>
            <div id="japanese-box" style="width: 48%; background: #dc3545; border-radius: 8px; padding: 15px; color: white; position: relative;">
                <span style="font-weight: bold;">ì¼ë³¸êµ°</span>
                <div id="japanese-text" style="margin-top: 5px; background: rgba(255,255,255,0.1); padding: 5px; border-radius: 4px; min-height: 30px; word-wrap: break-word;"></div>
                <button onclick="clearBox('japanese-text')" style="position: absolute; top: 5px; right: 5px; background: none; border: none; color: white; font-size: 12px; cursor: pointer;">X</button>
            </div>
        </div>
        <div style="margin-bottom: 12px; display: flex; align-items: center;">
            <button id="history-toggle" style="background: none; border: none; color: white; cursor: pointer; font-size: 18px; margin-right: 10px;">â–¼</button>
            <h4 style="color: #ffffff; font-size: 15px; margin: 0; font-weight: 600; font-family: -apple-system, sans-serif;">ì´ì „ ê¸°ë¡ (ìµœëŒ€ 10ê°œ)</h4>
        </div>
        <ul id="calc-history" style="list-style: none; padding: 0; max-height: 80px; overflow-y: auto; font-size: 12px; font-family: -apple-system, sans-serif; display: none;"></ul>
        <div style="margin-bottom: 12px;">
            <input type="text" id="calc-display" style="width: 100%; padding: 16px; background: #1c2526; border: none; color: #ffffff; font-size: 40px; text-align: right; border-radius: 8px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3); font-family: -apple-system, sans-serif;" readonly draggable="true" ondragstart="dragStart(event)">
        </div>
        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; width: 100%; box-sizing: border-box;">
            <button class="calc-btn calc-btn-primary" onclick="multiply(0.25)">*0.25</button>
            <button class="calc-btn calc-btn-primary" onclick="multiply(0.5)">*0.5</button>
            <button class="calc-btn calc-btn-primary" onclick="multiply(1)">*1</button>
            <button class="calc-btn calc-btn-primary" onclick="multiply(1.5)">*1.5</button>
            <button class="calc-btn calc-btn-primary" onclick="multiply(2)">*2</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('7')">7</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('8')">8</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('9')">9</button>
            <button class="calc-btn calc-btn-secondary" onclick="clearDisplay()">C</button>
            <button class="calc-btn calc-btn-secondary" onclick="backspace()">â†</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('4')">4</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('5')">5</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('6')">6</button>
            <button class="calc-btn calc-btn-operator" onclick="appendToDisplay('+')">+</button>
            <button class="calc-btn calc-btn-operator" onclick="calculate()">=</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('1')">1</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('2')">2</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('3')">3</button>
            <button class="calc-btn calc-btn-number" onclick="appendToDisplay('0')">0</button>
            <button class="calc-btn calc-btn-number" style="visibility: hidden;"></button> <!-- ë¹ˆ ê³µê°„ ì±„ìš°ê¸° -->
        </div>
    </div>


    <!-- ì£¼ì‚¬ìœ„ -->

    <!-- ì¶”ê°€: ì£¼ì‚¬ìœ„ í”Œë¡œíŒ… ë²„íŠ¼ -->
    <div id="dice-btn" style="position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px; background: linear-gradient(145deg, #28a745, #218838); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-size: 28px; z-index: 1000; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: transform 0.2s, background 0.2s;">ğŸ²</div>

    <!-- ì¶”ê°€: ì£¼ì‚¬ìœ„ ëª¨ë‹¬ -->
    <div id="dice-modal" style="position: fixed; bottom: 160px; right: 20px; width: 120px; background: linear-gradient(145deg, #1c2526, #2e2e2e); border-radius: 16px; padding: 15px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); display: none; z-index: 1000; box-sizing: border-box;">
        <div style="display: flex; flex-direction: column; gap: 15px;">
            <div style="text-align: center;">
                <h4 style="color: #ffffff; font-size: 20px; margin: 0 0 8px 0; font-weight: 600; font-family: -apple-system, sans-serif;">ì£¼ì‚¬ìœ„</h4>
                <button id="dice1" class="dice-btn" onclick="rollDice('dice1', 'dice1-result')" style="width: 100px; height: 100px; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 40px; background: linear-gradient(145deg, #4682b4, #008cff); color: #ffffff; border-radius: 12px; cursor: pointer; transition: transform 0.7s, background 0.7s; box-shadow: 0 4px 8px rgba(0,0,0,0.3); font-family: -apple-system, sans-serif;">?</button>
                <!-- <div id="dice1-result" style="color: #ffffff; font-size: 18px; margin-top: 10px;"></div> -->
            </div>
            <div style="text-align: center;">
                <!-- <h4 style="color: #ffffff; font-size: 15px; margin: 0 0 8px 0; font-weight: 600; font-family: -apple-system, sans-serif;">ì£¼ì‚¬ìœ„ 2</h4> -->
                <button id="dice2" class="dice-btn" onclick="rollDice('dice2', 'dice2-result')" style="width: 100px; height: 100px; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 40px; background: linear-gradient(145deg, #dc3545, #ff0019); color: #ffffff; border-radius: 12px; cursor: pointer; transition: transform 0.7s, background 0.7s; box-shadow: 0 4px 8px rgba(0,0,0,0.3); font-family: -apple-system, sans-serif;">?</button>
                <!-- <div id="dice2-result" style="color: #ffffff; font-size: 18px; margin-top: 10px;"></div> -->
            </div>
        </div>
    </div>


  <footer>ì´ë ‡ê²Œê¹Œì§€ ë§Œë“¤ì—ˆìœ¼ë‹ˆ ì˜¬í•´ëŠ” ê¼­ íƒœì œ 10íŒ ëŒë¦°ë‹¤</footer>

  <template id="tmpl-early">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Japanese Erasmus Bot - ì „ìŸ ì´ˆê¸°</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #2e2e2e;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
                color: #d8d8d8;
                }
            
                .impl-note {
                    font-style: italic;
                    font-size: 14px;
                    color: #ffffff;
                    line-height: 1.6;
                    margin: 4px 0;
                }
            
                .container {
                    max-width: 800px;
                    margin: 0 auto;
                    background: #3c3c3c;
                    border-radius: 8px;
                    padding: 20px;
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
                }
            
                .header {
                    text-align: center;
                    margin-bottom: 20px;
                    padding: 15px;
                    background: #4a4a4a;
                    border-radius: 8px;
                    color: #ffffff;
                    border: 1px solid #5c5c5c;
                }
            
                .header h1 {
                    margin: 0;
                    font-size: 2rem;
                    font-weight: 700;
                }
            
                .header p {
                    margin: 8px 0 0 0;
                    font-size: 1rem;
                    font-weight: 400;
                }
            
                .progress-bar {
                    background: #4a4a4a;
                    border-radius: 5px;
                    height: 6px;
                    margin-bottom: 20px;
                    overflow: hidden;
                    border: 1px solid #5c5c5c;
                }
            
                .progress-fill {
                    background: #4682b4;
                    height: 100%;
                    border-radius: 5px;
                    transition: width 0.3s ease;
                    width: 0%;
                }
            
                .step-section {
                    background: #3c3c3c;
                    border-radius: 8px;
                    padding: 20px;
                    margin-bottom: 15px;
                    border: 1px solid #5c5c5c;
                }
            
                .step-header {
                    display: flex;
                    align-items: center;
                    margin-bottom: 15px;
                }
            
                .step-number {
                    background: #4682b4;
                    color: #ffffff;
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                    font-size: 1rem;
                    margin-right: 15px;
                }
            
                .step-title {
                    font-size: 1.3rem;
                    font-weight: 600;
                    color: #d8d8d8;
                    margin: 0;
                }
            
                .condition-box {
                    background: #4a4a4a;
                    border-left: 4px solid #4682b4;
                    border-radius: 5px;
                    padding: 15px;
                    margin: 15px 0;
                    font-size: 1rem;
                    line-height: 1.5;
                    color: #c8c8c8;
                }
            
                .condition-box strong {
                    color: #4682b4;
                    font-size: 1.1rem;
                }
            
                .button-group {
                    display: flex;
                    gap: 15px;
                    justify-content: center;
                    margin-top: 20px;
                }
            
                .btn {
                    padding: 10px 30px;
                    border: none;
                    border-radius: 5px;
                    font-size: 1rem;
                    font-weight: 500;
                    cursor: pointer;
                    transition: background 0.2s ease, transform 0.1s ease;
                    text-transform: uppercase;
                    min-width: 100px;
                    font-family: 'Georgia', 'Times New Roman', Times, serif;
                }
            
                .btn-yes {
                    background: #2e8b57;
                    color: #ffffff;
                }
            
                .btn-yes:hover {
                    background: #257a4b;
                    transform: translateY(-2px);
                }
            
                .btn-no {
                    background: #696969;
                    color: #ffffff;
                }
            
                .btn-no:hover {
                    background: #585858;
                    transform: translateY(-2px);
                }
            
                .btn-primary {
                    background: #4682b4;
                    color: #ffffff;
                }
            
                .btn-primary:hover {
                    background: #3a6b9a;
                    transform: translateY(-2px);
                }
            
                .btn-secondary {
                    background: #5c5c5c;
                    color: #ffffff;
                }
            
                .btn-secondary:hover {
                    background: #4b4b4b;
                    transform: translateY(-2px);
                }
            
                .btn-back {
                    background: #5c5c5c;
                    color: #ffffff;
                }
            
                .btn-back:hover {
                    background: #4b4b4b;
                    transform: translateY(-2px);
                }
            
                .path-history {
                    background: #4a4a4a;
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 15px;
                    border-left: 3px solid #2e8b57;
                }
            
                .path-step {
                    display: flex;
                    align-items: center;
                    margin: 8px 0;
                    padding: 8px;
                    background: #3c3c3c;
                    border-radius: 5px;
                    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                }
            
                .path-step .step-icon {
                    width: 25px;
                    height: 25px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                    margin-right: 10px;
                    font-size: 0.8rem;
                }
            
                .path-step.yes .step-icon {
                    background: #2e8b57;
                    color: #ffffff;
                }
            
                .path-step.no .step-icon {
                    background: #696969;
                    color: #ffffff;
                }
            
                .dice-section {
                    background: #4a4a4a;
                    border-radius: 8px;
                    padding: 20px;
                    text-align: center;
                    margin: 15px 0;
                    border: 1px solid #5c5c5c;
                }
            
                .dice-result {
                    font-size: 3rem;
                    font-weight: bold;
                    color: #d8d8d8;
                    margin: 15px 0;
                }
            
                .result-section {
                    background: #2e8b57;
                    color: #ffffff;
                    border-radius: 8px;
                    padding: 20px;
                    text-align: center;
                    margin-top: 15px;
                    border: 1px solid #3c3c3c;
                }
            
                .result-section h2 {
                    margin: 0 0 15px 0;
                    font-size: 2rem;
                    display: none;
                }
            
                .result-section p {
                    margin: 10px 0;
                    font-size: 32px;
                    white-space: pre-line;
                    font-weight: bold;
                    font-style: italic;
                }
            
                .strategy-details {
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 5px;
                    padding: 15px;
                    margin-top: 15px;
                }
            
                .strategy-list {
                    text-align: left;
                    margin: 15px 0;
                    list-style: none;
                    padding: 0;
                }
            
                .strategy-list li {
                    margin: 8px 0;
                    padding: 8px 10px;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 5px;
                    border-left: 3px solid rgba(255, 255, 255, 0.3);
                }
            
                .sub-priority-list {
                    list-style: none;
                    padding-left: 20px;
                    margin-top: 5px;
                }
            
                .sub-priority-list li {
                    margin: 5px 0;
                    padding: 5px 10px;
                    background: rgba(0, 0, 0, 0.2);
                    border-radius: 5px;
                    border-left: 2px solid rgba(255, 255, 255, 0.4);
                    font-size: 0.9rem;
                }
            
                .hidden {
                    display: none;
                }   
        
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                    margin: 10px;
                }
                
                .header h1 {
                    font-size: 1.5rem;
                }
                
                .button-group {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn {
                    width: 100%;
                    max-width: 180px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ì „ìŸ ì´ˆê¸° í˜ì´ì¦ˆ</h1>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="pathHistory" class="path-history hidden">
                <h4 style="margin-top: 0; color: #ffffff;">ì§„í–‰ ê²½ë¡œ</h4>
                <div id="pathSteps"></div>
            </div>

            <div id="stepSection" class="step-section">
                <div class="step-header">
                    <div class="step-number" id="stepNumber">1</div>
                    <h2 class="step-title" id="stepTitle">ì‹œì‘</h2>
                </div>
                
                <div class="condition-box" id="conditionBox">
                    ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>
                
                <div class="button-group" id="buttonGroup">
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>

            <div id="diceSection" class="dice-section hidden">
                <h3 style="margin: 0 0 20px 0; color: #2d3436;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (1d10)</h3>
                <div class="dice-result" id="diceResult">?</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="resultSection" class="result-section hidden">
                <h2 id="strategyTitle">ìµœì¢… ì „ëµ ê²°ì •</h2>
                <p id="strategyName"></p>
                <div class="strategy-details" id="strategyDetails"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>
        <script>
            // Implementation notes
            const notes = {
                '[1]': 'í™œì„±í™” ì‹œ, ì—°í•©êµ° HQê°€ ë³´ê¸‰ ìƒíƒœê°€ ë˜ë„ë¡ í•´ì„œëŠ” ì•ˆë©ë‹ˆë‹¤.',
                '[2]': 'ì§€ì •ëœ ëª©í‘œ ì§€ì ì—, ì†ì‹¤(ì†Œëª¨ì „)ì„ ê²¬ë”œ ìˆ˜ ìˆëŠ” ì§€ìƒ ìœ ë‹›ì„ AAë¥¼ í†µí•´ ìƒë¥™ì‹œí‚µë‹ˆë‹¤.',
                '[3]': 'ì¹´ë“œì™€ ì¡°ê±´ì´ ì¶©ì¡±ë  ê²½ìš°, ì „ëµì—ì„œ ì§€ì‹œí•˜ëŠ” ìˆœì„œëŒ€ë¡œ ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.',
                '[4]': 'ê°€ëŠ¥í•˜ë‹¤ë©´ PBMìœ¼ë¡œ ê³µêµ° ìœ ë‹›ì„ ì‚¬ìš©í•˜ê³ , ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ í•­ê³µëª¨í•¨ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.',
                '[5]': 'WiE > 0ì´ê³ , WiE ìë™ ì´ë²¤íŠ¸ ì „ëµì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ë©´ ê·¸ ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì§€ì‹œì— ë”°ë¼ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦½ë‹ˆë‹¤.',
                '[6]': 'ì´ë¯¸ ì ë ¹í•œ í•­êµ¬ë¼ë©´, IJA ë³‘ë ¥ì„ ìµœëŒ€ 3ìŠ¤í…ë§Œí¼ ì¦ì›í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ë¬´ì‹œí•©ë‹ˆë‹¤.',
                '[7]': 'ëª©í‘œ ì§€ì—­(ë˜ëŠ” íŠ¹ì • HQ)ì„ ë°©ì–´í•˜ëŠ” ì  AZOI ìœ ë‹›ì„, ì§€ì •ëœ í”¼í•´ ìˆ˜ì¤€ ì´ìƒìœ¼ë¡œ ì œê±°í•  ìˆ˜ ìˆì„ ë§Œí¼ì˜ í™”ë ¥ì„ ë™ì›í•´ ê³µì¤‘/í•´ìƒ ê³µê²©ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. í•„ìš”í•˜ë‹¤ë©´ PBM ì¤‘ì— HQ ìœ„ì— AZOIë¥¼ í˜•ì„±í•  ìˆ˜ ìˆë„ë¡ ê¸°ì§€ë¥¼ ì ë ¹í•©ë‹ˆë‹¤.'
            };
        
            // ì „ëµ ì •ë³´ ë°ì´í„°
            const strategies = {
                'Aggressive Air Superiority': {
                    name: 'ê³µì„¸ì  ì œê³µê¶Œ ì „ëµ',
                    details: [
                        'ì—°í•©êµ° ë³¸ë¶€ ë¬´ë ¥í™”[7]<em style="font-size:0.9em;">Neutralize Allied HQs</em>',
                        'DEI í•­ë³µ<em style="font-size:0.9em;">DEI Surrender</em>',
                        'ë§ë¼ì•¼ í•­ë³µ<em style="font-size:0.9em;">Malaya Surrender</em>'
                    ]
                },
                'Conservative Air Superiority': {
                    name: 'ë³´ìˆ˜ì  ì œê³µê¶Œ ì „ëµ',
                    details: [
                        'ì—°í•©êµ° ë³¸ë¶€ ë¬´ë ¥í™”[7]<em style="font-size:0.9em;">Neutralize Allied HQs</em>',
                        'DEI ë¬´ë ¥í™”<em style="font-size:0.9em;">DEI Neutralization</em>'
                    ]
                },
                'Aggressive Southern Resource': {
                    name: 'ê³µì„¸ì  ë‚¨ë°© ìì› ì „ëµ[1]',
                    details: [
                        'DEI í•­ë³µ<em style="font-size:0.9em;">DEI Surrender</em>',
                        'ë§ë¼ì•¼ í•­ë³µ<em style="font-size:0.9em;">Malaya Surrender</em>',
                        'í•„ë¦¬í•€ í•­ë³µ<em style="font-size:0.9em;">Philippines Surrender</em>',
                        'D10 ì£¼ì‚¬ìœ„ í•˜ë‚˜ êµ´ë¦¬ê¸°[5]'
                    ]
                },
                'Conservative Southern Resource': {
                    name: 'ë³´ìˆ˜ì  ë‚¨ë°© ìì› ì „ëµ[1]',
                    details: [
                        'DEI ë¬´ë ¥í™”<em style="font-size:0.9em;">DEI Neutralization</em>',
                        'ë§ë¼ì•¼ í•­ë³µ<em style="font-size:0.9em;">Malaya Surrender</em>',
                        'í•„ë¦¬í•€ í•­ë³µ<em style="font-size:0.9em;">Philippines Surrender</em>',
                        'D10 ì£¼ì‚¬ìœ„ í•˜ë‚˜ êµ´ë¦¬ê¸°[5]'
                    ]
                },
                'Defense Perimeter Strategy': {
                    name: 'ë°©ì–´ì„  ì „ëµ',
                    details: [
                        'í˜¸ì£¼ ìœ„ì„í†µì¹˜ë ¹<em style="font-size:0.9em;">Australian Mandates</em>',
                        'ë‰´ê¸°ë‹ˆ<em style="font-size:0.9em;">New Guinea</em>'
                    ]
                },
                'CBI Strategy': {
                    name: 'CBI ì „ëµ',
                    details: [
                        'ë²„ë§ˆ í•­ë³µ<em style="font-size:0.9em;">Burma Surrender</em>',
                        'ì¤‘êµ­ í•­ë³µ<em style="font-size:0.9em;">China Surrender</em>'
                    ]
                },
                'Central Pacific Strategy': {
                    name: 'ì¤‘ë¶€ íƒœí‰ì–‘ ì „ëµ',
                    details: [
                        'ë‰´ê¸°ë‹ˆ ë¶ì„œë¶€<em style="font-size:0.9em;">NW New Guinea</em>',
                        'Attu/Kiska[2]',
                        'Defend Marshalls',
                        'Midway[2]'
                    ]
                },
                'Event Strategy': {
                    name: 'ì´ë²¤íŠ¸ ì „ëµ[3]',
                    details: [
                        'ì—°í•©êµ° WiE > 0ì´ë©´ WiE, ê·¸ ì™¸ FOQ',
                        'ì¼ë³¸ì´ ISRì´ë©´ ISR ì¢…ë£Œ, ê·¸ ì™¸ FOQ',
                        'ì—°í•©êµ°ì´ ì „ëµì  í•©ì˜ ìƒíƒœë©´ ISR ìƒì„±, ê·¸ ì™¸ FOQ.',
                        'ë„ì¿„ ë¡œì¦ˆë¥¼ FOQë¡œ',
                        'ë³‘ë ¥ ë³´ì¶©ì„ FOQë¡œ',
                        'ë‚ ì”¨ ì¹´ë“œë¥¼ FOQë¡œ',
                        'ì´ë²¤íŠ¸ë¡œ í”Œë ˆì´í–ˆì„ ë•Œ ë¯¸êµ­ PWê°€ 0ì´ ë˜ì§€ ì•ŠëŠ” í•œ, ë„ì¡° ì¹´ë“œë¥¼ TOCë¡œ í”Œë ˆì´',
                        'ê¸°íƒ€: FOQê°€ ì—†ë‹¤ë©´ ì¹´ë“œë¥¼ FOQì— ë„£ìŒ'
                    ]
                }
            };
        
            // í•˜ìœ„ ìš°ì„ ìˆœìœ„ ëª©ë¡
            const subPriorities = {
                'ì—°í•©êµ° ë³¸ë¶€ ë¬´ë ¥í™”[7]<em style="font-size:0.9em;">Neutralize Allied HQs</em>': [
                    'Philippines (0.25x)',
                    'Singapore (0.5x)',
                    'ABDA (0.5x)'
                ],
                'DEI ë¬´ë ¥í™”<em style="font-size:0.9em;">DEI Neutralization</em>': [
                    'Jolo[4]',
                    'Makassar[4]',
                    'Teleokbetung[4]',
                    'Bandjermasin[4]',
                    '[4]: ê°€ëŠ¥í•˜ë‹¤ë©´ PBMìœ¼ë¡œ ê³µêµ° ìœ ë‹›ì„ ì‚¬ìš©í•˜ê³ , ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ í•­ê³µëª¨í•¨ì„ ì‚¬ìš©í•œë‹¤.'
                ],
                'DEI í•­ë³µ<em style="font-size:0.9em;">DEI Surrender</em>': [
                    'Balikpapan, Tarakan',
                    'Batavia(Javaì— ì¼ë³¸ ì§€ìƒ ë³‘ë ¥ì´ ì—†ë‹¤ë©´ ì¥ì•…capture)[6]',
                    'Tjilatjap, Soerabaja',
                    'Bangka, Palembang, Medan'
                ],
                'ë§ë¼ì•¼ í•­ë³µ<em style="font-size:0.9em;">Malaya Surrender</em>': [
                    'Kuantan',
                    'Singapore'
                ],
                'í•„ë¦¬í•€ í•­ë³µ<em style="font-size:0.9em;">Philippines Surrender</em>': [
                    'Manila',
                    'Davao'
                ],
                'í˜¸ì£¼ ìœ„ì„í†µì¹˜ë ¹<em style="font-size:0.9em;">Australian Mandates</em>': [
                    'Rabaul / Allied',
                    'Guadalcanal'
                ],
                'ë²„ë§ˆ í•­ë³µ<em style="font-size:0.9em;">Burma Surrender</em>': [
                    'Rangoon',
                    'Mandalay',
                    'Lashio',
                    'Myitkyina'
                ],
                'ì¤‘êµ­ í•­ë³µ<em style="font-size:0.9em;">China Surrender</em>': [
                    'Lashio',
                    'ì¤‘êµ­ ê³µì„¸<em style="font-size:0.9em;">China Offensive</em>',
                    'China Event'
                ],
                'ë‰´ê¸°ë‹ˆ ë¶ì„œë¶€<em style="font-size:0.9em;">NW New Guinea</em>': [
                    'Hollandia',
                    'Lae',
                    'Buna',
                    'Biak',
                    'Wewak',
                    'Vogelkop',
                    'Gili-Gili',
                    'Port Moresby'
                ],
                'Defend Marshalls': [
                    'Wake',
                    'Tarawa'
                ],
                'ë‰´ê¸°ë‹ˆ<em style="font-size:0.9em;">New Guinea</em>': [
                    'Sarong',
                    'Vogelkop',
                    'Biak'
                ]
            };
        
            // ì •ì˜
            const conditions = {
                'A': 'í•„ë¦¬í•€, DEI, ë§ë¼ì•¼ì— ìˆëŠ” ì—°í•©êµ° ë³¸ë¶€ê°€ OOS ìƒíƒœì…ë‹ˆê¹Œ?',
                'B': 'DEI í•­ë³µ ëª©í‘œë“¤ì— ì ë ¹ë˜ì—ˆìŠµë‹ˆê¹Œ?',
                'C': 'ì¼ë³¸ì´ ì¹´ë“œë¥¼ 3ì¥ ì´ìƒ ê°€ì§€ê³  ìˆìŠµë‹ˆê¹Œ?',
                'D': 'ì¼ë³¸ì´ í†µì œControlí•˜ëŠ” ìì› í—¥ìŠ¤ê°€ 13ê°œ ë¯¸ë§Œì…ë‹ˆê¹Œ?',
                'E': 'ì¼ë³¸ì´ í†µì œControlí•˜ëŠ” ìì› í—¥ìŠ¤ê°€ 13ê°œ ì´ìƒì…ë‹ˆê¹Œ?',
                'F': 'ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 20 ì´ìƒì…ë‹ˆê¹Œ?',
                'G': 'ì§€ê¸ˆ ì§„í–‰í•˜ëŠ” ê²Œì„ í„´ì´ 3í„´ ë˜ëŠ” ê·¸ ì´í›„ í„´ì…ë‹ˆê¹Œ?',
                'H': 'ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 19 ì´í•˜ì…ë‹ˆê¹Œ?',
                'I': 'ëª¨ë“  DEI í•­êµ¬ê°€ ì¼ë³¸êµ°ì˜ AZOI ì˜í–¥ê¶Œì— ìˆìŠµë‹ˆê¹Œ?',
                'J': 'ì¼ë³¸ì´ ê³¼ë‹¬ì¹´ë‚ ê³¼ ë¼ë°”ìš¸ì„ í†µì œControlí•©ë‹ˆê¹Œ?',
                'K': 'ì¼ë³¸ì´ ë‰´ê¸°ë‹ˆ í•­êµ¬ 6ê°œ ì¤‘ 4ê°œë¥¼ í†µì œControlí•˜ê±°ë‚˜ AZOIë¥¼ í–‰ì‚¬í•˜ê³  ìˆìŠµë‹ˆê¹Œ?',
                'L': 'ë§ë¼ì•¼, í•„ë¦¬í•€, DEI ì¤‘ í•œ ê³³ì´ ì •ë³µConqueredë˜ê¸° ê¹Œì§€ ë”± 1 í—¥ìŠ¤ê°€ ë¶€ì¡±í•œ ìƒí™©ì…ë‹ˆê¹Œ?',
                'M': 'ë°©ì–´ì„  ì „ëµ ëª©í‘œDefense Perimeter Strategy #1ì„ ë‹¬ì„±í–ˆìŠµë‹ˆê¹Œ?'
            };
        
            let currentStep = 'start';
            let pathHistory = [];
            let stepCount = 0;
            let evaluatedConditions = {};
        
            // Helper function to create missing DOM elements
            function createMissingElement(id, tag, parent, classes = []) {
                let element = document.getElementById(id);
                if (!element) {
                    console.warn(`Creating missing element: ${id}`);
                    element = document.createElement(tag);
                    element.id = id;
                    classes.forEach(cls => element.classList.add(cls));
                    if (parent && parent.appendChild) {
                        parent.appendChild(element);
                    } else {
                        document.body.appendChild(element);
                    }
                }
                return element;
            }
        
            function startFlow() {
                currentStep = 'A';
                stepCount = 1;
                pathHistory = [];
                evaluatedConditions = {};
                showStep('A');
            }
        
            function showStep(stepId) {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const stepNumber = createMissingElement('stepNumber', 'div', stepSection);
                const stepTitle = createMissingElement('stepTitle', 'h2', stepSection);
                const conditionBox = createMissingElement('conditionBox', 'div', stepSection);
                const buttonGroup = createMissingElement('buttonGroup', 'div', stepSection);
        
                if (errorContainer) errorContainer.classList.add('hidden');
        
                stepNumber.textContent = stepCount;
        
                if (stepId === 'DICE') {
                    const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                    const diceResult = createMissingElement('diceResult', 'div', diceSection);
                    stepSection.classList.add('hidden');
                    diceSection.classList.remove('hidden');
                    diceResult.textContent = '-';
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                    return;
                }
        
                // ë³µí•© ì¡°ê±´ë“¤ì„ ì²˜ë¦¬
                if (stepId.includes('_CHECK') || stepId.includes('_FOR_') || stepId.includes('_FINAL')) {
                    showComplexConditionStep(stepId);
                    return;
                }
        
                // ê¸°ë³¸ ì¡°ê±´ë“¤ ì²˜ë¦¬
                if (conditions[stepId]) {
                    stepTitle.textContent = `${stepId} í™•ì¸`;
                    conditionBox.innerHTML = ` ${conditions[stepId]}`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                        <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'start') {
                    stepTitle.textContent = 'ì‹œì‘';
                    conditionBox.innerHTML = `ì „ìŸ ì´ˆê¸° í˜ì´ì¦ˆ`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                    `;
                }
        
                updateProgress();
                updatePathHistory();
            }
        
            function selectChoice(conditionId, choice) {
                evaluatedConditions[conditionId] = choice;
                pathHistory.push({ step: conditionId, choice: choice, stepNum: stepCount });
                stepCount++;
        
                const nextStep = getNextStep(conditionId, choice);
        
                if (nextStep.startsWith('STRATEGY_')) {
                    const strategy = nextStep.replace('STRATEGY_', '');
                    showResult(strategy);
                } else {
                    currentStep = nextStep;
                    showStep(nextStep);
                }
            }
        
            function getNextStep(conditionId, choice) {
                switch (conditionId) {
                    case 'A':
                        return choice ? 'B' : 'CD_CHECK';
                    case 'B':
                        return choice ? 'C_FOR_E_OR_HI' : 'G';
                    case 'C_FOR_E_OR_HI':
                        return choice ? 'E_OR_HI_CHECK' : 'CJE_BIK_CHECK';
                    case 'E_OR_HI_CHECK':
                        return choice ? 'STRATEGY_Defense Perimeter Strategy' : 'CJE_BIK_CHECK';
                    case 'CJE_BIK_CHECK':
                        return choice ? 'DICE' : 'CL_CHECK';
                    case 'CL_CHECK':
                        return choice ? 'STRATEGY_Aggressive Southern Resource' : 'M';
                    case 'G':
                        return choice ? 'STRATEGY_Aggressive Southern Resource' : 'ACD_CHECK';
                    case 'CD_CHECK':
                        return choice ? 'F_FOR_CD' : 'G';
                    case 'F_FOR_CD':
                        return choice ? 'STRATEGY_Aggressive Air Superiority' : 'STRATEGY_Conservative Air Superiority';
                    case 'ACD_CHECK':
                        return choice ? 'F_FOR_ACD' : 'C_FOR_E_OR_HI_FINAL';
                    case 'F_FOR_ACD':
                        return choice ? 'STRATEGY_Aggressive Southern Resource' : 'STRATEGY_Conservative Southern Resource';
                    case 'C_FOR_E_OR_HI_FINAL':
                        return choice ? 'E_OR_HI_CHECK_FINAL' : 'CJE_BIK_CHECK';
                    case 'E_OR_HI_CHECK_FINAL':
                        return choice ? 'STRATEGY_Defense Perimeter Strategy' : 'CJE_BIK_CHECK';
                    case 'M':
                        return choice ? 'STRATEGY_Defense Perimeter Strategy' : 'STRATEGY_Aggressive Southern Resource';
                    default:
                        return 'STRATEGY_Defense Perimeter Strategy';
                }
            }
        
            function rollDice() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const diceResult = createMissingElement('diceResult', 'div', diceSection);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                const diceValue = Math.floor(Math.random() * 10); // 0-9
                diceResult.textContent = diceValue;
        
                let strategy;
                if (diceValue >= 0 && diceValue <= 2) {
                    strategy = 'Event Strategy';
                } else if (diceValue >= 3 && diceValue <= 6) {
                    strategy = 'CBI Strategy';
                } else if (diceValue >= 7 && diceValue <= 9) {
                    strategy = 'Central Pacific Strategy';
                }
        
                pathHistory.push({
                    step: 'DICE',
                    choice: diceValue,
                    stepNum: stepCount,
                    isResult: true,
                    result: strategy
                });
        
                setTimeout(() => showResult(strategy), 1000);
            }
        
            function showResult(strategyKey) {
                const strategy = strategies[strategyKey];
                if (!strategy) {
                    console.error('Strategy not found:', strategyKey);
                    return;
                }
        
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                const strategyName = createMissingElement('strategyName', 'h2', resultSection);
                const strategyDetails = createMissingElement('strategyDetails', 'div', resultSection);
                const buttonGroup = resultSection.querySelector('.button-group') || createMissingElement('button-group', 'div', resultSection, ['button-group']);
        
                if (errorContainer) errorContainer.classList.add('hidden');
        
                stepSection.classList.add('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.remove('hidden');
                strategyName.textContent = strategy.name;
        
                // Extract annotations from strategy name, details, and sub-priorities
                const annotationRegex = /\[\d+\]/g;
                const annotations = new Set();
                if (strategy.name.match(annotationRegex)) {
                    strategy.name.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                }
                strategy.details.forEach(detail => {
                    if (detail.match(annotationRegex)) {
                        detail.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                    }
                    if (subPriorities[detail]) {
                        subPriorities[detail].forEach(sub => {
                            if (sub.match(annotationRegex)) {
                                sub.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                            }
                        });
                    }
                });
        
                strategyDetails.innerHTML = `
                    <h4 style="margin-top: 0; color: #fff;">ì „ëµ ìš°ì„ ìˆœìœ„:</h4>
                    <ul class="strategy-list">
                        ${strategy.details.map(detail => `
                            <li>
                                ${detail}
                                ${subPriorities[detail] ? `
                                    <ul class="sub-priority-list">
                                        ${subPriorities[detail].map(sub => `<li>${sub}</li>`).join('')}
                                    </ul>
                                ` : ''}
                            </li>
                        `).join('')}
                    </ul>
                    ${annotations.size > 0 ? `
                        <h4 style="margin-top: 20px; color: #fff;">ì£¼ì„:</h4>
                        <ul class="strategy-list">
                            ${Array.from(annotations).sort().map(annotation => `
                                <li class="impl-note">${annotation}: ${notes[annotation]}</li>
                            `).join('')}
                        </ul>
                    ` : ''}
                `;
        
                // Check if strategy details include "D10 ì£¼ì‚¬ìœ„ í•˜ë‚˜ êµ´ë¦¬ê¸°[5]"
                const hasDiceRoll = strategy.details.includes('D10 ì£¼ì‚¬ìœ„ í•˜ë‚˜ êµ´ë¦¬ê¸°[5]');
                buttonGroup.innerHTML = `
                    ${hasDiceRoll ? '<button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>' : ''}
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;
        
                updateProgress();
                updatePathHistory();
            }
        
            function updateProgress() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const progressBar = createMissingElement('progress-bar', 'div', document.body, ['progress-bar']);
                const progressFill = createMissingElement('progressFill', 'div', progressBar, ['progress-fill']);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                const totalSteps = 15; // ëŒ€ëµì ì¸ ìµœëŒ€ ë‹¨ê³„ ìˆ˜
                const progress = Math.min((stepCount / totalSteps) * 100, 100);
                progressFill.style.width = progress + '%';
            }
        
            function updatePathHistory() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const pathHistoryDiv = createMissingElement('pathHistory', 'div', document.body, ['hidden']);
                const pathStepsDiv = createMissingElement('pathSteps', 'div', pathHistoryDiv);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                if (pathHistory.length === 0) {
                    pathHistoryDiv.classList.add('hidden');
                    return;
                }
        
                pathStepsDiv.innerHTML = '';
        
                pathHistory.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = `path-step ${step.choice && step.step !== 'DICE' ? 'yes' : step.step !== 'DICE' ? 'no' : ''}`;
        
                    if (step.step === 'DICE') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice}</div>
                            <div>
                                <strong>ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°:</strong> ${step.choice} 
                                ${step.result ? `â†’ ${strategies[step.result].name}` : ''}
                            </div>
                        `;
                    } else {
                        let conditionText = '';
                        if (conditions[step.step]) {
                            conditionText = conditions[step.step];
                        } else {
                            switch (step.step) {
                                case 'CD_CHECK':
                                    conditionText = 'C+D';
                                    break;
                                case 'CJE_BIK_CHECK':
                                    conditionText = 'C+J+E+(B or I or K)';
                                    break;
                                case 'ACD_CHECK':
                                    conditionText = 'A+C+D';
                                    break;
                                case 'E_OR_HI_CHECK':
                                case 'E_OR_HI_CHECK_FINAL':
                                    conditionText = 'E or (H+I)';
                                    break;
                                case 'CL_CHECK':
                                    conditionText = 'C+L';
                                    break;
                                case 'C_FOR_E_OR_HI':
                                    conditionText = 'C';
                                    break;
                                case 'C_FOR_E_OR_HI_FINAL':
                                    conditionText = 'C(ìµœì¢…)';
                                    break;
                                case 'F_FOR_CD':
                                    conditionText = 'F(ì œê³µê¶Œ)';
                                    break;
                                case 'F_FOR_ACD':
                                    conditionText = 'F(ë‚¨ë°©ìì›)';
                                    break;
                                default:
                                    conditionText = step.step;
                            }
                        }
        
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice ? 'Y' : 'N'}</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ${conditionText} â†’ ${step.choice ? 'YES' : 'NO'}
                            </div>
                        `;
                    }
        
                    pathStepsDiv.appendChild(stepDiv);
                });
        
                pathHistoryDiv.classList.remove('hidden');
            }
        
            function resetFlow() {
                currentStep = 'start';
                stepCount = 0;
                pathHistory = [];
                evaluatedConditions = {};
        
                // Step 1: Create top-level elements
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                const pathHistoryDiv = createMissingElement('pathHistory', 'div', document.body, ['hidden']);
                const progressBar = createMissingElement('progress-bar', 'div', document.body, ['progress-bar']);
        
                // Step 2: Create child elements that depend on top-level elements
                const elements = {
                    errorContainer,
                    stepSection,
                    diceSection,
                    resultSection,
                    pathHistoryDiv,
                    progressBar,
                    stepNumber: createMissingElement('stepNumber', 'div', stepSection),
                    stepTitle: createMissingElement('stepTitle', 'h2', stepSection),
                    conditionBox: createMissingElement('conditionBox', 'div', stepSection),
                    buttonGroup: createMissingElement('buttonGroup', 'div', stepSection),
                    progressFill: createMissingElement('progressFill', 'div', progressBar, ['progress-fill']),
                    pathSteps: createMissingElement('pathSteps', 'div', pathHistoryDiv),
                    strategyName: createMissingElement('strategyName', 'h2', resultSection),
                    strategyDetails: createMissingElement('strategyDetails', 'div', resultSection),
                    diceResult: createMissingElement('diceResult', 'div', diceSection)
                };
        
                const createdElements = Object.keys(elements).filter(key => {
                    const element = document.getElementById(elements[key].id);
                    return element && element !== document.getElementById(key);
                });
        
                if (createdElements.length > 0) {
                    console.warn('Created missing DOM elements in resetFlow:', createdElements);
                    console.warn('To avoid dynamic creation, add the following to your HTML:', createdElements.map(id => `<div id="${id}"></div>`).join('\n'));
                    if (elements.errorContainer) {
                        elements.errorContainer.classList.remove('hidden');
                    }
                } else if (elements.errorContainer) {
                    elements.errorContainer.classList.add('hidden');
                }
        
                if (elements.stepSection) elements.stepSection.classList.remove('hidden');
                if (elements.diceSection) elements.diceSection.classList.add('hidden');
                if (elements.resultSection) elements.resultSection.classList.add('hidden');
                if (elements.pathHistoryDiv) elements.pathHistoryDiv.classList.add('hidden');
                if (elements.stepNumber) elements.stepNumber.textContent = '1';
                if (elements.stepTitle) elements.stepTitle.textContent = 'ì‹œì‘';
                if (elements.conditionBox) elements.conditionBox.innerHTML = 'ì—ë¼ìŠ¤ë¬´ìŠ¤ì˜ ì „ìŸ ì´ˆê¸° ì „ëµì„ ê²°ì •í•©ë‹ˆë‹¤';
                if (elements.buttonGroup) elements.buttonGroup.innerHTML = '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>';
                if (elements.progressFill) elements.progressFill.style.width = '0%';
            }
        
            function goBack() {
                if (pathHistory.length === 0) {
                    resetFlow();
                    return;
                }
        
                // Remove the last step from history
                const lastStep = pathHistory.pop();
                stepCount--;
        
                // Remove the last evaluated condition
                if (lastStep.step !== 'DICE') {
                    delete evaluatedConditions[lastStep.step];
                }
        
                // Determine the previous step
                if (pathHistory.length === 0) {
                    currentStep = 'start';
                } else {
                    currentStep = pathHistory[pathHistory.length - 1].step;
                    if (lastStep.step === 'DICE') {
                        currentStep = pathHistory.length > 0 ? pathHistory[pathHistory.length - 1].step : 'start';
                        pathHistory.pop();
                        stepCount--;
                        if (pathHistory.length > 0) {
                            delete evaluatedConditions[pathHistory[pathHistory.length - 1].step];
                        }
                    }
                }
        
                // Update UI
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                showStep(currentStep);
            }
        
            function showComplexConditionStep(stepId) {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const stepNumber = createMissingElement('stepNumber', 'div', stepSection);
                const stepTitle = createMissingElement('stepTitle', 'h2', stepSection);
                const conditionBox = createMissingElement('conditionBox', 'div', stepSection);
                const buttonGroup = createMissingElement('buttonGroup', 'div', stepSection);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                stepNumber.textContent = stepCount;
        
                let conditionText = '';
                let displayTitle = '';
        
                switch (stepId) {
                    case 'CD_CHECK':
                        displayTitle = 'C+D';
                        conditionText = 'ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <li>ì¼ë³¸ì´ ê°€ì§„ ì¹´ë“œê°€ 3ì¥ ì´ìƒ</li> <li>ì¼ë³¸ì´ í†µì œControlí•˜ëŠ” ìì› í—¥ìŠ¤ê°€ 13ê°œ ë¯¸ë§Œ</li>';
                        break;
                    case 'CJE_BIK_CHECK':
                        displayTitle = 'C+J+E+(B or I or K)';
                        conditionText = 'ì¼ë³¸ì´ ì¹´ë“œë¥¼ 3ì¥ ì´ìƒ ê°€ì§€ê³  ìˆê³ , <br>ê³¼ë‹¬ì¹´ë‚ ê³¼ ë¼ë°”ìš¸ì„ í†µì œControlí•˜ë©°, <br>í†µì œControlí•˜ëŠ” ìì› í—¥ìŠ¤ê°€ 13ê°œ ì´ìƒì´ë©°, <br> <br>ë‹¤ìŒ ì¤‘ í•˜ë‚˜ ì´ìƒì´ ì°¸ì¸ ê²½ìš° <li>DEI í•­ë³µ ëª©í‘œë“¤ì´ ì ë ¹ëœ ìƒíƒœê±°ë‚˜</li> <li>ëª¨ë“  DEI í•­êµ¬ê°€ ì¼ë³¸êµ°ì˜ AZOI ì˜í–¥ê¶Œì— ìˆê±°ë‚˜</li> <li>ì¼ë³¸ì´ ë‰´ê¸°ë‹ˆ í•­êµ¬ 6ê°œ ì¤‘ 4ê°œë¥¼ í†µì œControlí•˜ê±°ë‚˜ AZOIë¥¼ í–‰ì‚¬í•˜ê³  ìˆëŠ” ê²½ìš°</li>';
                        break;
                    case 'ACD_CHECK':
                        displayTitle = 'A+C+D';
                        conditionText = 'ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <li>í•„ë¦¬í•€, DEI, ë§ë¼ì•¼ì— ìˆëŠ” ì—°í•©êµ° ë³¸ë¶€ê°€ OOS ìƒíƒœ</li> <li>ì¼ë³¸ì´ ê°€ì§„ ì¹´ë“œê°€ 3ì¥ ì´ìƒ</li> <li>ì¼ë³¸ì´ í†µì œControlí•˜ëŠ” ìì› í—¥ìŠ¤ê°€ 13ê°œ ë¯¸ë§Œ</li>';
                        break;
                    case 'E_OR_HI_CHECK':
                    case 'E_OR_HI_CHECK_FINAL':
                        displayTitle = 'E or (H+I)';
                        conditionText = 'ë‹¤ìŒ ì¤‘ í•˜ë‚˜ ì´ìƒì´ ì°¸ì…ë‹ˆê¹Œ? <li>ì¼ë³¸ì´ í†µì œControlí•˜ëŠ” ìì› í—¥ìŠ¤ê°€ 13ê°œ ì´ìƒ</li> <li>ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 19 ì´í•˜ì´ê³  ëª¨ë“  DEI í•­êµ¬ê°€ ì¼ë³¸êµ°ì˜ AZOI ì˜í–¥ê¶Œì— ìˆëŠ” ê²½ìš°';
                        break;
                    case 'CL_CHECK':
                        displayTitle = 'C+L';
                        conditionText = 'ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <li>ì¼ë³¸ì´ ê°€ì§„ ì¹´ë“œê°€ 3ì¥ ì´ìƒ</li><li>ë§ë¼ì•¼, í•„ë¦¬í•€, DEI ì¤‘ í•œ ê³³ì´ ì •ë³µConqueredë˜ê¸° ê¹Œì§€ ë”± 1 í—¥ìŠ¤ê°€ ë¶€ì¡±í•œ ìƒí™©</li>';
                        break;
                    case 'C_FOR_E_OR_HI':
                        displayTitle = 'C';
                        conditionText = 'ì¼ë³¸ì´ ê°€ì§„ ì¹´ë“œê°€ 3ì¥ ì´ìƒì…ë‹ˆê¹Œ?';
                        break;
                    case 'C_FOR_E_OR_HI_FINAL':
                        displayTitle = 'C (ìµœì¢… í™•ì¸)';
                        conditionText = 'ì¼ë³¸ì´ ê°€ì§„ ì¹´ë“œê°€ 3ì¥ ì´ìƒì…ë‹ˆê¹Œ?';
                        break;
                    case 'F_FOR_CD':
                        displayTitle = 'F (ì œê³µê¶Œ ê²°ì •)';
                        conditionText = 'ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 20 ì´ìƒì…ë‹ˆê¹Œ?';
                        break;
                    case 'F_FOR_ACD':
                        displayTitle = 'F (ë‚¨ë°©ìì› ê²°ì •)';
                        conditionText = 'ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 20 ì´ìƒì…ë‹ˆê¹Œ?';
                        break;
                    default:
                        displayTitle = 'í™•ì¸';
                        conditionText = 'ì•Œ ìˆ˜ ì—†ëŠ” ì¡°ê±´';
                }
        
                stepTitle.textContent = displayTitle;
                conditionBox.innerHTML = ` ${conditionText}`;
                buttonGroup.innerHTML = `
                    <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                    <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;
        
                updateProgress();
                updatePathHistory();
            }
        
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
            window.onload = function () {
                if (document.readyState === 'complete') {
                    resetFlow();
                } else {
                    window.addEventListener('DOMContentLoaded', resetFlow);
                }
            };
        </script>
    </body>
    </html> 
  </template>

  <!-- 2. ì „ìŸ ì¤‘ê¸° -->
  <template id="tmpl-mid">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Japanese Erasmus Bot - ì „ìŸ ì¤‘ê¸°</title>
        <!-- Malaya, DEI, Philippinesì´ í•­ë³µí–ˆê±°ë‚˜, 4í„´ì´ ì´í›„ì¸ ê²½ìš°ì—ë§Œ ì´ ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ê·¸ ì™¸ì—ëŠ” ì „ìŸ ì´ˆê¸° ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. -->
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #2e2e2e;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
                color: #d8d8d8;
            }
        
            .impl-note {
                font-style: italic;
                font-size: 14px;
                color: #ffffff;
                line-height: 1.6;
                margin: 4px 0;
            }
        
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
        
            .header {
                text-align: center;
                margin-bottom: 20px;
                padding: 15px;
                background: #4a4a4a;
                border-radius: 8px;
                color: #ffffff;
                border: 1px solid #5c5c5c;
            }
        
            .header h1 {
                margin: 0;
                font-size: 2rem;
                font-weight: 700;
            }
        
            .header p {
                margin: 8px 0 0 0;
                font-size: 1rem;
                font-weight: 400;
            }
        
            .progress-bar {
                background: #4a4a4a;
                border-radius: 5px;
                height: 6px;
                margin-bottom: 20px;
                overflow: hidden;
                border: 1px solid #5c5c5c;
            }
        
            .progress-fill {
                background: #4682b4;
                height: 100%;
                border-radius: 5px;
                transition: width 0.3s ease;
                width: 0%;
            }
        
            .step-section {
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid #5c5c5c;
            }
        
            .step-header {
                display: flex;
                align-items: center;
                margin-bottom: 15px;
            }
        
            .step-number {
                background: #4682b4;
                color: #ffffff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1rem;
                margin-right: 15px;
            }
        
            .step-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: #d8d8d8;
                margin: 0;
            }
        
            .condition-box {
                background: #4a4a4a;
                border-left: 4px solid #4682b4;
                border-radius: 5px;
                padding: 15px;
                margin: 15px 0;
                font-size: 1rem;
                line-height: 1.5;
                color: #c8c8c8;
            }
        
            .condition-box strong {
                color: #4682b4;
                font-size: 1.1rem;
            }
        
            .button-group {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 20px;
            }
        
            .btn {
                padding: 10px 30px;
                border: none;
                border-radius: 5px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s ease, transform 0.1s ease;
                text-transform: uppercase;
                min-width: 100px;
                font-family: 'Georgia', 'Times New Roman', Times, serif;
            }
        
            .btn-yes {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .btn-yes:hover {
                background: #257a4b;
                transform: translateY(-2px);
            }
        
            .btn-no {
                background: #696969;
                color: #ffffff;
            }
        
            .btn-no:hover {
                background: #585858;
                transform: translateY(-2px);
            }
        
            .btn-primary {
                background: #4682b4;
                color: #ffffff;
            }
        
            .btn-primary:hover {
                background: #3a6b9a;
                transform: translateY(-2px);
            }
        
            .btn-secondary {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-secondary:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .btn-back {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-back:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .path-history {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 15px;
                border-left: 3px solid #2e8b57;
            }
        
            .path-step {
                display: flex;
                align-items: center;
                margin: 8px 0;
                padding: 8px;
                background: #3c3c3c;
                border-radius: 5px;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }
        
            .path-step .step-icon {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 10px;
                font-size: 0.8rem;
            }
        
            .path-step.yes .step-icon {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .path-step.no .step-icon {
                background: #696969;
                color: #ffffff;
            }
        
            .dice-section {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin: 15px 0;
                border: 1px solid #5c5c5c;
            }
        
            .dice-result {
                font-size: 3rem;
                font-weight: bold;
                color: #d8d8d8;
                margin: 15px 0;
            }
        
            .result-section {
                background: #2e8b57;
                color: #ffffff;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin-top: 15px;
                border: 1px solid #3c3c3c;
            }
        
            .result-section h2 {
                margin: 0 0 15px 0;
                font-size: 2rem;
                display: none;
            }
        
            .result-section p {
                margin: 10px 0;
                font-size: 32px;
                white-space: pre-line;
                font-weight: bold;
                font-style: italic;
            }
        
            .strategy-details {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                padding: 15px;
                margin-top: 15px;
            }
        
            .strategy-list {
                text-align: left;
                margin: 15px 0;
                list-style: none;
                padding: 0;
            }
        
            .strategy-list li {
                margin: 8px 0;
                padding: 8px 10px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 5px;
                border-left: 3px solid rgba(255, 255, 255, 0.3);
            }
        
            .sub-priority-list {
                list-style: none;
                padding-left: 20px;
                margin-top: 5px;
            }
        
            .sub-priority-list li {
                margin: 5px 0;
                padding: 5px 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                border-left: 2px solid rgba(255, 255, 255, 0.4);
                font-size: 0.9rem;
            }
        
            .hidden {
                display: none;
            }
        
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                    margin: 10px;
                }
                
                .header h1 {
                    font-size: 1.5rem;
                }
                
                .button-group {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn {
                    width: 100%;
                    max-width: 180px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ì „ìŸ ì¤‘ê¸° í˜ì´ì¦ˆ</h1>
                <br>Malaya, DEI, Philippinesì´ í•­ë³µí–ˆê±°ë‚˜ 4í„´ ì´í›„ì¸ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.<br>ê·¸ ì™¸ì—ëŠ” <b>ì „ìŸ ì´ˆê¸° ì°¨íŠ¸</b>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</strong>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="pathHistory" class="path-history hidden">
                <h4 style="margin-top: 0; color: #ffffff;">ì§„í–‰ ê²½ë¡œ</h4>
                <div id="pathSteps"></div>
            </div>

            <div id="stepSection" class="step-section">
                <div class="step-header">
                    <div class="step-number" id="stepNumber">1</div>
                    <h2 class="step-title" id="stepTitle">ì‹œì‘</h2>
                </div>
                
                <div class="condition-box" id="conditionBox">
                    ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>
                
                <div class="button-group" id="buttonGroup">
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>

            <div id="diceSection" class="dice-section hidden">
                <h3 style="margin: 0 0 20px 0; color: #2d3436;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (1d10)</h3>
                <div class="dice-result" id="diceResult">?</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="resultSection" class="result-section hidden">
                <h2 id="strategyTitle">ìµœì¢… ì „ëµ ê²°ì •</h2>
                <p id="strategyName"></p>
                <div class="strategy-details" id="strategyDetails"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <script>
            // Implementation notes
            const notes = {
                '[1]': 'ì¹´ë“œ ë° ì¡°ê±´ì´ ìˆë‹¤ë©´ ë‚˜ì—´ëœ ìˆœì„œëŒ€ë¡œ ì´ë²¤íŠ¸ë¥¼ í”Œë ˆì´í•©ë‹ˆë‹¤.',
                '[2]': 'ì§€ì •ëœ ëª©í‘œ ì§€ì ì—, ì†ì‹¤(ì†Œëª¨ì „)ì„ ê²¬ë”œ ìˆ˜ ìˆëŠ” ì§€ìƒ ìœ ë‹›ì„ AAë¥¼ í†µí•´ ìƒë¥™ì‹œí‚µë‹ˆë‹¤.',
                '[3]': 'ì¼ë³¸ì´ ìì›ì„ ìµœì†Œ 13ê°œ ì ë ¹í•  ë•Œê¹Œì§€ ìµœëŒ€í•œ ë§ì€ ìì›ì„ ì ë ¹í•©ë‹ˆë‹¤. ìš°ì„  ìˆœìœ„ì— ìƒê´€ì—†ì´ ê°€ì¥ ì‰¬ìš´ ëª©í‘œë¶€í„° ì ë ¹í•©ë‹ˆë‹¤: ë¹„ì–´ìˆëŠ” ìì›, ê³µêµ°/í•´êµ° ìœ ë‹›ì´ ì ë ¹í•œ ìì›, ê°€ì¥ ì•½í•œ ìœ ë‹›ë¶€í„° ê°€ì¥ ê°•í•œ ìœ ë‹›ê¹Œì§€ ì§€ìƒ ìœ ë‹›ì´ ì ë ¹í•œ ìì› ìˆœìœ¼ë¡œ ì ë ¹í•©ë‹ˆë‹¤. ë™ì ì¸ ê²½ìš° ìš°ì„  ìˆœìœ„ë¥¼ ë”°ë¼ ì„ íƒí•©ë‹ˆë‹¤.',
                '[4]': 'ê°€ëŠ¥í•˜ë‹¤ë©´ ëª©í‘œì— AZOIë¥¼ ì „ê°œí•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ëª¨ë“  ëª©í‘œì— AZOIë¥¼ ì „ê°œí–ˆê±°ë‚˜ ëª©í‘œê°€ ë‹¤ ë–¨ì–´ì§ˆ ë•Œê¹Œì§€ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ë‹¤ìŒ ëª©í‘œë¡œ ì´ë™í•©ë‹ˆë‹¤.',
                '[5]': 'í‘œì‹œëœ ìœ„ì¹˜ì— ìµœì†Œ ì§€ìƒ ìœ ë‹› ìŠ¤í… 1ê°œ ë˜ëŠ” ê³µì¤‘ ìœ ë‹› ìŠ¤í… 1ê°œë¥¼ ë°°ì¹˜í•©ë‹ˆë‹¤. ì„ íƒí•  ìˆ˜ ìˆëŠ” ê²½ìš° ê³µì¤‘ ìœ ë‹›ì„ ë°°ì¹˜í•˜ê³ , ê°€ëŠ¥í•˜ë‹¤ë©´ ë‘˜ ë‹¤ ë°°ì¹˜í•©ë‹ˆë‹¤.',
            };
        
            // ì „ëµ ì •ë³´ ë°ì´í„°
            const strategies = {
                'Event Strategy': {
                    name: 'ì´ë²¤íŠ¸ ì „ëµ[1]',
                    details: [
                        'ì—°í•©êµ° WiE > 0ì´ë©´ WiE, ê·¸ ì™¸ FOQ',
                        'ì¼ë³¸ì´ ISRì´ë©´ ISR ì¢…ë£Œ, ê·¸ ì™¸ FOQ',
                        'ì—°í•©êµ°ì´ ì „ëµì  í•©ì˜ ìƒíƒœë©´ ISR ìƒì„±, ê·¸ ì™¸ FOQ.',
                        'ë„ì¿„ ë¡œì¦ˆë¥¼ FOQë¡œ',
                        'ë³‘ë ¥ ë³´ì¶©ì„ FOQë¡œ',
                        'ë‚ ì”¨ ì¹´ë“œë¥¼ FOQë¡œ',
                        'ì´ë²¤íŠ¸ë¡œ í”Œë ˆì´í–ˆì„ ë•Œ ë¯¸êµ­ PWê°€ 0ì´ ë˜ì§€ ì•ŠëŠ” í•œ, ë„ì¡° ì¹´ë“œë¥¼ TOCë¡œ í”Œë ˆì´',
                        'ê¸°íƒ€: FOQê°€ ì—†ë‹¤ë©´ ì¹´ë“œë¥¼ FOQì— ë„£ìŒ.'
                    ]
                },
                'Resource Strategy': {
                    name: 'ìì› ì „ëµ',
                    details: [
                        'ìì› í™•ë³´',
                        'ë‰´ê¸°ë‹ˆ í•­ë³µ<em style="font-size:0.9em;">New Guinie Surrender</em>',
                        'ë²„ë§ˆ í•­ë³µ<em style="font-size:0.9em;">Burma Surrender</em>',
                        'ì¤‘êµ­ í•­ë³µ<em style="font-size:0.9em;">China Surrender</em>',
                        'í•­êµ¬ ì¦ì›[5]<em style="font-size:0.9em;">Reinforce Ports</em>'
                    ]
                },
                'Central Pacific Strategy': {
                    name: 'ì¤‘ë¶€ íƒœí‰ì–‘ ì „ëµ',
                    details: [
                        'Attu/Kiska[2]',
                        'Defend Marshalls',
                        'Midway[2]',
                        'ë¯¸êµ° í•¨ëŒ€ ê³µê²©'
                    ]
                },
                'CBI Strategy': {
                    name: 'CBI ì „ëµ',
                    details: [
                        'ë²„ë§ˆ í•­ë³µ<em style="font-size:0.9em;">Burma Surrender</em>',
                        'ì¤‘êµ­ í•­ë³µ<em style="font-size:0.9em;">China Surrender</em>',
                        'í•­êµ¬ ì¦ì›[5]<em style="font-size:0.9em;">Reinforce Ports</em>',
                        'ì¸ë„ í•­ë³µ<em style="font-size:0.9em;">India Surrender</em>',
                        'ì´ë²¤íŠ¸ ì „ëµ[1]'
                    ]
                },
                'Defense Perimeter Strategy': {
                    name: 'ë°©ì–´ì„  ì „ëµ',
                    details: [
                        'ë‚¨íƒœí‰ì–‘ ì¸¡ë©´<em style="font-size:0.9em;">South Pacific Flank</em>',
                        'ì¤‘êµ­ í•­ë³µ<em style="font-size:0.9em;">China Surrender</em>',
                        'í•­êµ¬ ì¦ì›[5]<em style="font-size:0.9em;">Reinforce Ports</em>',
                        'CBI ì „ëµ'
                    ]
                },
                'India Strategy': {
                    name: 'ì¸ë„ ì „ëµ',
                    details: [
                        'ì¸ë„ í•­ë³µ<em style="font-size:0.9em;">India Surrender</em>',
                        'ì¤‘êµ­ í•­ë³µ<em style="font-size:0.9em;">China Surrender</em>',
                        'í•­êµ¬ ì¦ì›[5]<em style="font-size:0.9em;">Reinforce Ports</em>'
                    ]
                },
                'Pass': {
                    name: 'PASS',
                    details: [
                        'í–‰ë™ì„ íŒ¨ìŠ¤í•©ë‹ˆë‹¤'
                ]
            }
            };
        
            // í•˜ìœ„ ìš°ì„ ìˆœìœ„ ëª©ë¡
            const subPriorities = {
                'ì´ë²¤íŠ¸ ì „ëµ[1]': [
                    'ì—°í•©êµ° WiE > 0ì´ë©´ WiE, ê·¸ ì™¸ FOQ',
                    'ì¼ë³¸ì´ ISRì´ë©´ ISR ì¢…ë£Œ, ê·¸ ì™¸ FOQ',
                    'ì—°í•©êµ°ì´ ì „ëµì  í•©ì˜ ìƒíƒœë©´ ISR ìƒì„±, ê·¸ ì™¸ FOQ.',
                    'ë„ì¿„ ë¡œì¦ˆë¥¼ FOQë¡œ',
                    'ë³‘ë ¥ ë³´ì¶©ì„ FOQë¡œ',
                    'ë‚ ì”¨ ì¹´ë“œë¥¼ FOQë¡œ',
                    'ì´ë²¤íŠ¸ë¡œ í”Œë ˆì´í–ˆì„ ë•Œ ë¯¸êµ­ PWê°€ 0ì´ ë˜ì§€ ì•ŠëŠ” í•œ, ë„ì¡° ì¹´ë“œë¥¼ TOCë¡œ í”Œë ˆì´',
                    'ê¸°íƒ€: FOQì— ë„£ì„ ì¹´ë“œê°€ ì—†ëŠ” ê²½ìš°.'
                ],
                'CBI ì „ëµ': [
                    'ë²„ë§ˆ í•­ë³µ<em style="font-size:0.9em;">Burma Surrender</em>',
                    'ì¤‘êµ­ í•­ë³µ<em style="font-size:0.9em;">China Surrender</em>',
                    'í•­êµ¬ ì¦ì›[5]<em style="font-size:0.9em;">Reinforce Ports</em>',
                    'ì¸ë„ í•­ë³µ<em style="font-size:0.9em;">India Surrender</em>',
                    'ì´ë²¤íŠ¸ ì „ëµ[1]'
                ],
                'ë²„ë§ˆ í•­ë³µ<em style="font-size:0.9em;">Burma Surrender</em>': [
                    'Rangoon',
                    'Mandalay',
                    'Lashio',
                    'Myitkyina'
                ],
                'ì¤‘êµ­ í•­ë³µ<em style="font-size:0.9em;">China Surrender</em>': [
                    'Lashio',
                    'ì¤‘êµ­ ê³µì„¸<em style="font-size:0.9em;">China Offensive</em>',
                    'ì¤‘êµ­ ì´ë²¤íŠ¸'
                ],
                'ì¸ë„ í•­ë³µ<em style="font-size:0.9em;">India Surrender</em>': [
                    'Akyab',
                    'Imphal',
                    'Dimasur',
                    'Jarhat',
                    'Ledo',
                    'Dacca'
                ],
                'ë‰´ê¸°ë‹ˆ í•­ë³µ<em style="font-size:0.9em;">New Guinie Surrender</em>': [
                    'Biak',
                    'Vogelkop',
                    'Hollandia',
                    'Lae',
                    'Buna',
                    'Wewak',
                    'Gili-Gili',
                    'Port Moresby'

                ],
                'í•­êµ¬ ì¦ì›[5]<em style="font-size:0.9em;">Reinforce Ports</em>': [
                    'Truk',
                    'Rabaul',
                    'Saipan',
                    'Davao',
                    'Saigon',
                    'Eniwetok',
                    'Kwajalein',
                    'Palau Islands',
                    'Timor',
                    'Kendari',
                    'Soerabja',
                    'Balikpapan',
                    'Tarakan',
                    'Rangoon',
                    'Mandalay',
                    'Lashio'
                ],
                'ìì› í™•ë³´': [
                    'Seoul',
                    'Manila',
                    'Kuantan',
                    'ëª¨ë“  DEI ìì›',
                    'Vogelkop',
                    'Rangoon'
                ],
                'ë‚¨íƒœí‰ì–‘ ì¸¡ë©´<em style="font-size:0.9em;">South Pacific Flank</em>': [
                    'Hollandia',
                    'Lae',
                    'Buna',
                    'Biak',
                    'Wewak',
                    'Buin'
                ]
            };
        
            // ì •ì˜
            const conditions = {
                'A': 'ì¼ë³¸ì´ ì¹´ë“œë¥¼ 3ì¥ ì´ìƒ ê°€ì§€ê³  ìˆìŠµë‹ˆê¹Œ?',
                'B': 'ì¼ë³¸ì´ PASSë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?',
                'C': 'ì¼ë³¸ì´ í†µì œControlí•˜ëŠ” ìì› í—¥ìŠ¤ê°€ 13ê°œ ë¯¸ë§Œì…ë‹ˆê¹Œ?',
                'D': 'ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 20 ì´ìƒì…ë‹ˆê¹Œ?',
                'E': 'ë¯¸êµ­ì˜ PWê°€ 4ë¯¸ë§Œì…ë‹ˆê¹Œ?',
                'F': 'ë²„ë§ˆê°€ í•­ë³µí–ˆìŠµë‹ˆê¹Œ?',
                'G': 'ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 15 ì´ìƒì…ë‹ˆê¹Œ?',
                'H': 'ê°„ë”” ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?',
                'I': 'ì¼ë³¸ì´ ì—°í•©êµ°ë³´ë‹¤ ë²„ë§ˆ/ì¸ë„ ë¶ë¶€ì— ë” ë§ì€ ëŒ€ê·œëª¨ êµ°ëŒ€ ì§€ìƒ ìœ ë‹› ìŠ¤í…ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆê¹Œ?<br>ëŒ€ê·œëª¨ ì§€ìƒ ìœ ë‹› ìŠ¤í…: ì´ ë°©ì–´ë ¥ì´ 12 ì´ìƒì¸ ìŠ¤í…ë“¤ë§Œ í•´ë‹¹',
                'J': 'ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 18 ì´ìƒì…ë‹ˆê¹Œ?'
            };
        
            let currentStep = 'start';
            let pathHistory = [];
            let stepCount = 0;
            let evaluatedConditions = {};
        
            // Helper function to create missing DOM elements
            function createMissingElement(id, tag, parent, classes = []) {
                let element = document.getElementById(id);
                if (!element) {
                    console.warn(`Creating missing element: ${id}`);
                    element = document.createElement(tag);
                    element.id = id;
                    classes.forEach(cls => element.classList.add(cls));
                    if (parent && parent.appendChild) {
                        parent.appendChild(element);
                    } else {
                        document.body.appendChild(element);
                    }
                }
                return element;
            }
        
            function startFlow() {
                currentStep = 'A';
                stepCount = 1;
                pathHistory = [];
                evaluatedConditions = {};
                showStep('A');
            }
        
            function showStep(stepId) {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const stepNumber = createMissingElement('stepNumber', 'div', stepSection);
                const stepTitle = createMissingElement('stepTitle', 'h2', stepSection);
                const conditionBox = createMissingElement('conditionBox', 'div', stepSection);
                const buttonGroup = createMissingElement('buttonGroup', 'div', stepSection);
        
                if (errorContainer) errorContainer.classList.add('hidden');
        
                stepNumber.textContent = stepCount;
        
                if (stepId === 'DICE') {
                    const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                    const diceResult = createMissingElement('diceResult', 'div', diceSection);
                    stepSection.classList.add('hidden');
                    diceSection.classList.remove('hidden');
                    diceResult.textContent = '-';
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                    return;
                }
        
                // ë³µí•© ì¡°ê±´ë“¤ ì²˜ë¦¬ (e.g., (H or I) + J)
                if (stepId === '(H or I) + J_CHECK') {
                    showComplexConditionStep(stepId);
                    return;
                }
        
                // ê¸°ë³¸ ì¡°ê±´ë“¤ ì²˜ë¦¬
                if (conditions[stepId]) {
                    stepTitle.textContent = `${stepId} í™•ì¸`;
                    conditionBox.innerHTML = ` ${conditions[stepId]}`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                        <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'start') {
                    stepTitle.textContent = 'ì‹œì‘';
                    conditionBox.innerHTML = `ì „ìŸ ì¤‘ê¸° í˜ì´ì¦ˆ`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                    `;
                }
        
                updateProgress();
                updatePathHistory();
            }
        
            function selectChoice(conditionId, choice) {
                evaluatedConditions[conditionId] = choice;
                pathHistory.push({ step: conditionId, choice: choice, stepNum: stepCount });
                stepCount++;
        
                const nextStep = getNextStep(conditionId, choice);
        
                if (nextStep.startsWith('STRATEGY_')) {
                    const strategy = nextStep.replace('STRATEGY_', '');
                    showResult(strategy);
                } else {
                    currentStep = nextStep;
                    showStep(nextStep);
                }
            }
        
            function getNextStep(conditionId, choice) {
                switch (conditionId) {
                    case 'A':
                        return choice ? 'C' : 'B';
                    case 'B':
                        return choice ? 'STRATEGY_Pass' : 'STRATEGY_Event Strategy';
                    case 'C':
                        return choice ? 'STRATEGY_Resource Strategy' : 'D';
                    case 'D':
                        return choice ? 'E' : 'G';
                    case 'E':
                        return choice ? 'STRATEGY_Central Pacific Strategy' : 'F';
                    case 'F':
                        return choice ? '(H or I) + J_CHECK' : 'STRATEGY_CBI Strategy';
                    case 'G':
                        return choice ? 'F' : 'STRATEGY_Defense Perimeter Strategy';
                    case '(H or I) + J_CHECK':
                        return choice ? 'STRATEGY_India Strategy' : 'STRATEGY_Defense Perimeter Strategy';
                    default:
                        return 'STRATEGY_Defense Perimeter Strategy';
                }
            }
        
            function rollDice() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const diceResult = createMissingElement('diceResult', 'div', diceSection);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                const diceValue = Math.floor(Math.random() * 10); // 0-9
                diceResult.textContent = diceValue;
        
                let strategy;
                if (diceValue >= 0 && diceValue <= 2) {
                    strategy = 'Event Strategy';
                } else if (diceValue >= 3 && diceValue <= 6) {
                    strategy = 'Central Pacific Strategy';
                } else if (diceValue >= 7 && diceValue <= 9) {
                    strategy = 'India Strategy';
                }
        
                pathHistory.push({
                    step: 'DICE',
                    choice: diceValue,
                    stepNum: stepCount,
                    isResult: true,
                    result: strategy
                });
        
                setTimeout(() => showResult(strategy), 1000);
            }
        
            function showResult(strategyKey) {
                const strategy = strategies[strategyKey];
                if (!strategy) {
                    console.error('Strategy not found:', strategyKey);
                    return;
                }
        
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                const strategyName = createMissingElement('strategyName', 'h2', resultSection);
                const strategyDetails = createMissingElement('strategyDetails', 'div', resultSection);
                const buttonGroup = resultSection.querySelector('.button-group') || createMissingElement('button-group', 'div', resultSection, ['button-group']);
        
                if (errorContainer) errorContainer.classList.add('hidden');
        
                stepSection.classList.add('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.remove('hidden');
                strategyName.textContent = strategy.name;
        
                // Extract annotations from strategy name, details, and sub-priorities
                const annotationRegex = /\[\d+\]/g;
                const annotations = new Set();
                if (strategy.name.match(annotationRegex)) {
                    strategy.name.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                }
                strategy.details.forEach(detail => {
                    if (detail.match(annotationRegex)) {
                        detail.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                    }
                    // Check sub-priorities for annotations
                    if (subPriorities[detail]) {
                        subPriorities[detail].forEach(sub => {
                            if (sub.match(annotationRegex)) {
                                sub.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                            }
                        });
                    }
                });
        
                strategyDetails.innerHTML = `
                    <h4 style="margin-top: 0; color: #fff;">ì „ëµ ìš°ì„ ìˆœìœ„:</h4>
                    <ul class="strategy-list">
                        ${strategy.details.map(detail => `
                            <li>
                                ${detail}
                                ${subPriorities[detail] ? `
                                    <ul class="sub-priority-list">
                                        ${subPriorities[detail].map(sub => `<li>${sub}</li>`).join('')}
                                    </ul>
                                ` : ''}
                            </li>
                        `).join('')}
                    </ul>
                    ${annotations.size > 0 ? `
                        <h4 style="margin-top: 20px; color: #fff;">ì£¼ì„:</h4>
                        <ul class="strategy-list">
                            ${Array.from(annotations).sort().map(annotation => `
                                <li class="impl-note">${annotation}: ${notes[annotation]}</li>
                            `).join('')}
                        </ul>
                    ` : ''}
                `;
        
                buttonGroup.innerHTML = `
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;
        
                updateProgress();
                updatePathHistory();
            }
        
            function updateProgress() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const progressBar = createMissingElement('progress-bar', 'div', document.body, ['progress-bar']);
                const progressFill = createMissingElement('progressFill', 'div', progressBar, ['progress-fill']);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                const totalSteps = 15; // ëŒ€ëµì ì¸ ìµœëŒ€ ë‹¨ê³„ ìˆ˜
                const progress = Math.min((stepCount / totalSteps) * 100, 100);
                progressFill.style.width = progress + '%';
            }
        
            function updatePathHistory() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const pathHistoryDiv = createMissingElement('pathHistory', 'div', document.body, ['hidden']);
                const pathStepsDiv = createMissingElement('pathSteps', 'div', pathHistoryDiv);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                if (pathHistory.length === 0) {
                    pathHistoryDiv.classList.add('hidden');
                    return;
                }
        
                pathStepsDiv.innerHTML = '';
        
                pathHistory.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = `path-step ${step.choice && step.step !== 'DICE' ? 'yes' : step.step !== 'DICE' ? 'no' : ''}`;
        
                    if (step.step === 'DICE') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice}</div>
                            <div>
                                <strong>ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°:</strong> ${step.choice} 
                                ${step.result ? `â†’ ${strategies[step.result].name}` : ''}
                            </div>
                        `;
                    } else {
                        let conditionText = '';
                        if (conditions[step.step]) {
                            conditionText = conditions[step.step];
                        } else if (step.step === '(H or I) + J_CHECK') {
                            conditionText = 'H ë˜ëŠ” Iê°€ ì°¸ì´ê³  Jê°€ ì°¸ì…ë‹ˆê¹Œ?';
                        } else {
                            conditionText = step.step;
                        }
        
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice ? 'Y' : 'N'}</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ${conditionText} â†’ ${step.choice ? 'YES' : 'NO'}
                            </div>
                        `;
                    }
        
                    pathStepsDiv.appendChild(stepDiv);
                });
        
                pathHistoryDiv.classList.remove('hidden');
            }
        
            function resetFlow() {
                currentStep = 'start';
                stepCount = 0;
                pathHistory = [];
                evaluatedConditions = {};
        
                // Step 1: Create top-level elements
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                const pathHistoryDiv = createMissingElement('pathHistory', 'div', document.body, ['hidden']);
                const progressBar = createMissingElement('progress-bar', 'div', document.body, ['progress-bar']);
        
                // Step 2: Create child elements that depend on top-level elements
                const elements = {
                    errorContainer,
                    stepSection,
                    diceSection,
                    resultSection,
                    pathHistoryDiv,
                    progressBar,
                    stepNumber: createMissingElement('stepNumber', 'div', stepSection),
                    stepTitle: createMissingElement('stepTitle', 'h2', stepSection),
                    conditionBox: createMissingElement('conditionBox', 'div', stepSection),
                    buttonGroup: createMissingElement('buttonGroup', 'div', stepSection),
                    progressFill: createMissingElement('progressFill', 'div', progressBar, ['progress-fill']),
                    pathSteps: createMissingElement('pathSteps', 'div', pathHistoryDiv),
                    strategyName: createMissingElement('strategyName', 'h2', resultSection),
                    strategyDetails: createMissingElement('strategyDetails', 'div', resultSection),
                    diceResult: createMissingElement('diceResult', 'div', diceSection)
                };
        
                const createdElements = Object.keys(elements).filter(key => {
                    const element = document.getElementById(elements[key].id);
                    return element && element !== document.getElementById(key); // Check if element was newly created
                });
        
                if (createdElements.length > 0) {
                    console.warn('Created missing DOM elements in resetFlow:', createdElements);
                    console.warn('To avoid dynamic creation, add the following to your HTML:', createdElements.map(id => `<div id="${id}"></div>`).join('\n'));
                    if (elements.errorContainer) {
                        // elements.errorContainer.innerHTML = `ê²½ê³ : ë‹¤ìŒ HTML ìš”ì†Œê°€ ëˆ„ë½ë˜ì–´ ë™ì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${createdElements.join(', ')}. HTMLì— ì¶”ê°€í•˜ì„¸ìš”.`;
                        elements.errorContainer.classList.remove('hidden');
                    }
                } else if (elements.errorContainer) {
                    elements.errorContainer.classList.add('hidden');
                }
        
                if (elements.stepSection) elements.stepSection.classList.remove('hidden');
                if (elements.diceSection) elements.diceSection.classList.add('hidden');
                if (elements.resultSection) elements.resultSection.classList.add('hidden');
                if (elements.pathHistoryDiv) elements.pathHistoryDiv.classList.add('hidden');
                if (elements.stepNumber) elements.stepNumber.textContent = '1';
                if (elements.stepTitle) elements.stepTitle.textContent = 'ì‹œì‘';
                if (elements.conditionBox) elements.conditionBox.innerHTML = 'ì—ë¼ìŠ¤ë¬´ìŠ¤ì˜ ì „ìŸ ì¤‘ê¸° ì „ëµì„ ê²°ì •í•©ë‹ˆë‹¤';
                if (elements.buttonGroup) elements.buttonGroup.innerHTML = '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>';
                if (elements.progressFill) elements.progressFill.style.width = '0%';
            }
        
            function goBack() {
                if (pathHistory.length === 0) {
                    resetFlow();
                    return;
                }
        
                // Remove the last step from history
                const lastStep = pathHistory.pop();
                stepCount--;
        
                // Remove the last evaluated condition
                if (lastStep.step !== 'DICE') {
                    delete evaluatedConditions[lastStep.step];
                }
        
                // Determine the previous step
                if (pathHistory.length === 0) {
                    currentStep = 'start';
                } else {
                    currentStep = pathHistory[pathHistory.length - 1].step;
                    // If the last step was DICE, we need to go back to the step before DICE
                    if (lastStep.step === 'DICE') {
                        currentStep = pathHistory.length > 0 ? pathHistory[pathHistory.length - 1].step : 'start';
                        pathHistory.pop(); // Remove the step before DICE as well
                        stepCount--;
                        if (pathHistory.length > 0) {
                            delete evaluatedConditions[pathHistory[pathHistory.length - 1].step];
                        }
                    }
                }
        
                // Update UI
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                showStep(currentStep);
            }
        
            function showComplexConditionStep(stepId) {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const stepNumber = createMissingElement('stepNumber', 'div', stepSection);
                const stepTitle = createMissingElement('stepTitle', 'h2', stepSection);
                const conditionBox = createMissingElement('conditionBox', 'div', stepSection);
                const buttonGroup = createMissingElement('buttonGroup', 'div', stepSection);
                if (errorContainer) errorContainer.classList.add('hidden');
        
                stepNumber.textContent = stepCount;
        
                let conditionText = '';
                let displayTitle = '';
        
                if (stepId === '(H or I) + J_CHECK') {
                    displayTitle = '(H or I) + J';
                    conditionText = '<br>ë‹¤ìŒ ì¡°ê±´ì„ ì¶©ì¡±í•©ë‹ˆê¹Œ? <li>H: ê°„ë”” ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?</li> <li>I: ì¼ë³¸ì´ ì—°í•©êµ°ë³´ë‹¤ ë²„ë§ˆ/ì¸ë„ ë¶ë¶€ì— ë” ë§ì€ ëŒ€ê·œëª¨ êµ°ëŒ€ ì§€ìƒ ìœ ë‹› ìŠ¤í…ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆê¹Œ?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ëŒ€ê·œëª¨ ì§€ìƒ ìœ ë‹› ìŠ¤í…: ì´ ë°©ì–´ë ¥ì´ 12 ì´ìƒì¸ ìŠ¤í…ë“¤ë§Œ í•´ë‹¹)</li> <li>J: ë³‘ì°¸ í‰ê°€ ìˆ˜ì¹˜ê°€ 18 ì´ìƒì…ë‹ˆê¹Œ?</li>';
                }
        
                stepTitle.textContent = displayTitle;
                conditionBox.innerHTML = ` ${conditionText}`;
                buttonGroup.innerHTML = `
                    <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                    <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;
        
                updateProgress();
                updatePathHistory();
            }
        
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
            window.onload = function () {
                if (document.readyState === 'complete') {
                    resetFlow();
                } else {
                    window.addEventListener('DOMContentLoaded', resetFlow);
                }
            };
        </script>
    </body>
    </html>
  </template>

  <!-- 3. ì „ìŸ ë§ê¸° -->
  <template id="tmpl-late">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Japanese Erasmus Bot -  ì „ìŸ ë§ê¸°</title>
        <!-- ì—°í•©êµ°ì´ ë„ì¿„ 8í—¥ìŠ¤ ì´ë‚´ì— ìˆëŠ” í•­êµ¬ë¥¼ ì ë ¹í–ˆì„ ë•Œë§Œ ì´ ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ë”°ë¦…ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° ì „ìŸ ì¤‘ê¸° ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤ -->
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #2e2e2e;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
                color: #d8d8d8;
            }
        
            .impl-note {
                font-style: italic;
                font-size: 14px;
                color: #ffffff;
                line-height: 1.6;
                margin: 4px 0;
            }
        
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
        
            .header {
                text-align: center;
                margin-bottom: 20px;
                padding: 15px;
                background: #4a4a4a;
                border-radius: 8px;
                color: #ffffff;
                border: 1px solid #5c5c5c;
            }
        
            .header h1 {
                margin: 0;
                font-size: 2rem;
                font-weight: 700;
            }
        
            .header p {
                margin: 8px 0 0 0;
                font-size: 1rem;
                font-weight: 400;
            }
        
            .progress-bar {
                background: #4a4a4a;
                border-radius: 5px;
                height: 6px;
                margin-bottom: 20px;
                overflow: hidden;
                border: 1px solid #5c5c5c;
            }
        
            .progress-fill {
                background: #4682b4;
                height: 100%;
                border-radius: 5px;
                transition: width 0.3s ease;
                width: 0%;
            }
        
            .step-section {
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid #5c5c5c;
            }
        
            .step-header {
                display: flex;
                align-items: center;
                margin-bottom: 15px;
            }
        
            .step-number {
                background: #4682b4;
                color: #ffffff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1rem;
                margin-right: 15px;
            }
        
            .step-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: #d8d8d8;
                margin: 0;
            }
        
            .condition-box {
                background: #4a4a4a;
                border-left: 4px solid #4682b4;
                border-radius: 5px;
                padding: 15px;
                margin: 15px 0;
                font-size: 1rem;
                line-height: 1.5;
                color: #c8c8c8;
            }
        
            .condition-box strong {
                color: #4682b4;
                font-size: 1.1rem;
            }
        
            .button-group {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 20px;
            }
        
            .btn {
                padding: 10px 30px;
                border: none;
                border-radius: 5px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s ease, transform 0.1s ease;
                text-transform: uppercase;
                min-width: 100px;
                font-family: 'Georgia', 'Times New Roman', Times, serif;
            }
        
            .btn-yes {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .btn-yes:hover {
                background: #257a4b;
                transform: translateY(-2px);
            }
        
            .btn-no {
                background: #696969;
                color: #ffffff;
            }
        
            .btn-no:hover {
                background: #585858;
                transform: translateY(-2px);
            }
        
            .btn-primary {
                background: #4682b4;
                color: #ffffff;
            }
        
            .btn-primary:hover {
                background: #3a6b9a;
                transform: translateY(-2px);
            }
        
            .btn-secondary {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-secondary:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .btn-back {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-back:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .path-history {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 15px;
                border-left: 3px solid #2e8b57;
            }
        
            .path-step {
                display: flex;
                align-items: center;
                margin: 8px 0;
                padding: 8px;
                background: #3c3c3c;
                border-radius: 5px;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }
        
            .path-step .step-icon {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 10px;
                font-size: 0.8rem;
            }
        
            .path-step.yes .step-icon {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .path-step.no .step-icon {
                background: #696969;
                color: #ffffff;
            }
        
            .dice-section {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin: 15px 0;
                border: 1px solid #5c5c5c;
            }
        
            .dice-result {
                font-size: 3rem;
                font-weight: bold;
                color: #d8d8d8;
                margin: 15px 0;
            }
        
            .result-section {
                background: #2e8b57;
                color: #ffffff;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin-top: 15px;
                border: 1px solid #3c3c3c;
            }
        
            .result-section h2 {
                margin: 0 0 15px 0;
                font-size: 2rem;
                display: none;
            }
        
            .result-section p {
                margin: 10px 0;
                font-size: 32px;
                white-space: pre-line;
                font-weight: bold;
                font-style: italic;
            }
        
            .strategy-details {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                padding: 15px;
                margin-top: 15px;
            }
        
            .strategy-list {
                text-align: left;
                margin: 15px 0;
                list-style: none;
                padding: 0;
            }
        
            .strategy-list li {
                margin: 8px 0;
                padding: 8px 10px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 5px;
                border-left: 3px solid rgba(255, 255, 255, 0.3);
            }
        
            .sub-priority-list {
                list-style: none;
                padding-left: 20px;
                margin-top: 5px;
            }
        
            .sub-priority-list li {
                margin: 5px 0;
                padding: 5px 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                border-left: 2px solid rgba(255, 255, 255, 0.4);
                font-size: 0.9rem;
            }
        
            .hidden {
                display: none;
            }
        
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                    margin: 10px;
                }
                
                .header h1 {
                    font-size: 1.5rem;
                }
                
                .button-group {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn {
                    width: 100%;
                    max-width: 180px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ì „ìŸ ë§ê¸° í˜ì´ì¦ˆ</h1>
                <br>
                ì—°í•©êµ°ì´ ë„ì¿„ 8í—¥ìŠ¤ ì´ë‚´ì— ìˆëŠ” í•­êµ¬ë¥¼ ì ë ¹í–ˆì„ ë•Œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤. <br>ê·¸ì™¸ì—ëŠ” <b>ì „ìŸ ì¤‘ê¸° ì°¨íŠ¸</b>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="pathHistory" class="path-history hidden">
                <h4 style="margin-top: 0; color: #ffffff;">ì§„í–‰ ê²½ë¡œ</h4>
                <div id="pathSteps"></div>
            </div>

            <div id="stepSection" class="step-section">
                <div class="step-header">
                    <div class="step-number" id="stepNumber">1</div>
                    <h2 class="step-title" id="stepTitle">ì‹œì‘</h2>
                </div>
                
                <div class="condition-box" id="conditionBox">
                    ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>
                
                <div class="button-group" id="buttonGroup">
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>

            <div id="diceSection" class="dice-section hidden">
                <h3 style="margin: 0 0 20px 0; color: #2d3436;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (1d10)</h3>
                <div class="dice-result" id="diceResult">?</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="resultSection" class="result-section hidden">
                <h2 id="strategyTitle">ìµœì¢… ì „ëµ ê²°ì •</h2>
                <p id="strategyName"></p>
                <div class="strategy-details" id="strategyDetails"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <script>
            // Implementation notes
            const notes = {
                '[1]': 'ì¹´ë“œ ë° ì¡°ê±´ì´ ìˆë‹¤ë©´ ë‚˜ì—´ëœ ìˆœì„œëŒ€ë¡œ ì´ë²¤íŠ¸ë¥¼ í”Œë ˆì´í•©ë‹ˆë‹¤. 12ë²ˆ í„´ì—ëŠ” ì¹´ë“œë¥¼ ì ˆëŒ€ FOë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                '[2]': 'ì¼ë³¸ì´ í†µì œí•˜ëŠ” í—¥ìŠ¤ë§Œ ë³‘ë ¥ì´ ì£¼ë‘”í•˜ê³  ìˆëŠ” ê²ƒìœ¼ë¡œGarrisonë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.',
                '[3]': 'í˜¼ìŠˆì— ê³µì¤‘ ë˜ëŠ” í•´êµ° ë³´ì¶© ìœ ë‹›ì„ ë°°ì¹˜í•©ë‹ˆë‹¤. ê³µì¤‘ ìœ ë‹›ì„ ì‚¬ìš©í•´ì„œ í˜¼ìŠˆì— ìˆëŠ” ì¼ë³¸ ë³¸ë¶€ì™€ ì¼ë³¸ì´ í†µì œí•˜ëŠ” ìì› í—¥ìŠ¤ ì‚¬ì´ì˜ í†µì‹ ì„ (AZOI)ì„ ìœ ì§€í•©ë‹ˆë‹¤.',
                '[4]': 'í˜¼ìŠˆì— ìˆëŠ” ì—°í•©êµ° ì§€ìƒ ìœ ë‹›ì— ì¸ì ‘í•œ í—¥ìŠ¤ë¥¼ ëª¨ë‘ ì ë ¹í•  ë•Œê¹Œì§€ ì§€ìƒ ìœ ë‹›ì„ ì—°í•©êµ° ì§€ìƒ ìœ ë‹› ì¸ì ‘ í—¥ìŠ¤ë¡œ ì´ë™í•©ë‹ˆë‹¤.',
                '[5]': 'ì§€ìƒ ìœ ë‹›ì´ ìˆëŠ” í˜¼ìŠˆì˜ ê° í—¥ìŠ¤ë§ˆë‹¤, ê°€ëŠ¥í•˜ë‹¤ë©´ í•´ë‹¹ í—¥ìŠ¤ì— ê³µêµ° ë˜ëŠ” í•´êµ° ìœ ë‹› ë°°ì¹˜ë¥¼ ì‹œë„í•©ë‹ˆë‹¤.',
                '[6]': 'ì¼ë³¸ ì§€ìƒ ìœ ë‹›ì´ í˜¼ìŠˆì— ìˆëŠ” ì—°í•©êµ° ìœ ë‹›ê³¼ ì¸ì ‘í•œ ëª¨ë“  í—¥ìŠ¤ë¥¼ ì ë ¹í–ˆë‹¤ë©´, ê°€ëŠ¥í•œ ë§ì€ ìœ ë‹›ìœ¼ë¡œ ì—°í•©êµ° ì§€ìƒ ìœ ë‹›ì„ ê³µê²©í•©ë‹ˆë‹¤. ì„ íƒí•  ìˆ˜ ìˆë‹¤ë©´, ê°€ì¥ ê°•ë ¥í•œ ìœ ë‹›ì„ ë¨¼ì € ì‚¬ìš©í•©ë‹ˆë‹¤.',
                '[7]': 'í˜¼ìŠˆ ì „íˆ¬ í—¥ìŠ¤ë§ˆë‹¤, ê°€ëŠ¥í•˜ë‹¤ë©´ í•´ë‹¹ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ì§€ì›í•˜ë„ë¡ í•˜ë‚˜ì˜ ê³µêµ° ë˜ëŠ” í•´êµ° ìœ ë‹›ì„ ë°°ì¹˜í•©ë‹ˆë‹¤(í•´êµ°ì„ í—¥ìŠ¤ ì•ˆìœ¼ë¡œ ì´ë™ì‹œí‚¤ê±°ë‚˜, ê³µì¤‘ ìœ ë‹›ì´ ë²”ìœ„ ë‚´ì—ì„œ ê³µê²©í•˜ëŠ” ë°©ì‹).',
                '[8]': 'ë§ˆì§€ë§‰ ì§€ìƒ ìœ ë‹› ìŠ¤í…ê¹Œì§€ ì‹¸ì›ë‹ˆë‹¤.'
            };
        
            // ì „ëµ ì •ë³´ ë°ì´í„°
            const strategies = {
                'Event Strategy': {
                    name: 'ì´ë²¤íŠ¸ ì „ëµ[1]',
                    details: [
                        'ìì›[3]',
                        'ì—°í•©êµ°ì´ ì „ëµì  í•©ì˜ ìƒíƒœë©´ ISR ìƒì„±.',
                        'ì¼ë³¸ì´ ISRì´ë©´ ISR ì¢…ë£Œ',
                        'ë„ì¿„ ë¡œì¦ˆ ì´ë²¤íŠ¸ ë°œë™',
                        'ê°•ì œë¡œ ë„ì¡° ì´ë²¤íŠ¸ ë°œë™',
                        'ë§ˆì§€ë§‰ í„´ì´ ì•„ë‹ˆë¼ë©´, ë‚ ì”¨ ì¹´ë“œë¥¼ FOQë¡œ',
                        'ì´ë²¤íŠ¸ë¡œ í”Œë ˆì´í–ˆì„ ë•Œ ë¯¸êµ­ PWê°€ 0ì´ ë˜ì§€ ì•ŠëŠ” í•œ, ë„ì¡° ì¹´ë“œë¥¼ TOCë¡œ í”Œë ˆì´',
                        'ê¸°íƒ€: FOQê°€ ì—†ë‹¤ë©´ ì¹´ë“œë¥¼ FOQì— ë„£ìŒ'
                    ]
                },
                'Final Perimeter Strategy': {
                    name: 'ìµœì¢… ë°©ì–´ì„  ì „ëµ',
                    details: [
                        'í•­êµ¬ ì£¼ë‘”[2]',
                        'ê³µêµ° ê¸°ì§€ ì£¼ë‘”[2]',
                        'ì¼ë³¸ í•­êµ¬ ì£¼ë‘”[2]'
                    ]
                },
                'Final Defense Strategy': {
                    name: 'ìµœì¢… ë°©ì–´ ì „ëµ',
                    details: [
                        'ë³‘ë ¥ ì§‘ê²°[4]',
                        'ê³µì¤‘/í•´ìƒ ì§€ì›[5]',
                        'ë°˜ìì´ ëŒê²©[6][7][8]'
                    ]
                },
                'Pass': {
                    name: 'PASS (ì‘ì „ ì¤‘ì§€)',
                    details: [
                        'í–‰ë™ì„ íŒ¨ìŠ¤í•©ë‹ˆë‹¤'
                    ]
                }
            };
        
            // í•˜ìœ„ ìš°ì„ ìˆœìœ„ ëª©ë¡
            const subPriorities = {
                'ê³µêµ° ê¸°ì§€ ì£¼ë‘”[2]': [
                    'Iwo Jima',
                    'Kyoto'
                ],
                'í•­êµ¬ ì£¼ë‘”[2]': [
                    'Okinawa',
                    'Seoul',
                    'Pusan',
                    'Tainan',
                    'Saipan/Tinian'
                ],
                'ì¼ë³¸ í•­êµ¬ ì£¼ë‘”[2]': [
                    'Sasebo',
                    'Kure',
                    'Tokyo',
                    'Osaka',
                    'Nagoya',
                    'Ominato',
                    'Hakodate'
                ]
            };
        
            // ì •ì˜
            const conditions = {
                'A': 'ì¼ë³¸ì´ ê°€ì§„ ì¹´ë“œê°€ 3ì¥ ì´ìƒì…ë‹ˆê¹Œ?',
                'B': 'ë„ì¿„ì—ì„œ 8í—¥ìŠ¤ ì´ë‚´ì— ìˆê³  ì¤‘êµ­ í•­êµ¬ê°€ ì•„ë‹Œ í•­êµ¬ì— ë³‘ë ¥ì´ ì£¼ë‘”í•˜ê³  ìˆìŠµë‹ˆê¹Œ?[2]',
                'C': 'ë„ì¿„ì—ì„œ 5í—¥ìŠ¤ ì´ë‚´ì— ìˆê³  ì¤‘êµ­ ê³µêµ°ê¸°ì§€(í•­êµ¬ ì œì™¸)ê°€ ì•„ë‹Œ ê³µêµ°ê¸°ì§€ì— ë³‘ë ¥ì´ ì£¼ë‘”í•˜ê³  ìˆìŠµë‹ˆê¹Œ?[2]',
                'D': 'ì¼ë³¸ì—ê²Œ ì‚¬ìš© ê°€ëŠ¥í•œ PASSê°€ ë‚¨ì•„ ìˆìŠµë‹ˆê¹Œ?',
                'E': 'í˜¼ìŠˆì— ì—°í•©êµ° ì§€ìƒ ìœ ë‹›ì´ ìˆìŠµë‹ˆê¹Œ?'
            };
        
            let currentStep = 'start';
            let pathHistory = [];
            let stepCount = 0;
            let evaluatedConditions = {};
        
            // Helper function to create missing DOM elements
        function createMissingElement(id, tag, parent, classes = []) {
            let element = document.getElementById(id);
            if (!element) {
                console.warn(`Creating missing element: ${id}`);
                element = document.createElement(tag);
                element.id = id;
                classes.forEach(cls => element.classList.add(cls));
                if (parent && parent.appendChild) {
                    parent.appendChild(element);
                } else {
                    document.body.appendChild(element);
                }
            }
            return element;
        }

        function startFlow() {
            currentStep = 'A';
            stepCount = 1;
            pathHistory = [];
            evaluatedConditions = {};
            showStep('A');
        }

        function showStep(stepId) {
            const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
            const stepSection = createMissingElement('stepSection', 'div', document.body);
            const stepNumber = createMissingElement('stepNumber', 'div', stepSection);
            const stepTitle = createMissingElement('stepTitle', 'h2', stepSection);
            const conditionBox = createMissingElement('conditionBox', 'div', stepSection);
            const buttonGroup = createMissingElement('buttonGroup', 'div', stepSection);

            if (errorContainer) errorContainer.classList.add('hidden');

            stepNumber.textContent = stepCount;

            if (stepId === 'B+C') {
                stepTitle.textContent = 'B+C í™•ì¸';
                conditionBox.innerHTML = ` <br>ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <ul><li>${conditions['B']}</li><li>${conditions['C']}</li></ul>`;
                buttonGroup.innerHTML = `
                    <button class="btn btn-yes" onclick="selectChoice('B+C', true)">YES</button>
                    <button class="btn btn-no" onclick="selectChoice('B+C', false)">NO</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;
            } else if (stepId === 'DICE') {
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const diceResult = createMissingElement('diceResult', 'div', diceSection);
                stepSection.classList.add('hidden');
                diceSection.classList.remove('hidden');
                diceResult.textContent = '-';
                buttonGroup.innerHTML = `
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;
                return;
            } else if (conditions[stepId]) {
                stepTitle.textContent = `${stepId} í™•ì¸`;
                conditionBox.innerHTML = ` ${conditions[stepId]}`;
                buttonGroup.innerHTML = `
                    <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                    <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;
            } else if (stepId === 'start') {
                stepTitle.textContent = 'ì‹œì‘';
                conditionBox.innerHTML = `ì „ìŸ ë§ê¸° í˜ì´ì¦ˆ`;
                buttonGroup.innerHTML = `
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                `;
            }

            updateProgress();
            updatePathHistory();
        }

        function selectChoice(conditionId, choice) {
            evaluatedConditions[conditionId] = choice;
            pathHistory.push({ step: conditionId, choice: choice, stepNum: stepCount });
            stepCount++;

            const nextStep = getNextStep(conditionId, choice);

            if (nextStep.startsWith('STRATEGY_')) {
                const strategy = nextStep.replace('STRATEGY_', '');
                showResult(strategy);
            } else {
                currentStep = nextStep;
                showStep(nextStep);
            }
        }

        function getNextStep(conditionId, choice) {
            switch (conditionId) {
                case 'A':
                    return choice ? 'B+C' : 'STRATEGY_Event Strategy';
                case 'B+C':
                    return choice ? 'D' : 'STRATEGY_Final Perimeter Strategy';
                case 'D':
                    return choice ? 'STRATEGY_Pass' : 'E';
                case 'E':
                    return choice ? 'STRATEGY_Final Defense Strategy' : 'STRATEGY_Event Strategy';
                default:
                    return 'STRATEGY_Event Strategy';
            }
        }

        function rollDice() {
            const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
            const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
            const diceResult = createMissingElement('diceResult', 'div', diceSection);
            if (errorContainer) errorContainer.classList.add('hidden');

            const diceValue = Math.floor(Math.random() * 10); // 0-9
            diceResult.textContent = diceValue;

            let strategy;
            if (diceValue >= 0 && diceValue <= 3) {
                strategy = 'Event Strategy';
            } else if (diceValue >= 4 && diceValue <= 7) {
                strategy = 'Final Perimeter Strategy';
            } else if (diceValue >= 8 && diceValue <= 9) {
                strategy = 'Final Defense Strategy';
            }

            pathHistory.push({
                step: 'DICE',
                choice: diceValue,
                stepNum: stepCount,
                isResult: true,
                result: strategy
            });

            setTimeout(() => showResult(strategy), 1000);
        }

        function showResult(strategyKey) {
            const strategy = strategies[strategyKey];
            if (!strategy) {
                console.error('Strategy not found:', strategyKey);
                return;
            }

            const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
            const stepSection = createMissingElement('stepSection', 'div', document.body);
            const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
            const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
            const strategyName = createMissingElement('strategyName', 'h2', resultSection);
            const strategyDetails = createMissingElement('strategyDetails', 'div', resultSection);
            const buttonGroup = resultSection.querySelector('.button-group') || createMissingElement('button-group', 'div', resultSection, ['button-group']);

            if (errorContainer) errorContainer.classList.add('hidden');

            stepSection.classList.add('hidden');
            diceSection.classList.add('hidden');
            resultSection.classList.remove('hidden');
            strategyName.textContent = strategy.name;

            // Extract annotations from strategy name, details, and sub-priorities
            const annotationRegex = /\[\d+\]/g;
            const annotations = new Set();
            if (strategy.name.match(annotationRegex)) {
                strategy.name.match(annotationRegex).forEach(annotation => annotations.add(annotation));
            }
            strategy.details.forEach(detail => {
                if (detail.match(annotationRegex)) {
                    detail.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                }
                // Check sub-priorities for annotations
                if (subPriorities[detail]) {
                    subPriorities[detail].forEach(sub => {
                        if (sub.match(annotationRegex)) {
                            sub.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                        }
                    });
                }
            });

            strategyDetails.innerHTML = `
                <h4 style="margin-top: 0; color: #fff;">ì „ëµ ì„¸ë¶€ì‚¬í•­:</h4>
                <ul class="strategy-list">
                    ${strategy.details.map(detail => `
                        <li>
                            ${detail}
                            ${subPriorities[detail] ? `
                                <ul class="sub-priority-list">
                                    ${subPriorities[detail].map(sub => `<li>${sub}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </li>
                    `).join('')}
                </ul>
                ${annotations.size > 0 ? `
                    <h4 style="margin-top: 20px; color: #fff;">ì£¼ì„:</h4>
                    <ul class="strategy-list">
                        ${Array.from(annotations).sort().map(annotation => `
                            <li class="impl-note">${annotation}: ${notes[annotation]}</li>
                        `).join('')}
                    </ul>
                ` : ''}
            `;

            buttonGroup.innerHTML = `
                <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
            `;

            updateProgress();
            updatePathHistory();
        }

        function updateProgress() {
            const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
            const progressBar = createMissingElement('progress-bar', 'div', document.body, ['progress-bar']);
            const progressFill = createMissingElement('progressFill', 'div', progressBar, ['progress-fill']);
            if (errorContainer) errorContainer.classList.add('hidden');

            const totalSteps = 5; // ëŒ€ëµì ì¸ ìµœëŒ€ ë‹¨ê³„ ìˆ˜ (A, B+C, D, E)
            const progress = Math.min((stepCount / totalSteps) * 100, 100);
            progressFill.style.width = progress + '%';
        }

        function updatePathHistory() {
            const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
            const pathHistoryDiv = createMissingElement('pathHistory', 'div', document.body, ['hidden']);
            const pathStepsDiv = createMissingElement('pathSteps', 'div', pathHistoryDiv);
            if (errorContainer) errorContainer.classList.add('hidden');

            if (pathHistory.length === 0) {
                pathHistoryDiv.classList.add('hidden');
                return;
            }

            pathStepsDiv.innerHTML = '';

            pathHistory.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = `path-step ${step.choice && step.step !== 'DICE' ? 'yes' : step.step !== 'DICE' ? 'no' : ''}`;

                if (step.step === 'DICE') {
                    stepDiv.innerHTML = `
                        <div class="step-icon">${step.choice}</div>
                        <div>
                            <strong>ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°:</strong> ${step.choice} 
                            ${step.result ? `â†’ ${strategies[step.result].name}` : ''}
                        </div>
                    `;
                } else {
                    let conditionText = '';
                    if (conditions[step.step]) {
                        conditionText = conditions[step.step];
                    } else if (step.step === 'B+C') {
                        conditionText = 'ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <ul><li>í˜¼ìŠˆì— ì¼ë³¸ ì§€ìƒ ìœ ë‹›ì´ ì—°í•©êµ° ìœ ë‹›ê³¼ ì¸ì ‘í•œ í—¥ìŠ¤ë¥¼ ëª¨ë‘ ì ë ¹í–ˆìŠµë‹ˆê¹Œ?</li><li>í˜„ì¬ í„´ì´ 12ë²ˆ í„´ì…ë‹ˆê¹Œ?</li></ul>';
                    }

                    stepDiv.innerHTML = `
                        <div class="step-icon">${step.choice ? 'Y' : 'N'}</div>
                        <div>
                            <strong>${step.step}:</strong> 
                            ${conditionText} â†’ ${step.choice ? 'YES' : 'NO'}
                        </div>
                    `;

                    pathStepsDiv.appendChild(stepDiv);
                }
            });

            pathHistoryDiv.classList.remove('hidden');
        }

        function resetFlow() {
            currentStep = 'start';
            stepCount = 0;
            pathHistory = [];
            evaluatedConditions = {};

            // Step 1: Create top-level elements
            const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
            const stepSection = createMissingElement('stepSection', 'div', document.body);
            const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
            const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
            const pathHistoryDiv = createMissingElement('pathHistory', 'div', document.body, ['hidden']);
            const progressBar = createMissingElement('progress-bar', 'div', document.body, ['progress-bar']);

            // Step 2: Create child elements that depend on top-level elements
            const elements = {
                errorContainer,
                stepSection,
                diceSection,
                resultSection,
                pathHistoryDiv,
                progressBar,
                stepNumber: createMissingElement('stepNumber', 'div', stepSection),
                stepTitle: createMissingElement('stepTitle', 'h2', stepSection),
                conditionBox: createMissingElement('conditionBox', 'div', stepSection),
                buttonGroup: createMissingElement('buttonGroup', 'div', stepSection),
                progressFill: createMissingElement('progressFill', 'div', progressBar, ['progress-fill']),
                pathSteps: createMissingElement('pathSteps', 'div', pathHistoryDiv),
                strategyName: createMissingElement('strategyName', 'h2', resultSection),
                strategyDetails: createMissingElement('strategyDetails', 'div', resultSection),
                diceResult: createMissingElement('diceResult', 'div', diceSection)
            };

            const createdElements = Object.keys(elements).filter(key => {
                const element = document.getElementById(elements[key].id);
                return element && element !== document.getElementById(key); // Check if element was newly created
            });

            if (createdElements.length > 0) {
                console.warn('Created missing DOM elements in resetFlow:', createdElements);
                console.warn('To avoid dynamic creation, add the following to your HTML:', createdElements.map(id => `<div id="${id}"></div>`).join('\n'));
                if (elements.errorContainer) {
                    // elements.errorContainer.innerHTML = `ê²½ê³ : ë‹¤ìŒ HTML ìš”ì†Œê°€ ëˆ„ë½ë˜ì–´ ë™ì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${createdElements.join(', ')}. HTMLì— ì¶”ê°€í•˜ì„¸ìš”.`;
                    elements.errorContainer.classList.remove('hidden');
                }
            } else if (elements.errorContainer) {
                elements.errorContainer.classList.add('hidden');
            }

            if (elements.stepSection) elements.stepSection.classList.remove('hidden');
            if (elements.diceSection) elements.diceSection.classList.add('hidden');
            if (elements.resultSection) elements.resultSection.classList.add('hidden');
            if (elements.pathHistoryDiv) elements.pathHistoryDiv.classList.add('hidden');
            if (elements.stepNumber) elements.stepNumber.textContent = '1';
            if (elements.stepTitle) elements.stepTitle.textContent = 'ì‹œì‘';
            if (elements.conditionBox) elements.conditionBox.innerHTML = 'ì—ë¼ìŠ¤ë¬´ìŠ¤ì˜ ì „ìŸ ë§ê¸° ì „ëµì„ ê²°ì •í•©ë‹ˆë‹¤';
            if (elements.buttonGroup) elements.buttonGroup.innerHTML = '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>';
            if (elements.progressFill) elements.progressFill.style.width = '0%';
        }

        function goBack() {
            if (pathHistory.length === 0) {
                resetFlow();
                return;
            }

            // Remove the last step from history
            const lastStep = pathHistory.pop();
            stepCount--;

            // Remove the last evaluated condition
            if (lastStep.step !== 'DICE') {
                delete evaluatedConditions[lastStep.step];
            }

            // Determine the previous step
            if (pathHistory.length === 0) {
                currentStep = 'start';
            } else {
                currentStep = pathHistory[pathHistory.length - 1].step;
                // If the last step was DICE, we need to go back to the step before DICE
                if (lastStep.step === 'DICE') {
                    currentStep = pathHistory.length > 0 ? pathHistory[pathHistory.length - 1].step : 'start';
                    pathHistory.pop(); // Remove the step before DICE as well
                    stepCount--;
                    if (pathHistory.length > 0) {
                        delete evaluatedConditions[pathHistory[pathHistory.length - 1].step];
                    }
                }
            }

            // Update UI
            const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
            const stepSection = createMissingElement('stepSection', 'div', document.body);
            const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
            const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
            if (errorContainer) errorContainer.classList.add('hidden');

            stepSection.classList.remove('hidden');
            diceSection.classList.add('hidden');
            resultSection.classList.add('hidden');
            showStep(currentStep);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function () {
            if (document.readyState === 'complete') {
                resetFlow();
            } else {
                window.addEventListener('DOMContentLoaded', resetFlow);
            }
        };
    </script>
    </body>
    </html>
  </template>

  <!-- 4. ì¹´ë“œ ì„ íƒ -->
  <template id="tmpl-card">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Japanese Erasmus Bot - ì¹´ë“œ ì„ íƒ</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #2e2e2e;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
                color: #d8d8d8;
            }
        
            .impl-note {
                font-style: italic;
                font-size: 14px;
                color: #ffffff;
                line-height: 1.6;
                margin: 4px 0;
            }
        
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
        
            .header {
                text-align: center;
                margin-bottom: 20px;
                padding: 15px;
                background: #4a4a4a;
                border-radius: 8px;
                color: #ffffff;
                border: 1px solid #5c5c5c;
            }
        
            .header h1 {
                margin: 0;
                font-size: 2rem;
                font-weight: 700;
            }
        
            .header p {
                margin: 8px 0 0 0;
                font-size: 1rem;
                font-weight: 400;
            }
        
            .progress-bar {
                background: #4a4a4a;
                border-radius: 5px;
                height: 6px;
                margin-bottom: 20px;
                overflow: hidden;
                border: 1px solid #5c5c5c;
            }
        
            .progress-fill {
                background: #4682b4;
                height: 100%;
                border-radius: 5px;
                transition: width 0.3s ease;
                width: 0%;
            }
        
            .step-section {
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid #5c5c5c;
            }
        
            .step-header {
                display: flex;
                align-items: center;
                margin-bottom: 15px;
            }
        
            .step-number {
                background: #4682b4;
                color: #ffffff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1rem;
                margin-right: 15px;
            }
        
            .step-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: #d8d8d8;
                margin: 0;
            }
        
            .condition-box {
                background: #4a4a4a;
                border-left: 4px solid #4682b4;
                border-radius: 5px;
                padding: 15px;
                margin: 15px 0;
                font-size: 1rem;
                line-height: 1.5;
                color: #c8c8c8;
            }
        
            .condition-box strong {
                color: #4682b4;
                font-size: 1.1rem;
            }
        
            .button-group {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 20px;
            }
        
            .btn {
                padding: 10px 30px;
                border: none;
                border-radius: 5px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s ease, transform 0.1s ease;
                text-transform: uppercase;
                min-width: 100px;
                font-family: 'Georgia', 'Times New Roman', Times, serif;
            }
        
            .btn-yes {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .btn-yes:hover {
                background: #257a4b;
                transform: translateY(-2px);
            }
        
            .btn-no {
                background: #696969;
                color: #ffffff;
            }
        
            .btn-no:hover {
                background: #585858;
                transform: translateY(-2px);
            }
        
            .btn-primary {
                background: #4682b4;
                color: #ffffff;
            }
        
            .btn-primary:hover {
                background: #3a6b9a;
                transform: translateY(-2px);
            }
        
            .btn-secondary {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-secondary:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .btn-back {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-back:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .path-history {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 15px;
                border-left: 3px solid #2e8b57;
            }
        
            .path-step {
                display: flex;
                align-items: center;
                margin: 8px 0;
                padding: 8px;
                background: #3c3c3c;
                border-radius: 5px;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }
        
            .path-step .step-icon {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 10px;
                font-size: 0.8rem;
            }
        
            .path-step.yes .step-icon {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .path-step.no .step-icon {
                background: #696969;
                color: #ffffff;
            }
        
            .dice-section {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin: 15px 0;
                border: 1px solid #5c5c5c;
            }
        
            .dice-result {
                font-size: 3rem;
                font-weight: bold;
                color: #d8d8d8;
                margin: 15px 0;
            }
        
            .result-section {
                background: #2e8b57;
                color: #ffffff;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin-top: 15px;
                border: 1px solid #3c3c3c;
            }
        
            .result-section h2 {
                margin: 0 0 15px 0;
                font-size: 2rem;
                display: none;
            }
        
            .result-section p {
                margin: 10px 0;
                font-size: 32px;
                white-space: pre-line;
                font-weight: bold;
                font-style: italic;
            }
        
            .strategy-details {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                padding: 15px;
                margin-top: 15px;
            }
        
            .strategy-list {
                text-align: left;
                margin: 15px 0;
                list-style: none;
                padding: 0;
            }
        
            .strategy-list li {
                margin: 8px 0;
                padding: 8px 10px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 5px;
                border-left: 3px solid rgba(255, 255, 255, 0.3);
            }
        
            .sub-priority-list {
                list-style: none;
                padding-left: 20px;
                margin-top: 5px;
            }
        
            .sub-priority-list li {
                margin: 5px 0;
                padding: 5px 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                border-left: 2px solid rgba(255, 255, 255, 0.4);
                font-size: 0.9rem;
            }
        
            .hidden {
                display: none;
            }
        
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                    margin: 10px;
                }
                
                .header h1 {
                    font-size: 1.5rem;
                }
                
                .button-group {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn {
                    width: 100%;
                    max-width: 180px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ì¹´ë“œ ì„ íƒ</h1>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="pathHistory" class="path-history hidden">
                <h4 style="margin-top: 0; color: #ffffff;">ì§„í–‰ ê²½ë¡œ</h4>
                <div id="pathSteps"></div>
            </div>

            <div id="stepSection" class="step-section">
                <div class="step-header">
                    <div class="step-number" id="stepNumber">1</div>
                    <h2 class="step-title" id="stepTitle">ì‹œì‘</h2>
                </div>
                
                <div class="condition-box" id="conditionBox">
                    ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>
                
                <div class="button-group" id="buttonGroup">
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>

            <div id="diceSection" class="dice-section hidden">
                <h3 style="margin: 0 0 20px 0; color: #2d3436;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (1d10)</h3>
                <div class="dice-result" id="diceResult">?</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="resultSection" class="result-section hidden">
                <h2 id="strategyTitle">ìµœì¢… ì „ëµ ê²°ì •</h2>
                <p id="strategyName"></p>
                <div class="strategy-details" id="strategyDetails"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <script>
            const notes = {
                '[1]': 'ì¹´ë“œë¥¼ ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ ìˆœì„œë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë°°ì—´í•©ë‹ˆë‹¤: êµ°ì‚¬ ì´ë²¤íŠ¸, ëŒ€ì‘ ì´ë²¤íŠ¸, ìì› ì´ë²¤íŠ¸, ì •ì¹˜ ì´ë²¤íŠ¸. ë§ˆì§€ë§‰ ì¹´ë“œ ë‘ ì¥ì€ ë‹¤ìŒ ìˆœì„œì—ì„œ ê°€ì¥ ì¢‹ì€ ì´ë²¤íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤: ë„ì¿„ ë¡œì¦ˆ, ë„ì¡°, ìœ ëŸ½ ì „ìŸ, ì¼ë³¸êµ° ë‚´ë¶€ í•­ìŸ ì¢…ë£Œ, ë¯¸êµ° ë‚´ë¶€ í•­ìŸ ì‹œì‘, ë³´ì¶©, ë‚ ì”¨ ëŒ€ì‘. ê·¸ ì™¸ì˜ ì¹´ë“œëŠ” ë¬´ì‘ìœ„ë¡œ ì„ íƒí•˜ì„¸ìš”.',
                '[2]': 'ì¼ë³¸ ì—ë¼ìŠ¤ë¬´ìŠ¤ê°€ ì•„ì§ ì˜¤í”„ë‹ í˜ì´ì¦ˆì— ìˆê³ , ì „ëµì´ ì¤‘ë¶€ íƒœí‰ì–‘Central Pacific ë˜ëŠ” ë°©ì–´ ê²½ê³„Defensive Perimeterê±°ë‚˜, ëª©í‘œë¥¼ ë‹¬ì„±í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ë‚¨ì€ êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œ ê°€ ì•„ë‹ˆë¼ë©´ Operation MI ì¹´ë“œëŠ” ê³ ë ¤í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
                '[3]': 'ê³µì„¸ ë‹¨ê³„(Offensives Phase)ì˜ ì‹œì‘ì—ì„œ, ì •ë ¬ëœ ìˆœì„œì—ì„œ ì²« ë²ˆì§¸ ì¹´ë“œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.',
                '[4]': 'ì œí•œì—†ëŠ” êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œë€? í™œì„±í™” ì œí•œ(ì§€ìƒ, ê³µêµ°, í•´êµ°)ë„ ì—†ê³  ì „íˆ¬ í—¥ìŠ¤ ì œí•œë„ ì—†ëŠ” êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œì…ë‹ˆë‹¤. HQ ì œí•œì€ ë¬´ì‹œí•˜ì„¸ìš”.',
                '[5]': 'ì œí•œì  êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œë€? í™œì„±í™” ì œí•œ(ì§€ìƒ, ê³µêµ°, í•´êµ°) ë˜ëŠ” ì „íˆ¬ í—¥ìŠ¤ ì œí•œì´ ìˆëŠ” êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œì…ë‹ˆë‹¤. HQ ì œí•œì€ ë¬´ì‹œí•˜ì„¸ìš”.'
            };

            const strategies = {
                'First Strike EC Strategy': { 
                    name: 'ì²« íƒ€ê²© EC ì „ëµ', 
                    details: [
                        'ë‹¤ìŒ ìš°ì„  ìˆœìœ„ì— ë”°ë¼ ì‚¬ìš© ê°€ëŠ¥í•œ ì¹´ë“œ ì‚¬ìš©',
                        '1. Operation I-Go',
                        '2. 2nd Operational Phase'
                    ] 
                },
                'Unrestricted Event EC Strategy': { 
                    name: 'ì œí•œ ì—†ëŠ” ì´ë²¤íŠ¸ EC ì „ëµ[4]', 
                    details: [
                        'ê¸°ì¤€: ë³‘ì°¸ ê°’ì´ ê°€ì¥ ë†’ì€ ì¹´ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ë§Œì•½ ê³µì„¸ ë³´ë„ˆìŠ¤ê°€ ìˆë‹¤ë©´ ë‹¤ìŒ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì„ íƒí•©ë‹ˆë‹¤',
                        '1. ê³µìˆ˜ë¶€ëŒ€ ë³´ë„ˆìŠ¤',
                        '2. ë¹„-ê³µìˆ˜ë¶€ëŒ€ ë³´ë„ˆìŠ¤',
                        '3. ë³´ë„ˆìŠ¤ ì—†ìŒ'
                    ] 
                },
                'Restricted Event OC Strategy': { 
                    name: 'ì œí•œëœ ì´ë²¤íŠ¸ OC ì „ëµ[2][5]', 
                    details: [
                        'ê¸°ì¤€: ê°€ì¥ ë†’ì€ OC ê°’ì„ ê°€ì§„ ì¹´ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ë‹¨, ê·¸ê²ƒì´ êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œê³ , êµ°ì‚¬ ì´ë²¤íŠ¸ê°€ ì•„ë‹Œ ì¹´ë“œê°€ ìˆë‹¤ë©´(ê°’ê³¼ ê´€ê³„ì—†ì´), êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œëŠ” ì œì™¸í•˜ê³  OC ì¹´ë“œë¥¼ ë¬´ì‘ìœ„ë¡œ ì„ íƒí•©ë‹ˆë‹¤.'
                    ] 
                },
                'Restricted Event EC Strategy': { 
                    name: 'ì œí•œëœ ì´ë²¤íŠ¸ EC ì „ëµ[2][5]', 
                    details: [
                        'ê¸°ì¤€: ë³‘ì°¸ ê°’ì´ ê°€ì¥ ë†’ì€ ì¹´ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ë™ë¥ ì¼ ê²½ìš° ë³´ë„ˆìŠ¤ê°€ ì—†ëŠ” ì¹´ë“œë³´ë‹¤ ê³µì„¸ ë³´ë„ˆìŠ¤ ì¹´ë“œë“¤ì„ ìš°ì„  ì„ íƒí•©ë‹ˆë‹¤. ê·¸ ì™¸ì—ëŠ” ë¬´ì‘ìœ„ë¡œ ì„ íƒí•©ë‹ˆë‹¤.'
                    ] 
                },
                'Non-Military Event OC Strategy': { 
                    name: 'ë¹„êµ°ì‚¬ ì´ë²¤íŠ¸ OC ì „ëµ[3]', 
                    details: [
                        'ê¸°ì¤€: ê°€ì¥ ë†’ì€ OC ê°’ì„ ê°€ì§„ ì¹´ë“œë¥¼ ì„ íƒí•©ë‹ˆë‹¤'
                    ] 
                },
                'Play Card as Future Offensive': { 
                    name: 'ë¯¸ë˜ ê³µì„¸ ì¹´ë“œ í”Œë ˆì´', 
                    details: [
                        'ì¹´ë“œë¥¼ ë¯¸ë˜ ê³µì„¸ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤'
                    ] 
                },
                'Event Strategy': { 
                    name: 'ì´ë²¤íŠ¸ ì „ëµ', 
                    details: [
                        'ë‹¤ìŒ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ì¹´ë“œë¥¼ í”Œë ˆì´í•˜ì„¸ìš”:',
                        '1. ìœ ëŸ½ ì „ìŸ(War in Europe)',
                        '2. ë³‘ë ¥ ë³´ì¶©(Replacements)',
                        '3. ì¼ë³¸ ISR ì¢…ë£Œ',
                        '4. ë¯¸êµ° ISR ìƒì„±',
                        '5. ê¸°íƒ€ (ë¬´ì‘ìœ„)'
                    ] 
                },
                // 'Restricted Event As OC Strategy': { 
                //     name: 'ì œí•œëœ ì´ë²¤íŠ¸ OC ì „ëµ', 
                //     details: ['OC ê°€ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ì œí•œëœ ì´ë²¤íŠ¸ ì²˜ë¦¬'
                //     ] 
                // }
            };

            const conditions = {
                'A': 'ì´ë²ˆ ê³µì„¸ í˜ì´ì¦ˆ ë™ì•ˆ, ì¹´ë“œë¥¼ í•˜ë‚˜ë¼ë„ ì‚¬ìš©í–ˆìŠµë‹ˆê¹Œ?',
                'B': 'ì†íŒ¨ì— ì¹´ë“œê°€ 2ì¥ ì´ìƒ ìˆìŠµë‹ˆê¹Œ?',
                'C': 'ì´ ì¹´ë“œê°€ ì´ë²ˆ ê²Œì„ì—ì„œ ì²˜ìŒ ì‚¬ìš©í•˜ëŠ” ì¹´ë“œì…ë‹ˆê¹Œ?',
                'D': 'ì†íŒ¨ì— Operation I-GO ë˜ëŠ” 2ì°¨ ì‘ì „ ë‹¨ê³„ êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œê°€ ìˆìŠµë‹ˆê¹Œ?',
                'E': 'ì‚¬ìš© ê°€ëŠ¥í•œ ì œí•œì—†ëŠ”Unrestricted êµ°ì‚¬ ì´ë²¤íŠ¸ê°€ ìˆìŠµë‹ˆê¹Œ?',
                'F': 'ì‚¬ìš© ê°€ëŠ¥í•œ ì œí•œëœRestricted êµ°ì‚¬ ì´ë²¤íŠ¸ê°€ ìˆìŠµë‹ˆê¹Œ?',
                'G': 'ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  êµ°ì‚¬ ì´ë²¤íŠ¸ ì¹´ë“œ ì œí•œ ì‚¬í•­ ë•Œë¬¸ì— ì„ íƒí•œ ëŒ€ìƒì„ ê³µê²©í•˜ê±°ë‚˜ ì ë ¹í•  ìˆ˜ ì—†ìŠµë‹ˆê¹Œ?',
                'H': 'ì´ë²ˆ í„´ì— ë³´ê´€í•  FO ì¹´ë“œë¥¼ ì„ íƒí–ˆìŠµë‹ˆê¹Œ?',
                'I': 'DEI ëª©í‘œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆê¹Œ? (ì „ìŸ ì´ˆê¸°ì¸ ê²½ìš°ì—ë§Œ)',
                'J': 'ë‚¨ì€ ì¹´ë“œê°€ 1ì¥ ìˆìŠµë‹ˆê¹Œ?',
                'K': 'ë‚¨ì•„ìˆëŠ” ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ì¹´ë“œê°€ ëª¨ë‘ ëŒ€ì‘ ì¹´ë“œì…ë‹ˆê¹Œ?'
            };

            let currentStep = 'start';
            let pathHistory = [];
            let stepCount = 0;
            let evaluatedConditions = {};

            function createMissingElement(id, tag, parent, classes = []) {
                let element = document.getElementById(id);
                if (!element) {
                    element = document.createElement(tag);
                    element.id = id;
                    classes.forEach(cls => element.classList.add(cls));
                    if (parent && parent.appendChild) {
                        parent.appendChild(element);
                    } else {
                        document.body.appendChild(element);
                    }
                }
                return element;
            }

            function startFlow() {
                currentStep = 'A';
                stepCount = 1;
                pathHistory = [];
                evaluatedConditions = {};
                showStep('A');
            }

            function showStep(stepId) {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const stepNumber = createMissingElement('stepNumber', 'div', stepSection);
                const stepTitle = createMissingElement('stepTitle', 'h2', stepSection);
                const conditionBox = createMissingElement('conditionBox', 'div', stepSection);
                const buttonGroup = createMissingElement('buttonGroup', 'div', stepSection);

                if (errorContainer) errorContainer.classList.add('hidden');

                stepNumber.textContent = stepCount;

                if (stepId === 'Sort Cards') {
                    stepTitle.textContent = 'ì¹´ë“œ ì •ë ¬';
                    conditionBox.innerHTML = ` ì¹´ë“œë¥¼ ì •ë ¬í•©ë‹ˆë‹¤.[1]<br>ì¹´ë“œë¥¼ ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ ìˆœì„œë¡œ ë‹¤ìŒê³¼ ê°™ì´ ë°°ì—´í•©ë‹ˆë‹¤: êµ°ì‚¬ ì´ë²¤íŠ¸, ëŒ€ì‘ ì´ë²¤íŠ¸, ìì› ì´ë²¤íŠ¸, ì •ì¹˜ ì´ë²¤íŠ¸. ë§ˆì§€ë§‰ ì¹´ë“œ ë‘ ì¥ì€ ë‹¤ìŒ ìˆœì„œì—ì„œ ê°€ì¥ ì¢‹ì€ ì´ë²¤íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤: ë„ì¿„ ë¡œì¦ˆ, ë„ì¡°, ìœ ëŸ½ ì „ìŸ, ì¼ë³¸êµ° ë‚´ë¶€ í•­ìŸ ì¢…ë£Œ, ë¯¸êµ° ë‚´ë¶€ í•­ìŸ ì‹œì‘, ë³´ì¶©, ë‚ ì”¨ ëŒ€ì‘. ê·¸ ì™¸ì˜ ì¹´ë“œëŠ” ë¬´ì‘ìœ„ë¡œ ì„ íƒí•˜ì„¸ìš”.`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-continue" onclick="selectChoice('Sort Cards', true)">ê³„ì†</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (conditions[stepId]) {
                    stepTitle.textContent = `${stepId} í™•ì¸`;
                    conditionBox.innerHTML = ` ${conditions[stepId]}`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                        <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'start') {
                    stepTitle.textContent = 'ì‹œì‘';
                    conditionBox.innerHTML = `ì¹´ë“œ ì„ íƒ`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                    `;
                }

                updateProgress();
                updatePathHistory();
            }

            function selectChoice(conditionId, choice) {
                evaluatedConditions[conditionId] = choice;
                pathHistory.push({ step: conditionId, choice: choice, stepNum: stepCount });
                stepCount++;

                const nextStep = getNextStep(conditionId, choice);

                if (nextStep.startsWith('STRATEGY_')) {
                    const strategy = nextStep.replace('STRATEGY_', '');
                    showResult(strategy);
                } else if (nextStep) {
                    currentStep = nextStep;
                    showStep(nextStep);
                } else {
                    console.warn('No next step defined for', conditionId, choice);
                    showResult('Event Strategy'); // ê¸°ë³¸ ì „ëµìœ¼ë¡œ ì „í™˜
                }
            }

            function getNextStep(conditionId, choice) {
                switch (conditionId) {
                    case 'A':
                        return choice ? 'B' : 'Sort Cards'; // ìˆ˜ì •: Aê°€ trueë©´ B, falseë©´ Sort Cards
                    case 'Sort Cards':
                        return 'B';
                    case 'B':
                        return choice ? 'C' : 'H';
                    case 'C':
                        return choice ? 'D' : 'E';
                    case 'D':
                        return choice ? 'STRATEGY_First Strike EC Strategy' : 'E';
                    case 'E':
                        return choice ? 'STRATEGY_Unrestricted Event EC Strategy' : 'F';
                    case 'F':
                        return choice ? 'G' : 'STRATEGY_Non-Military Event OC Strategy';
                    case 'G':
                        return choice ? 'STRATEGY_Restricted Event OC Strategy' : 'STRATEGY_Restricted Event EC Strategy';
                    case 'H':
                        return choice ? 'STRATEGY_Non-Military Event OC Strategy' : 'I';
                    case 'I':
                        return choice ? 'J' : 'STRATEGY_Non-Military Event OC Strategy';
                    case 'J':
                        return choice ? 'STRATEGY_Play Card as Future Offensive' : 'K';
                    case 'K':
                        return choice ? 'STRATEGY_Non-Military Event OC Strategy' : 'STRATEGY_Event Strategy';
                    default:
                        return 'STRATEGY_Event Strategy';
                }
            }

            function rollDice() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const diceResult = createMissingElement('diceResult', 'div', diceSection);
                if (errorContainer) errorContainer.classList.add('hidden');

                const diceValue = Math.floor(Math.random() * 10);
                diceResult.textContent = diceValue;

                let strategy;
                if (diceValue >= 0 && diceValue <= 3) {
                    strategy = 'Event Strategy';
                } else if (diceValue >= 4 && diceValue <= 7) {
                    strategy = 'Non-Military Event OC Strategy';
                } else if (diceValue >= 8 && diceValue <= 9) {
                    strategy = 'First Strike EC Strategy';
                }

                pathHistory.push({
                    step: 'DICE',
                    choice: diceValue,
                    stepNum: stepCount,
                    isResult: true,
                    result: strategy
                });

                setTimeout(() => showResult(strategy), 1000);
            }

            function showResult(strategyKey) {
                const strategy = strategies[strategyKey];
                if (!strategy) {
                    console.error('Strategy not found:', strategyKey);
                    return;
                }

                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                const strategyName = createMissingElement('strategyName', 'h2', resultSection);
                const strategyDetails = createMissingElement('strategyDetails', 'div', resultSection);
                const buttonGroup = resultSection.querySelector('.button-group') || createMissingElement('button-group', 'div', resultSection, ['button-group']);

                if (errorContainer) errorContainer.classList.add('hidden');

                stepSection.classList.add('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.remove('hidden');
                strategyName.textContent = strategy.name;

                const annotationRegex = /\[\d+\]/g;
                const annotations = new Set();
                if (strategy.name.match(annotationRegex)) {
                    strategy.name.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                }
                strategy.details.forEach(detail => {
                    if (detail.match(annotationRegex)) {
                        detail.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                    }
                });

                strategyDetails.innerHTML = `
                    <h4 style="margin-top: 0; color: #fff;">ì „ëµ ì„¸ë¶€ì‚¬í•­:</h4>
                    <ul class="strategy-list">
                        ${strategy.details.map(detail => `<li>${detail}</li>`).join('')}
                    </ul>
                    ${annotations.size > 0 ? `
                        <h4 style="margin-top: 20px; color: #fff;">ì£¼ì„:</h4>
                        <ul class="strategy-list">
                            ${Array.from(annotations).sort().map(annotation => `
                                <li class="impl-note">${annotation}: ${notes[annotation]}</li>
                            `).join('')}
                        </ul>
                    ` : ''}
                `;

                buttonGroup.innerHTML = `
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;

                updateProgress();
                updatePathHistory();
            }

            function updateProgress() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const progressBar = createMissingElement('progress-bar', 'div', document.body, ['progress-bar']);
                const progressFill = createMissingElement('progressFill', 'div', progressBar, ['progress-fill']);
                if (errorContainer) errorContainer.classList.add('hidden');

                const totalSteps = 11; // Aë¶€í„° Kê¹Œì§€ ìµœëŒ€ ë‹¨ê³„ ìˆ˜
                const progress = Math.min((stepCount / totalSteps) * 100, 100);
                progressFill.style.width = progress + '%';
            }

            function updatePathHistory() {
                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const pathHistoryDiv = createMissingElement('pathHistory', 'div', document.body, ['hidden']);
                const pathStepsDiv = createMissingElement('pathSteps', 'div', pathHistoryDiv);
                if (errorContainer) errorContainer.classList.add('hidden');

                if (pathHistory.length === 0) {
                    pathHistoryDiv.classList.add('hidden');
                    return;
                }

                pathStepsDiv.innerHTML = '';

                pathHistory.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = `path-step ${step.choice && step.step !== 'DICE' ? 'yes' : step.step !== 'DICE' ? 'no' : ''}`;

                    if (step.step === 'DICE') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice}</div>
                            <div>
                                <strong>ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°:</strong> ${step.choice} 
                                ${step.result ? `â†’ ${strategies[step.result].name}` : ''}
                            </div>
                        `;
                    } else if (step.step === 'Sort Cards') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">S</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ì¹´ë“œ ì •ë ¬ â†’ ê³„ì†
                            </div>
                        `;
                    } else {
                        let conditionText = conditions[step.step] || '';
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice ? 'Y' : 'N'}</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ${conditionText} â†’ ${step.choice ? 'YES' : 'NO'}
                            </div>
                        `;
                    }

                    pathStepsDiv.appendChild(stepDiv);
                });

                pathHistoryDiv.classList.remove('hidden');
            }

            function resetFlow() {
                currentStep = 'start';
                stepCount = 0;
                pathHistory = [];
                evaluatedConditions = {};

                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                const pathHistoryDiv = createMissingElement('pathHistory', 'div', document.body, ['hidden']);
                const progressBar = createMissingElement('progress-bar', 'div', document.body, ['progress-bar']);

                const elements = {
                    errorContainer,
                    stepSection,
                    diceSection,
                    resultSection,
                    pathHistoryDiv,
                    progressBar,
                    stepNumber: createMissingElement('stepNumber', 'div', stepSection),
                    stepTitle: createMissingElement('stepTitle', 'h2', stepSection),
                    conditionBox: createMissingElement('conditionBox', 'div', stepSection),
                    buttonGroup: createMissingElement('buttonGroup', 'div', stepSection),
                    progressFill: createMissingElement('progressFill', 'div', progressBar, ['progress-fill']),
                    pathSteps: createMissingElement('pathSteps', 'div', pathHistoryDiv),
                    strategyName: createMissingElement('strategyName', 'h2', resultSection),
                    strategyDetails: createMissingElement('strategyDetails', 'div', resultSection),
                    diceResult: createMissingElement('diceResult', 'div', diceSection)
                };

                const createdElements = Object.keys(elements).filter(key => {
                    const element = document.getElementById(elements[key].id);
                    return element && element !== document.getElementById(key);
                });

                if (createdElements.length > 0) {
                    console.warn('Created missing DOM elements in resetFlow:', createdElements);
                    if (elements.errorContainer) {
                        elements.errorContainer.classList.remove('hidden');
                    }
                } else if (elements.errorContainer) {
                    elements.errorContainer.classList.add('hidden');
                }

                if (elements.stepSection) elements.stepSection.classList.remove('hidden');
                if (elements.diceSection) elements.diceSection.classList.add('hidden');
                if (elements.resultSection) elements.resultSection.classList.add('hidden');
                if (elements.pathHistoryDiv) elements.pathHistoryDiv.classList.add('hidden');
                if (elements.stepNumber) elements.stepNumber.textContent = '1';
                if (elements.stepTitle) elements.stepTitle.textContent = 'ì‹œì‘';
                if (elements.conditionBox) elements.conditionBox.innerHTML = 'ì—ë¼ìŠ¤ë¬´ìŠ¤ê°€ ì‚¬ìš©í•  ì¹´ë“œë¥¼ ê²°ì •í•©ë‹ˆë‹¤';
                if (elements.buttonGroup) elements.buttonGroup.innerHTML = '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>';
                if (elements.progressFill) elements.progressFill.style.width = '0%';
            }

            function goBack() {
                if (pathHistory.length === 0) {
                    resetFlow();
                    return;
                }

                const lastStep = pathHistory.pop();
                stepCount--;

                if (lastStep.step !== 'DICE') {
                    delete evaluatedConditions[lastStep.step];
                }

                if (pathHistory.length === 0) {
                    currentStep = 'start';
                } else {
                    currentStep = pathHistory[pathHistory.length - 1].step;
                    if (lastStep.step === 'DICE') {
                        currentStep = pathHistory.length > 0 ? pathHistory[pathHistory.length - 1].step : 'start';
                        pathHistory.pop();
                        stepCount--;
                        if (pathHistory.length > 0) {
                            delete evaluatedConditions[pathHistory[pathHistory.length - 1].step];
                        }
                    }
                }

                const errorContainer = createMissingElement('errorContainer', 'div', document.body, ['hidden']);
                const stepSection = createMissingElement('stepSection', 'div', document.body);
                const diceSection = createMissingElement('diceSection', 'div', document.body, ['hidden']);
                const resultSection = createMissingElement('resultSection', 'div', document.body, ['hidden']);
                if (errorContainer) errorContainer.classList.add('hidden');

                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                showStep(currentStep);
            }

            window.onload = function () {
                if (document.readyState === 'complete') {
                    resetFlow();
                } else {
                    window.addEventListener('DOMContentLoaded', resetFlow);
                }
            };
        </script>
  </template>

  <!-- 5. íƒœìŠ¤í¬ í¬ìŠ¤ êµ¬ì„± -->
  <template id="tmpl-task">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Japanese Erasmus Bot - íƒœìŠ¤í¬ í¬ìŠ¤ êµ¬ì„±</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #2e2e2e;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
                color: #d8d8d8;
            }
        
            .impl-note {
                font-style: italic;
                font-size: 14px;
                color: #ffffff;
                line-height: 1.6;
                margin: 4px 0;
            }
        
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
        
            .header {
                text-align: center;
                margin-bottom: 20px;
                padding: 15px;
                background: #4a4a4a;
                border-radius: 8px;
                color: #ffffff;
                border: 1px solid #5c5c5c;
            }
        
            .header h1 {
                margin: 0;
                font-size: 2rem;
                font-weight: 700;
            }
        
            .header p {
                margin: 8px 0 0 0;
                font-size: 1rem;
                font-weight: 400;
            }
        
            .progress-bar {
                background: #4a4a4a;
                border-radius: 5px;
                height: 6px;
                margin-bottom: 20px;
                overflow: hidden;
                border: 1px solid #5c5c5c;
            }
        
            .progress-fill {
                background: #4682b4;
                height: 100%;
                border-radius: 5px;
                transition: width 0.3s ease;
                width: 0%;
            }
        
            .step-section {
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid #5c5c5c;
            }
        
            .step-header {
                display: flex;
                align-items: center;
                margin-bottom: 15px;
            }
        
            .step-number {
                background: #4682b4;
                color: #ffffff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1rem;
                margin-right: 15px;
            }
        
            .step-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: #d8d8d8;
                margin: 0;
            }
        
            .condition-box {
                background: #4a4a4a;
                border-left: 4px solid #4682b4;
                border-radius: 5px;
                padding: 15px;
                margin: 15px 0;
                font-size: 1rem;
                line-height: 1.5;
                color: #c8c8c8;
            }
        
            .condition-box strong {
                color: #4682b4;
                font-size: 1.1rem;
            }
        
            .button-group {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 20px;
            }
        
            .btn {
                padding: 10px 30px;
                border: none;
                border-radius: 5px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s ease, transform 0.1s ease;
                text-transform: uppercase;
                min-width: 100px;
                font-family: 'Georgia', 'Times New Roman', Times, serif;
            }
        
            .btn-yes {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .btn-yes:hover {
                background: #257a4b;
                transform: translateY(-2px);
            }
        
            .btn-no {
                background: #696969;
                color: #ffffff;
            }
        
            .btn-no:hover {
                background: #585858;
                transform: translateY(-2px);
            }
        
            .btn-primary {
                background: #4682b4;
                color: #ffffff;
            }
        
            .btn-primary:hover {
                background: #3a6b9a;
                transform: translateY(-2px);
            }
        
            .btn-secondary {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-secondary:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .btn-back {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-back:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .path-history {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 15px;
                border-left: 3px solid #2e8b57;
            }
        
            .path-step {
                display: flex;
                align-items: center;
                margin: 8px 0;
                padding: 8px;
                background: #3c3c3c;
                border-radius: 5px;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }
        
            .path-step .step-icon {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 10px;
                font-size: 0.8rem;
            }
        
            .path-step.yes .step-icon {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .path-step.no .step-icon {
                background: #696969;
                color: #ffffff;
            }
        
            .dice-section {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin: 15px 0;
                border: 1px solid #5c5c5c;
            }
        
            .dice-result {
                font-size: 3rem;
                font-weight: bold;
                color: #d8d8d8;
                margin: 15px 0;
            }
        
            .result-section {
                background: #2e8b57;
                color: #ffffff;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin-top: 15px;
                border: 1px solid #3c3c3c;
            }
        
            .result-section h2 {
                margin: 0 0 15px 0;
                font-size: 2rem;
                display: none;
            }
        
            .result-section p {
                margin: 10px 0;
                font-size: 32px;
                white-space: pre-line;
                font-weight: bold;
                font-style: italic;
            }
        
            .strategy-details {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                padding: 15px;
                margin-top: 15px;
            }
        
            .strategy-list {
                text-align: left;
                margin: 15px 0;
                list-style: none;
                padding: 0;
            }
        
            .strategy-list li {
                margin: 8px 0;
                padding: 8px 10px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 5px;
                border-left: 3px solid rgba(255, 255, 255, 0.3);
            }
        
            .sub-priority-list {
                list-style: none;
                padding-left: 20px;
                margin-top: 5px;
            }
        
            .sub-priority-list li {
                margin: 5px 0;
                padding: 5px 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                border-left: 2px solid rgba(255, 255, 255, 0.4);
                font-size: 0.9rem;
            }
        
            .hidden {
                display: none;
            }
        
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                    margin: 10px;
                }
                
                .header h1 {
                    font-size: 1.5rem;
                }
                
                .button-group {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn {
                    width: 100%;
                    max-width: 180px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>íƒœìŠ¤í¬ í¬ìŠ¤ êµ¬ì„±</h1>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="pathHistory" class="path-history hidden">
                <h4 style="margin-top: 0; color: #ffffff;">ì§„í–‰ ê²½ë¡œ</h4>
                <div id="pathSteps"></div>
            </div>

            <div id="stepSection" class="step-section">
                <div class="step-header">
                    <div class="step-number" id="stepNumber">1</div>
                    <h2 class="step-title" id="stepTitle">ì‹œì‘</h2>
                </div>
                
                <div class="condition-box" id="conditionBox">
                    ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>
                
                <div class="button-group" id="buttonGroup">
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>

            <div id="diceSection" class="dice-section hidden">
                <h3 style="margin: 0 0 20px 0; color: #2d3436;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (1d10)</h3>
                <div class="dice-result" id="diceResult">?</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="resultSection" class="result-section hidden">
                <h2 id="strategyTitle">ìµœì¢… ë³‘ë ¥ êµ¬ì„±</h2>
                <p id="strategyName"></p>
                <div class="strategy-details" id="strategyDetails"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <script>
            // Implementation notes
            const notes = {
                '[1]': 'ë§¤íŠ¸ë¦­ìŠ¤ì— ì˜í•´ ê²°ì •ëœ ê° ëª©í‘œë§ˆë‹¤ ì´ í‘œì— ë”°ë¼ ë³‘ë ¥ì„ í¸ì„±í•©ë‹ˆë‹¤. ë§Œì•½ OC ê³µì„¸ ìƒí™©ì´ê³  ì´ë¯¸ ì „íˆ¬ í—¥ìŠ¤ í•˜ë‚˜ê°€ ì§€ì •ëë‹¤ë©´, **ì ë ¹ë˜ì§€ ì•Šì€ ëª©í‘œë§Œ ê³ ë ¤**í•œ í›„, ë‹¤ìŒìœ¼ë¡œ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ëª©í‘œì— ì§€ìƒ â†’ ê³µêµ° â†’ í•´êµ° ìˆœì„œë¡œ ë” ê°€ê¹Œì›Œì§€ë„ë¡ í•˜ëŠ” ë‘ ì¥ ì¹´ë“œ ì¡°í•©ì„ ì„ íƒí•˜ì„¸ìš”.',
                '[2]': 'ì§€ìƒ ìœ ë‹› í•˜ë‚˜ë¥¼ í™œì„±í™”í•˜ì—¬ ì´ í—¥ìŠ¤ë¡œ ì§„ê²©ì‹œí‚µë‹ˆë‹¤. ë§Œì•½ ì  í•´êµ° ìœ ë‹›ì´ ëª©í‘œë¥¼ ì ë ¹ ì¤‘ì´ë¼ë©´ ì „íˆ¬ í—¥ìŠ¤ ìƒì„± ë°©ì§€ë¥¼ ìœ„í•´ ì§€ìƒ ìœ ë‹›ì„ ëª©í‘œ ë°–ìœ¼ë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤. í•„ìš”í•˜ë‹¤ë©´ ì´ ì§€ìƒ ìœ ë‹›ì„ ìœ¡ìƒ ì§„ê²©(Overland Advance)ì„ í†µí•´ ì¶”ê°€ ëª©í‘œë¥¼ ì ë ¹í•˜ëŠ” ë° ë‹¤ì‹œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                '[3]': 'ì„ íƒëœ ì „ëµì˜ ë³‘ë ¥Force í¸ì„± ìœ í˜•ì— ë”°ë¼, ëª©í‘œ ë²”ìœ„ ë‚´ì—ì„œ í•´ë‹¹ í—¥ìŠ¤ì˜ í”¼í•´ ìˆ˜ì¤€ ê¸°ì¤€Damage Level criteriaì„ ë‹¬ì„±í•  ìˆ˜ ìˆëŠ” ìµœì†Œí•œì˜ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ë‹¬ì„± ë¶ˆê°€í•œ ê²½ìš° ê°€ëŠ¥í•œ í•œ ë§ì€ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ë§Œì•½ ëŒ€ì‘ì´ ê°€ëŠ¥í•˜ë‹¤ë©´, ëª©í‘œì— ë„ë‹¬í•  ìˆ˜ ìˆëŠ” ì ì˜ ëŒ€ì‘ ë³‘ë ¥ì„ ê³ ë ¤í•˜ì—¬ í•„ìš”í•œ ì „ë ¥ì„ ê³„ì‚°í•©ë‹ˆë‹¤.',
                '[4]': 'ì¼ë³¸ ì œë„ ì™¸ì˜ HQ í—¥ìŠ¤ì— ì£¼ë‘” ì¤‘ì¸ ì§€ìƒ ìœ ë‹›ì˜ ê²½ìš°, HQë¥¼ ë°©ì–´í•˜ê¸° ìœ„í•´ ë°˜ë“œì‹œ í•˜ë‚˜ëŠ” í•´ë‹¹ í—¥ìŠ¤ì— ë‚¨ê²¨ë‘¬ì•¼ í•˜ë©° í™œì„±í™”í•˜ì§€ì•ŠìŠµë‹ˆë‹¤.',
                '[5]': 'ì§€ìƒ ìœ ë‹› í•˜ë‚˜ë¥¼ í™œì„±í™”í•˜ì—¬ AA(ìƒë¥™ ê°•ìŠµ)ë¥¼ í†µí•´ ëª©í‘œë¥¼ ì¹¨ê³µí•˜ì„¸ìš”. ê°€ëŠ¥í•˜ë‹¤ë©´ ìœ ê¸°ì  ìˆ˜ì†¡(organic transportation)ì„ ì´ìš©í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ASPë¥¼ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ì§€ìƒ ìœ ë‹›ê³¼ ë™ë°˜í•˜ëŠ” í•´êµ° ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ASPê°€ ì—†ìœ¼ë©´ ì´ ëª©í‘œëŠ” ê±´ë„ˆëœë‹ˆë‹¤.',
                '[6]': '"ì¥ì•…(Capture)"ì´ë€ ì „íˆ¬ ê²°ê³¼ë¡œ ìˆ˜ë¹„ìê°€ ì…íŒ ì†ì‹¤ë³´ë‹¤ ë” ë§ì€ ìŠ¤í… ì†ì‹¤ì„ ê°€í•´ ì „íˆ¬ì—ì„œ ìŠ¹ë¦¬í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¦‰, ì—ë¼ìŠ¤ë¬´ìŠ¤ê°€ í•´ë‹¹ ì „íˆ¬ ê²°ê³¼ ì´ìƒì„ êµ´ë¦¬ê³ , ìˆ˜ë¹„ìëŠ” ë™ì¼ ê²°ê³¼ ì´í•˜ë¥¼ êµ´ë ¸ì„ ë•Œë¥¼ ë§í•©ë‹ˆë‹¤.',
                '[7]': 'ë§Œì•½ ì—ë¼ìŠ¤ë¬´ìŠ¤ê°€ ì  ìœ ë‹›ì˜ í›„í‡´ë¥¼ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ê²½ìš°, ê°€ì¥ ì•½í•œ ìˆ˜ë¹„ ìœ ë‹›ë¶€í„° ê°€ì¥ ê°•í•œ ìœ ë‹› ìˆœìœ¼ë¡œ í›„í‡´ ê·œì¹™ì„ ë”°ë¼ ì´ë™í•©ë‹ˆë‹¤.',
                '[8]': 'ëŒ€ì‘ì´ ê°€ëŠ¥í•œ ê²½ìš°, ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ëª©í‘œì— ëŒ€í•´ í•´êµ° â†’ ê³µêµ° ìˆœìœ¼ë¡œ ë²ˆê°ˆì•„ ì¶”ê°€í•˜ì„¸ìš”. ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš°ì—ëŠ” ê³µêµ°ì„ í™œì„±í™”í•´ ì  ê³µêµ°ì„ ê³µê²©í•˜ê³ , ê·¸ë‹¤ìŒ í•´êµ°, ë§ˆì§€ë§‰ìœ¼ë¡œ ì§€ìƒêµ°ì„ í™œì„±í™”í•˜ì„¸ìš”.',
                '[9]': 'ìœ¡ìƒ ì§„ê²© / AA(ìƒë¥™ ê°•ìŠµ) ê·œì¹™<br>ì§€ìƒ ê³µê²©ì„ í•˜ë ¤ë©´, ì§€ìƒ ì „íˆ¬ ê²°ê³¼ê°€ 1xì¼ ë•Œ í—¥ìŠ¤ë¥¼ ì ë ¹[6][7]í•  ìˆ˜ ìˆì„ ë§Œí¼ ê³µê²©ë ¥ì´ ì¶©ë¶„íˆ ì»¤ì•¼ í•˜ë©°, ìµœì†Œ ì§€ìƒ ìœ ë‹› 1ìŠ¤í…ì´ ì ì˜ 2x ê²°ê³¼ì—ì„œ ì‚´ì•„ë‚¨ì•„ì•¼ í•©ë‹ˆë‹¤. <br> ì´ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” AA ëŒ€ì‘ê³¼ ì „íˆ¬ í—¥ìŠ¤ì— ë„ë‹¬ í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ MPë¥¼ ê°€ì§„ ì¸ì ‘ í—¥ìŠ¤ì˜ ê³µê²©ë„ í¬í•¨í•©ë‹ˆë‹¤.',
                '[10]': 'í”¼í•´ ìˆ˜ì¤€<br>ê³µê²©ë ¥ì— í”¼í•´ ê²°ê³¼ë¥¼ ê³±í•œ ê°’ìœ¼ë¡œ, ëª©í‘œ í—¥ìŠ¤ì— ìˆëŠ” ì  ë¶€ëŒ€ë¥¼ íŒŒê´´í•©ë‹ˆë‹¤. 1x ê²°ê³¼ëŠ” ì „íˆ¬ í…Œì´ë¸”ì˜ ê²°ê³¼ê°€ 1xì¸ ê²½ìš° ì ê³¼ ë™ë“± ì´ìƒì˜ ì „íˆ¬ë ¥ì´ ìˆì–´ì•¼ ì  ìœ ë‹›ì„ ì œê±°í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì§€ìƒ ì „íˆ¬ëŠ” (ìœ¡ìƒ ì§„ê²©/AA ê·œì¹™)ì„ ì°¸ê³ .<br>ëª©í‘œì— ëŒ€í•œ ìˆ˜ì¹˜ê°€ ë”°ë¡œ ì í˜€ìˆì§€ ì•Šë‹¤ë©´, ì§€ìƒ ì „íˆ¬: 1x, ê³µì¤‘/í•´ìƒ ì „íˆ¬: 0.5x ì‚¬ìš©.',
                '[11]': 'ì „íˆ¬ ì§€ì› ê¸°ì¤€<br>ê³µìŠµ(Air Raid): ì—†ìŒ. ìë™ìœ¼ë¡œ YES.<br>ì§€ìƒ ê³µê²©(Ground Attacks): ìµœì†Œí•œ ê³µì¤‘ ë˜ëŠ” í•´ìƒ ìœ ë‹› 1ê°œ ì´ìƒ í•„ìš”. <br>í•´ìƒ ì¹¨ê³µ(Naval Invasion): ìµœì†Œí•œ í•´ìƒ ìœ ë‹› 1ê°œ ì´ìƒ í•„ìš”. <br>ê³µì¤‘/í•´ìƒ ì¹¨ê³µ(Air/Naval Invasion): ê³µì¤‘ê³¼ í•´ìƒ ìœ ë‹› ê°ê° ìµœì†Œ 1ê°œ ì´ìƒ, ë˜ëŠ” í•­ëª¨ 1ê°œ ì´ìƒ í•„ìš”.',
                '[12]': 'ì§ˆì‹ ê³µê²©(Smothering Attack): í™œì„±í™”ëœ í•˜ë‚˜ ì´ìƒì˜ ê³µì¤‘/í•´ìƒ ìœ ë‹›ì´ ì ì˜ ìœ ë‹›/ìŠ¤íƒì„ ë¬¶ì–´ ë‘ê¸° ìœ„í•´ ê·¸ë“¤ì´ ìœ„ì¹˜í•œ í—¥ìŠ¤ë¥¼ ê³µê²©í•˜ì—¬ ëª©í‘œ í—¥ìŠ¤ ì´ì™¸ì˜ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ê²ƒ. ì „íˆ¬ í—¥ìŠ¤ê°€ í•˜ë‚˜ ì´ìƒ ìƒì„±ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— EC ê³µì„¸ ì¤‘ì—ë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ.'
            };
        
            // ë³‘ë ¥ êµ¬ì„± ì •ë³´ ë°ì´í„°
            const strategies = {
                'Air Raid': {
                    name: 'ê³µì¤‘ ìŠµê²© \n (Air Raid)',
                    details: [
                        'ë³‘ë ¥: ê³µì¤‘ ìœ ë‹›, í•´ìƒ ìœ ë‹›, í•­ëª¨',
                        'ìœ ë‹›ì„ ì„ íƒí•  ë•Œ ê°€ëŠ¥í•˜ë‹¤ë©´ ê³µì¤‘ ê· í˜•(Air Parity)ì„ ë§ì¶œ ë§Œí¼ ì¶©ë¶„íˆ ì„ íƒí•©ë‹ˆë‹¤.'
                    ]
                },
                'Ground Attack with Air Support': {
                    name: 'ê³µì¤‘ ì§€ì› ì§€ìƒ ê³µê²©\n(Ground Attack with Air Support)',
                    details: [
                        'ë³‘ë ¥: ì§€ìƒ ìœ ë‹›, ê³µì¤‘ ìœ ë‹›, í•­ëª¨(ë²”ìœ„ ë‚´).'
                    ]
                },
                'Ground Attack with Air/Naval Support': {
                    name: 'ê³µì¤‘/í•´ìƒ ì§€ì› ì§€ìƒ ê³µê²©\n(Ground Attack with Air/Naval Support)',
                    details: [
                        'ë³‘ë ¥: ì§€ìƒ ìœ ë‹›, ê³µì¤‘ ìœ ë‹›, í•­ëª¨'
                    ]
                },
                'Invasion with Naval Support': {
                    name: 'í•´ìƒ ì§€ì›ì„ ë°›ëŠ” ì¹¨ê³µ\n(Invasion with Naval Support)',
                    details: [
                        'ë³‘ë ¥: í•´ìƒ ìœ ë‹›, ì§€ìƒ ìœ ë‹› ìƒë¥™ ê°•ìŠµ(AA) ë° í•­ëª¨.'
                    ]
                },
                'Invasion with Air/Naval Support': {
                    name: 'ê³µì¤‘/í•´ìƒ ì§€ì›ì„ ë°›ëŠ” ì¹¨ê³µ\n(Invasion with Air/Naval Support)',
                    details: [
                        'ë³‘ë ¥: ê³µì¤‘ ìœ ë‹›, í•´ìƒ ìœ ë‹›, ì§€ìƒ ìœ ë‹› ìƒë¥™ ê°•ìŠµ(AA) ë° í•­ëª¨.'
                    ]
                },
                'Unsupported Invasion': {
                    name: 'ë¬´ì§€ì› ì¹¨ê³µ [4][5]\n(Unsupported Invasion)',
                    details: [
                        'ë³‘ë ¥: ì§€ìƒ ìœ ë‹› ìƒë¥™ ê°•ìŠµ(AA)'
                    ]
                },
                'March into the Target': {
                    name: 'ëª©í‘œë¡œ ì§„êµ° [2][4] \n (March into the Target)',
                    details: [
                        'ëª©í‘œ í—¥ìŠ¤ë¡œ ì§„êµ°í•©ë‹ˆë‹¤.'
                    ]
                },
                'Execute Air/Naval Attack against weakest stack': {
                    name: 'ê°€ì¥ ì•½í•œ ìŠ¤íƒì„ ëŒ€ìƒìœ¼ë¡œ ê³µì¤‘/í•´ìƒ ê³µê²© ì‹¤í–‰',
                    details: [
                        'ê°€ì¥ ì•½í•œ ìŠ¤íƒì— ê³µì¤‘/í•´ìƒ ê³µê²©ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.'
                    ]
                },
                'Move activated units to the Target': {
                    name: 'í™œì„±í™”ëœ ìœ ë‹›ì„ ëª©í‘œë¡œ ì´ë™',
                    details: [
                        'í™œì„±í™”ëœ ìœ ë‹›ì„ ëª©í‘œ í—¥ìŠ¤ë¡œ ì´ë™í•©ë‹ˆë‹¤.'
                    ]
                },
                'Consider Performing a Smothering Attack (see CDSS)': {
                    name: 'ì§ˆì‹ ê³µê²© ê³ ë ¤ [12]',
                    details: [
                        'ì§ˆì‹ ê³µê²©ì„ ê³ ë ¤í•©ë‹ˆë‹¤.'
                    ]
                },
                'Create a new Force for the next Target': {
                    name: 'ë‹¤ìŒ ëª©í‘œë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ë³‘ë ¥ ìƒì„±',
                    details: [
                        'ë‹¤ìŒ ëª©í‘œë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ë³‘ë ¥ì„ ìƒì„±í•©ë‹ˆë‹¤.'
                    ]
                },
                'Activate units for the target': {
                    name: 'ëª©í‘œë¥¼ ìœ„í•´ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤ [3]][4]',
                    details: [
                        'ëª©í‘œë¥¼ ìœ„í•´ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤.'
                    ]
                },
                'Activate more units with extra activations': {
                    name: 'ì¶”ê°€ í™œì„±í™”ë¡œ ë” ë§ì€ ìœ ë‹› í™œì„±í™” [8]',
                    details: [
                        'ì¶”ê°€ í™œì„±í™”ë¡œ ë” ë§ì€ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤.'
                    ]
                }
            };
        
            // í•˜ìœ„ ìš°ì„ ìˆœìœ„ ëª©ë¡ (í•„ìš” ì‹œ ì¶”ê°€, ì´ë¯¸ì§€ì— ë”°ë¼ ë¹„ì–´ìˆìŒ)
            const subPriorities = {};
        
            // ì¡°ê±´ ì •ì˜
            const conditions = {
                'A': 'ëª©í‘œì— ëŒ€í•œ ê³µì¤‘-í•´ìƒ ê³µê²©ì…ë‹ˆê¹Œ?',
                'B': 'ëª©í‘œê°€ í•´ì•ˆ ë˜ëŠ” ì„¬ í—¥ìŠ¤ì…ë‹ˆê¹Œ?',
                'C': 'ìœ¡ìƒ ì§„ê²©(Overland Advance)ë¡œ ëª©í‘œë¥¼ ì¥ì•…í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?',
                'D or (E and F)': 'ë‹¤ìŒ ì¤‘ í•˜ë‚˜ ì´ìƒì´ ì°¸ì…ë‹ˆê¹Œ? <li>ëª©í‘œì— ì ì˜ í•´ìƒ ìœ ë‹›ë§Œ ìˆê³ , ì§€ìƒ ìœ ë‹›ì´ ëª©í‘œì— ì§„ì…í•˜ê±°ë‚˜ ë¹ ì ¸ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” ê²½ìš°</li> <li>ëª©í‘œ í—¥ìŠ¤ê°€ ì ë ¹ë˜ì§€ ì•Šì€ ê²½ìš°</li>',
                'D1': 'ëª©í‘œ í—¥ìŠ¤ê°€ ë¹„ì–´ ìˆìŠµë‹ˆê¹Œ(Unoccupied)?',
                'D2': 'ëª©í‘œ í—¥ìŠ¤ê°€ ë¹„ì–´ ìˆìŠµë‹ˆê¹Œ(Unoccupied)?',
                'G': 'ëª©í‘œ í—¥ìŠ¤ê°€ ì ì¬ì ì¸ SR(íŠ¹ìˆ˜ ëŒ€ì‘) í—¥ìŠ¤ì…ë‹ˆê¹Œ?',
                'H': 'ì  ê³µì¤‘ ìœ ë‹› ë˜ëŠ” í•­ê³µ ëª¨í•¨ ìœ ë‹›ì´ ì´ ëª©í‘œì— ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?',
                'I': 'ì „íˆ¬ ì§€ì› ê¸°ì¤€ì„ ì¶©ì¡±í•  ë§Œí¼ í™œì„±í™” ê°œìˆ˜ê°€ ì¶©ë¶„í•©ë‹ˆê¹Œ?',
                'J': 'ëª©í‘œì— í”¼í•´ ìˆ˜ì¤€ë§Œí¼ì˜ í”¼í•´ë¥¼ ì…í˜”ìŠµë‹ˆê¹Œ?',
                'K+L': 'ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <li>ì  í•´ìƒ ë˜ëŠ” ì§€ìƒ ìœ ë‹›ì´ ì´ ëª©í‘œì— ëŒ€ì‘í•  ìˆ˜ ìˆìŒ</li> <li>EC ê³µì„¸ì„</li>',
                'M': 'ì´ í—¥ìŠ¤ê°€ ë§ˆì§€ë§‰ ëª©í‘œì…ë‹ˆê¹Œ?'
            };
        
            let currentStep = 'start';
            let pathHistory = [];
            let stepCount = 0;
            let evaluatedConditions = {};
        
            function startFlow() {
                currentStep = 'A';
                stepCount = 1;
                pathHistory = [];
                evaluatedConditions = {};
                showStep('A');
            }
        
            function showStep(stepId) {
                const stepSection = document.getElementById('stepSection');
                const stepNumber = document.getElementById('stepNumber');
                const stepTitle = document.getElementById('stepTitle');
                const conditionBox = document.getElementById('conditionBox');
                const buttonGroup = document.getElementById('buttonGroup');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
        
                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
        
                stepNumber.textContent = stepCount;
        
                if (stepId === 'DICE') {
                    stepSection.classList.add('hidden');
                    diceSection.classList.remove('hidden');
                    document.getElementById('diceResult').textContent = '?';
                    return;
                }

                // if (conditions[stepId]) {
                //     stepTitle.textContent = `${stepId} í™•ì¸`;
                //     conditionBox.innerHTML = `<strong>Step ${stepCount}:</strong> ${conditions[stepId]}`;
                //     buttonGroup.innerHTML = `
                //         <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                //         <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                //         ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                //     `;
                // } else if (stepId === 'start') {
                //     stepTitle.textContent = 'ì‹œì‘';
                //     conditionBox.innerHTML = `<strong>Step 1:</strong> íƒœìŠ¤í¬ í¬ìŠ¤ ê²°ì • ì‹œì‘`;
                //     buttonGroup.innerHTML = `
                //         <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                //     `;
                // } else if (stepId === 'Activate Units for the Target') {
                //     stepTitle.textContent = 'ëª©í‘œì— ëŒ€í•œ ìœ ë‹› í™œì„±í™”';
                //     conditionBox.innerHTML = `<strong>Step ${stepCount}:</strong> ëª©í‘œì— ëŒ€í•œ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤.`;
                //     buttonGroup.innerHTML = `
                //         <button class="btn btn-primary" onclick="selectChoice('Activate Units for the Target', true)">ê³„ì†</button>
                //         ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                //     `;
                // } else if (stepId === 'K+L') {
                //     stepTitle.textContent = 'K+L í™•ì¸';
                //     conditionBox.innerHTML = `<strong>Step ${stepCount}:</strong> Kì™€ L ì¡°ê±´ì„ í™•ì¸í•˜ì„¸ìš”.`;
                //     buttonGroup.innerHTML = `
                //         <button class="btn btn-yes" onclick="selectChoice('K+L', true)">YES</button>
                //         <button class="btn btn-no" onclick="selectChoice('K+L', false)">NO</button>
                //         ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                //     `;
                // } else if (stepId === 'M') {
                //     stepTitle.textContent = 'M í™•ì¸';
                //     conditionBox.innerHTML = `<strong>Step ${stepCount}:</strong> ì¶”ê°€ í™œì„±í™”ë¡œ ë” ë§ì€ ìœ ë‹›ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?`;
                //     buttonGroup.innerHTML = `
                //         <button class="btn btn-yes" onclick="selectChoice('M', true)">YES</button>
                //         <button class="btn btn-no" onclick="selectChoice('M', false)">NO</button>
                //         ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                //     `;
                // }
        
                if (conditions[stepId]) {
                    stepTitle.textContent = `${stepId} í™•ì¸`;
                    conditionBox.innerHTML = ` ${conditions[stepId]}`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                        <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'start') {
                    stepTitle.textContent = 'ì‹œì‘';
                    conditionBox.innerHTML = `íƒœìŠ¤í¬ í¬ìŠ¤ ê²°ì • ì‹œì‘`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                    `;
                } else if (stepId === 'Activate Units for the Target') {
                    stepTitle.textContent = 'ëª©í‘œì— ëŒ€í•œ ìœ ë‹› í™œì„±í™”';
                    conditionBox.innerHTML = ` ëª©í‘œì— ëŒ€í•œ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤. <br><ul><li>ì„ íƒëœ ì „ëµì˜ ë³‘ë ¥Force í¸ì„± ìœ í˜•ì— ë”°ë¼, ëª©í‘œ ë²”ìœ„ ë‚´ì—ì„œ í•´ë‹¹ í—¥ìŠ¤ì˜ í”¼í•´ ìˆ˜ì¤€ ê¸°ì¤€ì„ ë‹¬ì„±í•  ìˆ˜ ìˆëŠ” ìµœì†Œí•œì˜ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ë‹¬ì„± ë¶ˆê°€í•œ ê²½ìš° ê°€ëŠ¥í•œ í•œ ë§ì€ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤. ë§Œì•½ ëŒ€ì‘ì´ ê°€ëŠ¥í•˜ë‹¤ë©´, ëª©í‘œì— ë„ë‹¬í•  ìˆ˜ ìˆëŠ” ì ì˜ ëŒ€ì‘ ë³‘ë ¥ì„ ê³ ë ¤í•˜ì—¬ í•„ìš”í•œ ì „ë ¥ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</li><li>ì¼ë³¸ ì œë„ ì™¸ì˜ HQ í—¥ìŠ¤ì— ì£¼ë‘” ì¤‘ì¸ ì§€ìƒ ìœ ë‹›ì˜ ê²½ìš°, HQë¥¼ ë°©ì–´í•˜ê¸° ìœ„í•´ ë°˜ë“œì‹œ í•˜ë‚˜ëŠ” í•´ë‹¹ í—¥ìŠ¤ì— ë‚¨ê²¨ë‘¬ì•¼ í•˜ë©° í™œì„±í™”í•˜ì§€ì•ŠìŠµë‹ˆë‹¤.</li></ul><br><b>í”¼í•´ ìˆ˜ì¤€ ê¸°ì¤€</b><ul><li>ê³µê²©ë ¥ì— í”¼í•´ ê²°ê³¼ë¥¼ ê³±í•œ ê°’ìœ¼ë¡œ, ëª©í‘œ í—¥ìŠ¤ì— ìˆëŠ” ì  ë¶€ëŒ€ë¥¼ íŒŒê´´í•©ë‹ˆë‹¤. 1x ê²°ê³¼ëŠ” ì „íˆ¬ í…Œì´ë¸”ì˜ ê²°ê³¼ê°€ 1xì¸ ê²½ìš° ì ê³¼ ë™ë“± ì´ìƒì˜ ì „íˆ¬ë ¥ì´ ìˆì–´ì•¼ ì  ìœ ë‹›ì„ ì œê±°í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì§€ìƒ ì „íˆ¬ëŠ” (ìœ¡ìƒ ì§„ê²©/AA ê·œì¹™)ì„ ì°¸ê³ .</li><li>ëª©í‘œì— ëŒ€í•œ ìˆ˜ì¹˜ê°€ ë”°ë¡œ ì í˜€ìˆì§€ ì•Šë‹¤ë©´, ì§€ìƒ ì „íˆ¬: 1x, ê³µì¤‘/í•´ìƒ ì „íˆ¬: 0.5x ì‚¬ìš©.</li></ul>`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="selectChoice('Activate Units for the Target', true)">ê³„ì†</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'K+L') {
                    stepTitle.textContent = 'K+L í™•ì¸';
                    conditionBox.innerHTML = ` Kì™€ L ì¡°ê±´ì„ í™•ì¸í•˜ì„¸ìš”.`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('K+L', true)">YES</button>
                        <button class="btn btn-no" onclick="selectChoice('K+L', false)">NO</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'M') {
                    stepTitle.textContent = 'M í™•ì¸';
                    conditionBox.innerHTML = ` ì¶”ê°€ í™œì„±í™”ë¡œ ë” ë§ì€ ìœ ë‹›ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('M', true)">YES</button>
                        <button class="btn btn-no" onclick="selectChoice('M', false)">NO</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                }
        
                updateProgress();
                updatePathHistory();
            }
        
            function selectChoice(conditionId, choice) {
                evaluatedConditions[conditionId] = choice;
                pathHistory.push({ step: conditionId, choice: choice, stepNum: stepCount });
                stepCount++;
        
                const nextStep = getNextStep(conditionId, choice);
        
                if (nextStep.startsWith('STRATEGY_')) {
                    const strategy = nextStep.replace('STRATEGY_', '');
                    showResult(strategy);
                } else {
                    currentStep = nextStep;
                    showStep(nextStep);
                }
            }
        
            function getNextStep(conditionId, choice) {
                switch (conditionId) {
                    case 'A':
                        return choice ? 'STRATEGY_Air Raid' : 'B';
                    case 'B':
                        return choice ? 'C' : 'D2';
                    case 'C':
                        return choice ? 'D or (E and F)' : 'D1';
                    case 'D1':
                        return choice ? 'G' : 'H';
                    case 'G':
                        return choice ? 'H' : 'STRATEGY_Unsupported Invasion';
                    case 'D2':
                        return choice ? 'STRATEGY_March into the Target' : 'STRATEGY_Ground Attack with Air Support';
                    case 'D or (E and F)':
                        return choice ? 'STRATEGY_March into the Target' : 'STRATEGY_Ground Attack with Air/Naval Support';
                    case 'H':
                        return choice ? 'STRATEGY_Invasion with Air/Naval Support' : 'STRATEGY_Invasion with Naval Support';
                    case 'I':
                        return choice ? 'J' : 'STRATEGY_Execute Air/Naval Attack against weakest stack';
                    case 'J':
                        return choice ? 'STRATEGY_Move activated units to the Target' : 'DICE';
                    case 'K+L':
                        return choice ? 'STRATEGY_Consider Performing a Smothering Attack (see CDSS)' : 'M';
                    case 'M':
                        return choice ? 'STRATEGY_Activate more units with extra activations' : 'STRATEGY_Create a new Force for the next Target';
                    case 'Activate Units for the Target':
                        return 'I';
                    case 'Air Raid Continue':
                    case 'Ground Attack with Air Support Continue':
                    case 'Ground Attack with Air/Naval Support Continue':
                    case 'Invasion with Naval Support Continue':
                    case 'Invasion with Air/Naval Support Continue':
                        return 'Activate Units for the Target';
                    case 'Move activated units to the Target Continue':
                        return 'K+L';
                    case 'Consider Performing a Smothering Attack (see CDSS) Continue':
                        return 'M';
                    case 'Execute Air/Naval Attack against weakest stack Continue':
                        return 'K+L';
                    default:
                        return 'start';
                }
            }
        
            function rollDice() {
                const diceValue = Math.floor(Math.random() * 10); // 0-9
                document.getElementById('diceResult').textContent = diceValue;
        
                let strategy;
                if (diceValue <= 3) {
                    strategy = 'Move activated units to the Target';
                } else {
                    strategy = 'Execute Air/Naval Attack against weakest stack';
                }
        
                pathHistory.push({
                    step: 'DICE',
                    choice: diceValue,
                    stepNum: stepCount,
                    isResult: true,
                    result: strategy
                });
        
                setTimeout(() => showResult(strategy), 1000);
            }
        
            function showResult(strategyKey) {
                const strategy = strategies[strategyKey];
                if (!strategy) {
                    console.error('Strategy not found:', strategyKey);
                    return;
                }
        
                const stepSection = document.getElementById('stepSection');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
                const strategyTitle = document.getElementById('strategyTitle');
                const strategyName = document.getElementById('strategyName');
                const strategyDetails = document.getElementById('strategyDetails');
                const buttonGroup = document.getElementById('resultSection').querySelector('.button-group');
        
                stepSection.classList.add('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.remove('hidden');
                strategyTitle.textContent = 'ìµœì¢… ë³‘ë ¥ êµ¬ì„±';
                strategyName.textContent = strategy.name;
        
                // íŠ¹ì • ì „ëµì— ëŒ€í•´ ë‚´ìš© ì—†ì´ ì œëª©ë§Œ í‘œì‹œí•˜ê³  'ê³„ì†' ë²„íŠ¼ ì¶”ê°€
                const continueStrategies = [];
                // const continueStrategies = ['Air Raid', 'Ground Attack with Air Support', 'Ground Attack with Air/Naval Support', 'Invasion with Naval Support', 'Invasion with Air/Naval Support', 'Move activated units to the Target', 'Consider Performing a Smothering Attack (see CDSS)'];
                if (continueStrategies.includes(strategyKey)) {
                    // // strategyDetails.innerHTML = '';
                    // buttonGroup.innerHTML = `
                    //     <button class="btn btn-primary" onclick="selectChoice('${strategyKey} Continue', true)">ê³„ì†</button>
                    //     <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                    //     ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    // `;
                    const annotationRegex = /\[\d+\]/g;
                    const parts = strategy.details.split(annotationRegex);
                    const annotations = strategy.details.match(annotationRegex);

                    let combined = '';
                    parts.forEach((part, i) => {
                        combined += part;
                        if (annotations && annotations[i]) {
                            const number = annotations[i].replace(/\[|\]/g, '');
                            combined += `<sup class="annotation" data-number="${number}">[${number}]</sup>`;
                        }
                    });
                    strategyDetails.innerHTML = combined;

                    // ê·¸ë¦¬ê³  ë²„íŠ¼ ê·¸ë£¹ì—ëŠ” "ê³„ì†" ë²„íŠ¼ + ê¸°ì¡´ ë²„íŠ¼ë“¤ ì¶”ê°€
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="selectChoice('${strategyKey} Continue', true)">ê³„ì†</button>
                        <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else {
                    const annotationRegex = /\[\d+\]/g;
                    const annotations = new Set();
                    if (strategy.name.match(annotationRegex)) {
                        strategy.name.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                    }
                    strategy.details.forEach(detail => {
                        if (detail.match(annotationRegex)) {
                            detail.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                        }
                    });
        
                    strategyDetails.innerHTML = `
                        <h4 style="margin-top: 0; color: #fff;">ë³‘ë ¥ êµ¬ì„± ì„¸ë¶€ì‚¬í•­:</h4>
                        <ul class="strategy-list">
                            ${strategy.details.map(detail => `
                                <li>
                                    ${detail}
                                    ${subPriorities[detail] ? `
                                        <ul class="sub-priority-list">
                                            ${subPriorities[detail].map(sub => `<li>${sub}</li>`).join('')}
                                        </ul>
                                    ` : ''}
                                </li>
                            `).join('')}
                        </ul>
                        ${annotations.size > 0 ? `
                            <h4 style="margin-top: 20px; color: #fff;">ì£¼ì„:</h4>
                            <ul class="strategy-list">
                                ${Array.from(annotations).sort().map(annotation => `
                                    <li class="impl-note">${annotation}: ${notes[annotation]}</li>
                                `).join('')}
                            </ul>
                        ` : ''}
                    `;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="selectChoice('${strategyKey} Continue', true)">ê³„ì†</button>
                        <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                }
        
                updateProgress();
                updatePathHistory();
            }
        
            function updateProgress() {
                const progressFill = document.getElementById('progressFill');
                const totalSteps = 15;
                const progress = Math.min((stepCount / totalSteps) * 100, 100);
                progressFill.style.width = progress + '%';
            }
        
            function updatePathHistory() {
                const pathHistoryDiv = document.getElementById('pathHistory');
                const pathStepsDiv = document.getElementById('pathSteps');
        
                if (pathHistory.length === 0) {
                    pathHistoryDiv.classList.add('hidden');
                    return;
                }
        
                pathStepsDiv.innerHTML = '';
        
                pathHistory.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = `path-step ${step.choice && step.step !== 'DICE' ? 'yes' : step.step !== 'DICE' ? 'no' : ''}`;
        
                    if (step.step === 'DICE') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice}</div>
                            <div>
                                <strong>ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°:</strong> ${step.choice} 
                                ${step.result ? `â†’ ${strategies[step.result].name}` : ''}
                            </div>
                        `;
                    } else {
                        let conditionText = conditions[step.step] || step.step;
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice ? 'Y' : 'N'}</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ${conditionText} â†’ ${step.choice ? 'YES' : 'NO'}
                            </div>
                        `;
                    }
        
                    pathStepsDiv.appendChild(stepDiv);
                });
        
                pathHistoryDiv.classList.remove('hidden');
            }
        
            function resetFlow() {
                currentStep = 'start';
                stepCount = 0;
                pathHistory = [];
                evaluatedConditions = {};
        
                const stepSection = document.getElementById('stepSection');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
                const pathHistoryDiv = document.getElementById('pathHistory');
                const stepNumber = document.getElementById('stepNumber');
                const stepTitle = document.getElementById('stepTitle');
                const conditionBox = document.getElementById('conditionBox');
                const buttonGroup = document.getElementById('buttonGroup');
                const progressFill = document.getElementById('progressFill');
        
                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                pathHistoryDiv.classList.add('hidden');
                stepNumber.textContent = '1';
                stepTitle.textContent = 'ì‹œì‘';
                conditionBox.innerHTML = 'ì—ë¼ìŠ¤ë¬´ìŠ¤ì˜ íƒœìŠ¤í¬ í¬ìŠ¤ êµ¬ì„±ì„ ê²°ì •í•©ë‹ˆë‹¤';
                buttonGroup.innerHTML = '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>';
                progressFill.style.width = '0%';
            }
        
            function goBack() {
                if (pathHistory.length === 0) return;
        
                const lastStep = pathHistory.pop();
                stepCount--;
        
                if (lastStep.step !== 'DICE') {
                    delete evaluatedConditions[lastStep.step];
                }
        
                currentStep = pathHistory.length > 0 ? pathHistory[pathHistory.length - 1].step : 'start';
        
                const stepSection = document.getElementById('stepSection');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
        
                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                showStep(currentStep);
            }
        
            window.onload = resetFlow;
        </script>
  </template>

  <!-- 6. ëŒ€ì‘ -->
  <template id="tmpl-resp">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Japanese Erasmus Bot - ëŒ€ì‘ êµ¬ì„±</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #2e2e2e;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
                color: #d8d8d8;
            }
        
            .impl-note {
                font-style: italic;
                font-size: 14px;
                color: #ffffff;
                line-height: 1.6;
                margin: 4px 0;
            }
        
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
        
            .header {
                text-align: center;
                margin-bottom: 20px;
                padding: 15px;
                background: #4a4a4a;
                border-radius: 8px;
                color: #ffffff;
                border: 1px solid #5c5c5c;
            }
        
            .header h1 {
                margin: 0;
                font-size: 2rem;
                font-weight: 700;
            }
        
            .header p {
                margin: 8px 0 0 0;
                font-size: 1rem;
                font-weight: 400;
            }
        
            .progress-bar {
                background: #4a4a4a;
                border-radius: 5px;
                height: 6px;
                margin-bottom: 20px;
                overflow: hidden;
                border: 1px solid #5c5c5c;
            }
        
            .progress-fill {
                background: #4682b4;
                height: 100%;
                border-radius: 5px;
                transition: width 0.3s ease;
                width: 0%;
            }
        
            .step-section {
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid #5c5c5c;
            }
        
            .step-header {
                display: flex;
                align-items: center;
                margin-bottom: 15px;
            }
        
            .step-number {
                background: #4682b4;
                color: #ffffff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1rem;
                margin-right: 15px;
            }
        
            .step-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: #d8d8d8;
                margin: 0;
            }
        
            .condition-box {
                background: #4a4a4a;
                border-left: 4px solid #4682b4;
                border-radius: 5px;
                padding: 15px;
                margin: 15px 0;
                font-size: 1rem;
                line-height: 1.5;
                color: #c8c8c8;
            }
        
            .condition-box strong {
                color: #4682b4;
                font-size: 1.1rem;
            }
        
            .button-group {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 20px;
            }
        
            .btn {
                padding: 10px 30px;
                border: none;
                border-radius: 5px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s ease, transform 0.1s ease;
                text-transform: uppercase;
                min-width: 100px;
                font-family: 'Georgia', 'Times New Roman', Times, serif;
            }
        
            .btn-yes {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .btn-yes:hover {
                background: #257a4b;
                transform: translateY(-2px);
            }
        
            .btn-no {
                background: #696969;
                color: #ffffff;
            }
        
            .btn-no:hover {
                background: #585858;
                transform: translateY(-2px);
            }
        
            .btn-primary {
                background: #4682b4;
                color: #ffffff;
            }
        
            .btn-primary:hover {
                background: #3a6b9a;
                transform: translateY(-2px);
            }
        
            .btn-secondary {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-secondary:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .btn-back {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-back:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .path-history {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 15px;
                border-left: 3px solid #2e8b57;
            }
        
            .path-step {
                display: flex;
                align-items: center;
                margin: 8px 0;
                padding: 8px;
                background: #3c3c3c;
                border-radius: 5px;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }
        
            .path-step .step-icon {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 10px;
                font-size: 0.8rem;
            }
        
            .path-step.yes .step-icon {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .path-step.no .step-icon {
                background: #696969;
                color: #ffffff;
            }
        
            .dice-section {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin: 15px 0;
                border: 1px solid #5c5c5c;
            }
        
            .dice-result {
                font-size: 3rem;
                font-weight: bold;
                color: #d8d8d8;
                margin: 15px 0;
            }
        
            .result-section {
                background: #2e8b57;
                color: #ffffff;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin-top: 15px;
                border: 1px solid #3c3c3c;
            }
        
            .result-section h2 {
                margin: 0 0 15px 0;
                font-size: 2rem;
                display: none;
            }
        
            .result-section p {
                margin: 10px 0;
                font-size: 32px;
                white-space: pre-line;
                font-weight: bold;
                font-style: italic;
            }
        
            .strategy-details {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                padding: 15px;
                margin-top: 15px;
            }
        
            .strategy-list {
                text-align: left;
                margin: 15px 0;
                list-style: none;
                padding: 0;
            }
        
            .strategy-list li {
                margin: 8px 0;
                padding: 8px 10px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 5px;
                border-left: 3px solid rgba(255, 255, 255, 0.3);
            }
        
            .sub-priority-list {
                list-style: none;
                padding-left: 20px;
                margin-top: 5px;
            }
        
            .sub-priority-list li {
                margin: 5px 0;
                padding: 5px 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                border-left: 2px solid rgba(255, 255, 255, 0.4);
                font-size: 0.9rem;
            }
        
            .hidden {
                display: none;
            }
        
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                    margin: 10px;
                }
                
                .header h1 {
                    font-size: 1.5rem;
                }
                
                .button-group {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn {
                    width: 100%;
                    max-width: 180px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ëŒ€ì‘</h1>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="pathHistory" class="path-history hidden">
                <h4 style="margin-top: 0; color: #ffffff;">ì§„í–‰ ê²½ë¡œ</h4>
                <div id="pathSteps"></div>
            </div>

            <div id="stepSection" class="step-section">
                <div class="step-header">
                    <div class="step-number" id="stepNumber">1</div>
                    <h2 class="step-title" id="stepTitle">ì‹œì‘</h2>
                </div>
                
                <div class="condition-box" id="conditionBox">
                    ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>
                
                <div class="button-group" id="buttonGroup">
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>

            <div id="diceSection" class="dice-section hidden">
                <h3 style="margin: 0 0 20px 0; color: #2d3436;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (1d10)</h3>
                <div class="dice-result" id="diceResult">?</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="resultSection" class="result-section hidden">
                <h2 id="strategyTitle">ìµœì¢… ë³‘ë ¥ êµ¬ì„±</h2>
                <p id="strategyName"></p>
                <div class="strategy-details" id="strategyDetails"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <script>
            // Implementation notes
            const notes = {
                '[1]': 'ì„ íƒì§€ê°€ ìˆë‹¤ë©´, ë°˜ê²©(Counteroffensive) ì¹´ë“œë³´ë‹¤ ë¨¼ì € JN-25 ì²©ë³´(Intelligence) ì¹´ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.',
                '[2]': 'ì—¬ëŸ¬ ì  ìœ ë‹› ì¤‘ì—ì„œ ì„ íƒí•´ì•¼ í•  ê²½ìš°, ìš°ì„ ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: í•­ëª¨(CV) â†’ ì „í•¨(BB) â†’ ì¤‘ìˆœì–‘í•¨(CA) â†’ êµ¬ì¶•í•¨(DD). ë™ì¼ ìœ í˜•ì¼ ê²½ìš° ë°©ì–´ë ¥ì´ ê°€ì¥ ë†’ì€ ìœ ë‹›ì„ ì„ íƒí•©ë‹ˆë‹¤.',
                '[3]': 'ì—¬ëŸ¬ ì „íˆ¬ í—¥ìŠ¤ê°€ ê°€ëŠ¥í•  ê²½ìš°, ëŒ€ì‘ ì „ëµì˜ ìš°ì„ ìˆœìœ„ ëª©ë¡ì„ ë”°ë¼ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.',
                '[4]': '2ìŠ¤í… ì†ì‹¤ì„ ê°€í•  ë•Œë„ [2]ì™€ ë™ì¼í•˜ê²Œ, CV â†’ BB â†’ CA â†’ DD ìˆœì„œë¡œ, ê°™ì€ ìœ í˜• ì¤‘ì—ì„œëŠ” ë°©ì–´ë ¥ì´ ê°€ì¥ ë†’ì€ ìœ ë‹›ì„ ì„ íƒí•©ë‹ˆë‹¤.',
                '[5]': 'ìš°ì„ ìˆœìœ„ê°€ ë™ì¼í•œ ì „íˆ¬ í—¥ìŠ¤ê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ê²½ìš°, ë¬´ì‘ìœ„ë¡œ ìˆœì„œë¥¼ ê²°ì •í•©ë‹ˆë‹¤.',
                '[6]': 'ìµœìš°ì„  ì „íˆ¬ í—¥ìŠ¤ì˜ ëŒ€ì‘ ë³‘ë ¥ ì¡°ê±´ì„ ë¨¼ì € ì¶©ì¡±í•´ì•¼ í•˜ë©°, ê·¸ë‹¤ìŒì€ ë‘ ë²ˆì§¸, ì„¸ ë²ˆì§¸ ìˆœìœ¼ë¡œ ì¶©ì¡±í•©ë‹ˆë‹¤.',
                '[7]': 'íŠ¹ì • ì „íˆ¬ í—¥ìŠ¤ ì¡°ê±´ì„ ì¶©ì¡±í•  ìˆ˜ ì—†ì„ ê²½ìš°, ë‹¤ìŒ ìš°ì„ ìˆœìœ„ ì „íˆ¬ í—¥ìŠ¤ë¡œ ê±´ë„ˆëœë‹ˆë‹¤. ì´ ê³¼ì •ì„ ë°˜ë³µí•˜ë‹¤ê°€ ë” ì´ìƒ ëŒ€ì‘í•  ì „íˆ¬ í—¥ìŠ¤ê°€ ì—†ìœ¼ë©´ ì¢…ë£Œí•©ë‹ˆë‹¤.',
                '[8]': 'ê°€ìš©(Available)"ì´ë€ ì¹´ë“œë¥¼ ì†ì— ë³´ìœ í•˜ëŠ” ê²ƒ ì™¸ì—ë„, Erasmusê°€ í•´ë‹¹ í˜ì´ì¦ˆì—ì„œ ìµœëŒ€ 3ì¥ì˜ ë³´ë„ˆìŠ¤ ë½‘ê¸° ì œí•œì„ ì•„ì§ ì´ˆê³¼í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.',
                '[9]': 'íŠ¹ì • ì „ëµì— PBMì´ ìˆë‹¤ë©´, ì´ í‘œë¥¼ ì ìš©í•˜ê¸° ì „ì— ë¨¼ì € ê·¸ê²ƒì„ ë”°ë¦…ë‹ˆë‹¤.',
                '[10]': 'ìš°ì„ ìˆœìœ„ í—¥ìŠ¤ê°€ ëª¨ë‘ ì¼ë³¸ AZOIì— ì´ë¯¸ ë“¤ì–´ê°€ ìˆëŠ” ê²½ìš°, ê·¸ ìš°ì„ ìˆœìœ„ëŠ” ê±´ë„ˆëœë‹ˆë‹¤.',
                '[11]': 'ì—¬ëŸ¬ ê³µêµ° ê¸°ì§€ê°€ ìˆì„ ê²½ìš°, ì—¬ëŸ¬ ìš°ì„ ìˆœìœ„ë¥¼ ë™ì‹œì— ì¶©ì¡±í•  ìˆ˜ ìˆëŠ” ê¸°ì§€ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.',
                '[12]': 'í•œ ê³µêµ° ê¸°ì§€ì—ëŠ” ê³µì¤‘ ìœ ë‹›ì€ ìµœëŒ€ 1ê°œë§Œ ë°°ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                '[13]': 'ê°€ëŠ¥í•œ ê³µì¤‘ ìœ ë‹› ì¤‘ì—ì„œëŠ” ê°€ì¥ ê°•ë ¥í•œ ìœ ë‹›ì„ ì„ íƒí•©ë‹ˆë‹¤.',
                '[14]': 'ìì› í—¥ìŠ¤ê°€ ì—¬ëŸ¬ê°œì¸ ê²½ìš°, ê°€ì¥ ê°€ê¹Œìš´ ìì› í—¥ìŠ¤ â†’ ë‘ ë²ˆì§¸ë¡œ ê°€ê¹Œìš´ ìì› í—¥ìŠ¤ .. ìˆœìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.',
                '[15]': 'ëŒ€ì‘ ì¹´ë“œì— ë³´ë„ˆìŠ¤ ë½‘ê¸°ê°€ ì í˜€ ìˆì„ ê²½ìš°, ì£¼ì‚¬ìœ„ êµ´ë¦¼ì— -4ë¥¼ ì ìš©í•©ë‹ˆë‹¤.'
            };
        
            // ë³‘ë ¥ êµ¬ì„± ì •ë³´ ë°ì´í„°
            const strategies = {
                'Play Weather Reaction Card': {
                    name: 'ë‚ ì”¨ ëŒ€ì‘ ì¹´ë“œ ì‚¬ìš©',
                    details: ['ë‚ ì”¨ ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.']
                },
                'Roll for each SR': {
                    name: 'ê° SRì— ëŒ€í•´ ì£¼ì‚¬ìœ„ êµ´ë¦¼',
                    details: ['ê° SRì— ëŒ€í•´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦½ë‹ˆë‹¤.']
                },
                'Play Intel-CO Reaction Card': {
                    name: 'ì²©ë³´-CO ëŒ€ì‘ ì¹´ë“œ ì‚¬ìš© [1]',
                    details: ['ì²©ë³´-CO ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.']
                },
                'If possible, roll for Intelligence': {
                    name: 'ê°€ëŠ¥í•˜ë‹¤ë©´ ì²©ë³´ ì£¼ì‚¬ìœ„ êµ´ë¦¼',
                    details: ['ì²©ë³´ ì£¼ì‚¬ìœ„ êµ´ë¦¼ì„ ì‹œë„í•©ë‹ˆë‹¤.']
                },
                'Play Kamikaze Attack Card': {
                    name: 'ê°€ë¯¸ì¹´ì œ ê³µê²© ì¹´ë“œ ì‚¬ìš© [3][4]',
                    details: ['ê°€ë¯¸ì¹´ì œ ê³µê²© ì¹´ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.']
                },
                'Play Submarine Attack Card': {
                    name: 'ì ìˆ˜í•¨ ê³µê²© ì¹´ë“œ ì‚¬ìš© [2]',
                    details: ['ì ìˆ˜í•¨ ê³µê²© ì¹´ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.']
                },
                'Execute PBM if applicable': {
                    name: 'ì ìš© ê°€ëŠ¥í•œ ê²½ìš° PBM ìˆ˜í–‰',
                    details: ['ì ìš© ê°€ëŠ¥í•œ ê²½ìš° PBMì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.']
                },
                'Reaction Strategy': {
                    name: 'ëŒ€ì‘ ì „ëµ',
                    details: ['ëŒ€ì‘ ì „ëµì„ ì‹¤í–‰í•©ë‹ˆë‹¤.']
                }
            };
        
            // í•˜ìœ„ ìš°ì„ ìˆœìœ„ ëª©ë¡ (í•„ìš” ì‹œ ì¶”ê°€)
            const subPriorities = {};
        
            // ì¡°ê±´ ì •ì˜
            const conditions = {
                'A': 'ì‚¬ìš© ê°€ëŠ¥í•œ ë‚ ì”¨ ì¹´ë“œê°€ ìˆìŠµë‹ˆê¹Œ?',
                'B': 'ë‚ ì”¨ ì¹´ë“œ ê¸°ì¤€ì„ ì¶©ì¡±í•©ë‹ˆê¹Œ?<br><br><b>ë‚ ì”¨ ì¹´ë“œ ê¸°ì¤€</b><li>1d10ì„ êµ´ë¦½ë‹ˆë‹¤. ê²°ê³¼ê°€ í™œì„± ì•„êµ° ìœ ë‹› ìˆ˜ x 2ë³´ë‹¤ ì ìœ¼ë©´ ì‚¬ìš©í•©ë‹ˆë‹¤.</li> <li>ê¸°ìŠµ ì¹´ë“œì¸ ê²½ìš° ì£¼ì‚¬ìœ„ ê²°ê³¼ì— -2ë¥¼ ì ìš©í•©ë‹ˆë‹¤</li>',
                'C': 'SR ìƒí™©ì´ ìˆìŠµë‹ˆê¹Œ?',
                'E+(F or G)': 'ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <li>ì „íˆ¬ í—¥ìŠ¤ê°€ ë³´ê¸‰ ìƒíƒœì¸ ë³¸ë¶€ì˜ ë²”ìœ„ ì•ˆì— ìˆìŒ</li> <li>JN-25 ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê±°ë‚˜ ë°˜ê²© ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ[8]</li>',
                'I+J': 'ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <li>DEI ë° ë°©ì–´ ê²½ê³„ ëª©í‘œë¥¼ ì¶©ì¡±í•¨(ì´ˆê¸° ë‹¨ê³„ì—ì„œë§Œ)</li> <li>ê°€ë¯¸ì¹´ì œ ì¹´ë“œë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©° ê°€ë¯¸ì¹´ì œ ê³µê²© ê¸°ì¤€ì„ ì¶©ì¡±í•¨[8]</li><br><br><b>ê°€ë¯¸ì¹´ì œ ì¹´ë“œ ê¸°ì¤€</b><br>ê°€ë¯¸ì¹´ì œ ê³µê²©ì´ ê°€ëŠ¥í•œ ì „íˆ¬ í—¥ìŠ¤ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ê³ , ë‹¤ìŒ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤:<li>1. ìµœì†Œ í•œ ì²™ì˜ ì—°í•©êµ° BB ë˜ëŠ” CVì— ëª…ì¤‘í•  ìˆ˜ ìˆëŠ” ê²½ìš°</li> <li>2. 1ìŠ¤í… ì†ì‹¤ì´ ê°€ëŠ¥í•˜ë©° ì ì´ ì—†ëŠ”(Non-dot) ê³µì¤‘ ìœ ë‹›ì´ ìˆëŠ” ê²½ìš°</li>',
                'K+L': 'ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•©ë‹ˆê¹Œ? <li>ì‚¬ìš© ê°€ëŠ¥í•œ ì ìˆ˜í•¨ ê³µê²© ì¹´ë“œê°€ ìˆìŒ[8]</li> <li>ì ìˆ˜í•¨ ê³µê²© ì¹´ë“œì˜ íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ì  ìœ ë‹›ì´ ìµœì†Œ í•˜ë‚˜ ìˆìŒ</li>',
                'D': 'ì „íˆ¬ í—¥ìŠ¤ê°€ ìˆìŠµë‹ˆê¹Œ?',
                'E': 'ì „íˆ¬ í—¥ìŠ¤ê°€ ë³´ê¸‰ ìƒíƒœì¸ ë³¸ë¶€ì˜ ë²”ìœ„ ì•ˆì— ìˆìŠµë‹ˆê¹Œ?',
                'F': 'JN-25 ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?[8]',
                'G': 'ë°˜ê²© ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆê¹Œ?[8]',
                'H': 'ìµœì†Œ í•˜ë‚˜ì˜ ì „íˆ¬ í—¥ìŠ¤ì—ì„œ ëŒ€ì‘ ë¶€ëŒ€ ê¸°ì¤€ì„ ì¶©ì¡±í•©ë‹ˆê¹Œ?<br><br><b>ëŒ€ì‘ ë¶€ëŒ€ ê¸°ì¤€</b><br>ë‹¤ìŒ ê²½ìš°ì¼ ë•Œ, ìµœì†Œí•œ ìœ ë‹› # ê°œë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤:<li>1. ê³µì¤‘/í•´ìƒ í†µí•© ì „íˆ¬ë ¥ì´ ìƒëŒ€ ê³µì¤‘/í•´ìƒ ì „íˆ¬ë ¥ì˜ 1x ì´ìƒ</li><li>2. ì•„êµ° ê³µì¤‘ ìœ ë‹› # ê°œ = ì  ê³µì¤‘ ìœ ë‹› # ê°œ</li><li>3. 1D10 ì£¼ì‚¬ìœ„ êµ´ë¦¼ ê²°ê³¼: <ul><li>0-4: 2x ê²°ê³¼ì—ì„œ ì§€ìƒ ìœ ë‹›ì˜ ìƒëŒ€ ì§€ìƒ ìœ ë‹›ì„ ì œê±°í•  ìˆ˜ ìˆìŒ.</li> <li>5-9: ê¸°ì¤€ ì—†ìŒ.</li></ul></li>',
                'I': 'DEI ë° ë°©ì–´ ê²½ê³„ ëª©í‘œë¥¼ ì¶©ì¡±í•©ë‹ˆê¹Œ?(ì´ˆê¸° ë‹¨ê³„ì—ì„œë§Œ)',
                'J': 'ê°€ë¯¸ì¹´ì œ ì¹´ë“œë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©° ê°€ë¯¸ì¹´ì œ ê³µê²© ê¸°ì¤€ì„ ì¶©ì¡±í•©ë‹ˆê¹Œ?[8]',
                'K': 'ì‚¬ìš© ê°€ëŠ¥í•œ ì ìˆ˜í•¨ ê³µê²© ì¹´ë“œê°€ ìˆìŠµë‹ˆê¹Œ?[8]',
                'L': 'ì ìˆ˜í•¨ ê³µê²© ì¹´ë“œì˜ íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ì  ìœ ë‹›ì´ ìµœì†Œ í•˜ë‚˜ ìˆìŠµë‹ˆê¹Œ?'
            };
        
            let currentStep = 'start';
            let pathHistory = [];
            let stepCount = 0;
            let evaluatedConditions = {};
        
            function startFlow() {
                currentStep = 'A';
                stepCount = 1;
                pathHistory = [];
                evaluatedConditions = {};
                showStep('A');
            }
        
            function showStep(stepId) {
                const stepSection = document.getElementById('stepSection');
                const stepNumber = document.getElementById('stepNumber');
                const stepTitle = document.getElementById('stepTitle');
                const conditionBox = document.getElementById('conditionBox');
                const buttonGroup = document.getElementById('buttonGroup');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
        
                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
        
                stepNumber.textContent = stepCount;
        
                if (stepId === 'DICE') {
                    stepSection.classList.add('hidden');
                    diceSection.classList.remove('hidden');
                    document.getElementById('diceResult').textContent = '?';
                    return;
                }
        
                if (conditions[stepId]) {
                    stepTitle.textContent = `${stepId} í™•ì¸`;
                    conditionBox.innerHTML = ` ${conditions[stepId]}`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                        <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'start') {
                    stepTitle.textContent = 'ì‹œì‘';
                    conditionBox.innerHTML = `ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                    `;
                } else if (stepId === 'C') {
                    stepTitle.textContent = 'ê° SRì— ëŒ€í•´ êµ´ë¦¼';
                    conditionBox.innerHTML = ` ê° SRì— ëŒ€í•´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦½ë‹ˆë‹¤.`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="selectChoice('C', true)">ê³„ì†</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'If possible, roll for Intelligence') {
                    stepTitle.textContent = 'ì²©ë³´ êµ´ë¦¼ ê°€ëŠ¥ ì—¬ë¶€';
                    conditionBox.innerHTML = ` ê°€ëŠ¥í•˜ë‹¤ë©´ ì²©ë³´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦½ë‹ˆë‹¤. ì„±ê³µ ì—¬ë¶€ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('If possible, roll for Intelligence', 'success')">ì„±ê³µ</button>
                        <button class="btn btn-no" onclick="selectChoice('If possible, roll for Intelligence', 'failure')">ì‹¤íŒ¨</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                }
        
                updateProgress();
                updatePathHistory();
            }
        
            function selectChoice(conditionId, choice) {
                evaluatedConditions[conditionId] = choice;
                pathHistory.push({ step: conditionId, choice: choice, stepNum: stepCount });
                stepCount++;
        
                const nextStep = getNextStep(conditionId, choice);
        
                if (nextStep.startsWith('STRATEGY_')) {
                    const strategy = nextStep.replace('STRATEGY_', '');
                    showResult(strategy);
                } else if (nextStep === 'DICE') {
                    currentStep = nextStep;
                    showStep(nextStep);
                } else {
                    currentStep = nextStep;
                    showStep(nextStep);
                }
            }
        
            function getNextStep(conditionId, choice) {
                switch (conditionId) {
                    case 'A':
                        return choice ? 'B' : 'C';
                    case 'B':
                        return choice ? 'STRATEGY_Play Weather Reaction Card' : 'C';
                    case 'C':
                        return choice ? 'STRATEGY_Roll for each SR' : 'D' // 'ê³„ì†'ìœ¼ë¡œ Dë¡œ ì´ë™
                    case 'D':
                        return choice ? 'E+(F or G)' : 'K+L';
                    case 'E+(F or G)':
                        return choice ? 'DICE' : 'If possible, roll for Intelligence';
                    case 'If possible, roll for Intelligence':
                        return choice === 'success' ? 'H' : 'I+J';
                    case 'H':
                        return choice ? 'STRATEGY_Reaction Strategy' : 'I+J';
                    case 'I+J':
                        return choice ? 'STRATEGY_Play Kamikaze Attack Card' : 'K+L';
                    case 'K+L':
                        return choice ? 'STRATEGY_Play Submarine Attack Card' : 'STRATEGY_Execute PBM if applicable';
                    case 'Play Kamikaze Attack Card Continue':
                        return 'K+L';
                    case 'Play Submarine Attack Card Continue':
                        return 'STRATEGY_Execute PBM if applicable';
                    case 'Roll for each SR Continue':
                        return 'D';
                    case 'Reaction Strategy Continue':
                        return 'I+J';
                    case 'Play Intel-CO Reaction Card Continue':
                        return 'H';
                    default:
                        return 'start';
                }
            }
        
            function rollDice() {
                const diceValue = Math.floor(Math.random() * 10); // 0-9
                document.getElementById('diceResult').textContent = diceValue;
        
                let nextStep;
                if (diceValue === 0) {
                    nextStep = 'STRATEGY_Play Intel-CO Reaction Card';
                } else {
                    nextStep = 'If possible, roll for Intelligence';
                }
        
                pathHistory.push({
                    step: 'DICE',
                    choice: diceValue,
                    stepNum: stepCount,
                    isResult: true,
                    result: nextStep.replace('STRATEGY_', '')
                });
        
                setTimeout(() => {
                    if (nextStep.startsWith('STRATEGY_')) {
                        showResult(nextStep.replace('STRATEGY_', ''));
                    } else {
                        currentStep = nextStep;
                        showStep(nextStep);
                    }
                }, 1000);
            }
        
            function showResult(strategyKey) {
                const strategy = strategies[strategyKey];
                if (!strategy) {
                    console.error('Strategy not found:', strategyKey);
                    return;
                }
        
                const stepSection = document.getElementById('stepSection');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
                const strategyTitle = document.getElementById('strategyTitle');
                const strategyName = document.getElementById('strategyName');
                const strategyDetails = document.getElementById('strategyDetails');
                const buttonGroup = document.getElementById('resultSection').querySelector('.button-group');
        
                stepSection.classList.add('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.remove('hidden');
                strategyTitle.textContent = 'ìµœì¢… ë³‘ë ¥ êµ¬ì„±';
                strategyName.textContent = strategy.name;

                const continueStrategies = [];
                // const continueStrategies = ['Roll for each SR','Play Kamikaze Attack Card','Play Submarine Attack Card', 'Play Intel-CO Reaction Card', 'Reaction Strategy'];
                if (continueStrategies.includes(strategyKey)) {
                    // strategyDetails.innerHTML = '';
                    // buttonGroup.innerHTML = `
                    //     <button class="btn btn-primary" onclick="selectChoice('${strategyKey} Continue', true)">ê³„ì†</button>
                    //     <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                    //     ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    // `;
                    const annotationRegex = /\[\d+\]/g;
                    const parts = strategy.details.split(annotationRegex);
                    const annotations = strategy.details.match(annotationRegex);

                    let combined = '';
                    parts.forEach((part, i) => {
                        combined += part;
                        if (annotations && annotations[i]) {
                            const number = annotations[i].replace(/\[|\]/g, '');
                            combined += `<sup class="annotation" data-number="${number}">[${number}]</sup>`;
                        }
                    });
                    strategyDetails.innerHTML = combined;

                    // ê·¸ë¦¬ê³  ë²„íŠ¼ ê·¸ë£¹ì—ëŠ” "ê³„ì†" ë²„íŠ¼ + ê¸°ì¡´ ë²„íŠ¼ë“¤ ì¶”ê°€
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="selectChoice('${strategyKey} Continue', true)">ê³„ì†</button>
                        <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;

                } else {
                    const annotationRegex = /\[\d+\]/g;
                    const annotations = new Set();
                    if (strategy.name.match(annotationRegex)) {
                        strategy.name.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                    }
                    strategy.details.forEach(detail => {
                        if (detail.match(annotationRegex)) {
                            detail.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                        }
                    });
        
                    strategyDetails.innerHTML = `
                        <h4 style="margin-top: 0; color: #fff;">ë³‘ë ¥ êµ¬ì„± ì„¸ë¶€ì‚¬í•­:</h4>
                        <ul class="strategy-list">
                            ${strategy.details.map(detail => `
                                <li>
                                    ${detail}
                                    ${subPriorities[detail] ? `
                                        <ul class="sub-priority-list">
                                            ${subPriorities[detail].map(sub => `<li>${sub}</li>`).join('')}
                                        </ul>
                                    ` : ''}
                                </li>
                            `).join('')}
                        </ul>
                        ${annotations.size > 0 ? `
                            <h4 style="margin-top: 20px; color: #fff;">ì£¼ì„:</h4>
                            <ul class="strategy-list">
                                ${Array.from(annotations).sort().map(annotation => `
                                    <li class="impl-note">${annotation}: ${notes[annotation]}</li>
                                `).join('')}
                            </ul>
                        ` : ''}
                    `;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="selectChoice('${strategyKey} Continue', true)">ê³„ì†</button>
                        <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                }
        
                updateProgress();
                updatePathHistory();
            }
        
            function updateProgress() {
                const progressFill = document.getElementById('progressFill');
                const totalSteps = 15;
                const progress = Math.min((stepCount / totalSteps) * 100, 100);
                progressFill.style.width = progress + '%';
            }
        
            function updatePathHistory() {
                const pathHistoryDiv = document.getElementById('pathHistory');
                const pathStepsDiv = document.getElementById('pathSteps');
        
                if (pathHistory.length === 0) {
                    pathHistoryDiv.classList.add('hidden');
                    return;
                }
        
                pathStepsDiv.innerHTML = '';
        
                pathHistory.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = `path-step ${step.choice && step.step !== 'DICE' ? 'yes' : step.step !== 'DICE' ? 'no' : ''}`;
        
                    if (step.step === 'DICE') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice}</div>
                            <div>
                                <strong>ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°:</strong> ${step.choice} 
                                ${step.result ? `â†’ ${strategies[step.result].name}` : ''}
                            </div>
                        `;
                    } else if (step.choice === 'success' || step.choice === 'failure') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice === 'success' ? 'S' : 'F'}</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ${conditions[step.step] || step.step} â†’ ${step.choice === 'success' ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}
                            </div>
                        `;
                    } else {
                        let conditionText = conditions[step.step] || step.step;
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice ? 'Y' : 'N'}</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ${conditionText} â†’ ${step.choice ? 'YES' : 'NO'}
                            </div>
                        `;
                    }
        
                    pathStepsDiv.appendChild(stepDiv);
                });
        
                pathHistoryDiv.classList.remove('hidden');
            }
        
            function resetFlow() {
                currentStep = 'start';
                stepCount = 0;
                pathHistory = [];
                evaluatedConditions = {};
        
                const stepSection = document.getElementById('stepSection');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
                const pathHistoryDiv = document.getElementById('pathHistory');
                const stepNumber = document.getElementById('stepNumber');
                const stepTitle = document.getElementById('stepTitle');
                const conditionBox = document.getElementById('conditionBox');
                const buttonGroup = document.getElementById('buttonGroup');
                const progressFill = document.getElementById('progressFill');
        
                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                pathHistoryDiv.classList.add('hidden');
                stepNumber.textContent = '1';
                stepTitle.textContent = 'ì‹œì‘';
                conditionBox.innerHTML = 'ì—ë¼ìŠ¤ë¬´ìŠ¤ì˜ ëŒ€ì‘ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤';
                buttonGroup.innerHTML = '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>';
                progressFill.style.width = '0%';
            }
        
            function goBack() {
                if (pathHistory.length === 0) return;
        
                const lastStep = pathHistory.pop();
                stepCount--;
        
                if (lastStep.step !== 'DICE') {
                    delete evaluatedConditions[lastStep.step];
                }
        
                currentStep = pathHistory.length > 0 ? pathHistory[pathHistory.length - 1].step : 'start';
        
                const stepSection = document.getElementById('stepSection');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
        
                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                showStep(currentStep);
            }
        
            window.onload = resetFlow;
        </script>
  </template>

  <!-- 7. PBM -->
  <template id="tmpl-pbm">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Japanese Erasmus Bot - PBM</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #2e2e2e;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
                color: #d8d8d8;
            }
        
            .impl-note {
                font-style: italic;
                font-size: 14px;
                color: #ffffff;
                line-height: 1.6;
                margin: 4px 0;
            }
        
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
        
            .header {
                text-align: center;
                margin-bottom: 20px;
                padding: 15px;
                background: #4a4a4a;
                border-radius: 8px;
                color: #ffffff;
                border: 1px solid #5c5c5c;
            }
        
            .header h1 {
                margin: 0;
                font-size: 2rem;
                font-weight: 700;
            }
        
            .header p {
                margin: 8px 0 0 0;
                font-size: 1rem;
                font-weight: 400;
            }
        
            .progress-bar {
                background: #4a4a4a;
                border-radius: 5px;
                height: 6px;
                margin-bottom: 20px;
                overflow: hidden;
                border: 1px solid #5c5c5c;
            }
        
            .progress-fill {
                background: #4682b4;
                height: 100%;
                border-radius: 5px;
                transition: width 0.3s ease;
                width: 0%;
            }
        
            .step-section {
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid #5c5c5c;
            }
        
            .step-header {
                display: flex;
                align-items: center;
                margin-bottom: 15px;
            }
        
            .step-number {
                background: #4682b4;
                color: #ffffff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1rem;
                margin-right: 15px;
            }
        
            .step-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: #d8d8d8;
                margin: 0;
            }
        
            .condition-box {
                background: #4a4a4a;
                border-left: 4px solid #4682b4;
                border-radius: 5px;
                padding: 15px;
                margin: 15px 0;
                font-size: 1rem;
                line-height: 1.5;
                color: #c8c8c8;
            }
        
            .condition-box strong {
                color: #4682b4;
                font-size: 1.1rem;
            }
        
            .button-group {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 20px;
            }
        
            .btn {
                padding: 10px 30px;
                border: none;
                border-radius: 5px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s ease, transform 0.1s ease;
                text-transform: uppercase;
                min-width: 100px;
                font-family: 'Georgia', 'Times New Roman', Times, serif;
            }
        
            .btn-yes {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .btn-yes:hover {
                background: #257a4b;
                transform: translateY(-2px);
            }
        
            .btn-no {
                background: #696969;
                color: #ffffff;
            }
        
            .btn-no:hover {
                background: #585858;
                transform: translateY(-2px);
            }
        
            .btn-primary {
                background: #4682b4;
                color: #ffffff;
            }
        
            .btn-primary:hover {
                background: #3a6b9a;
                transform: translateY(-2px);
            }
        
            .btn-secondary {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-secondary:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .btn-back {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-back:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .path-history {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 15px;
                border-left: 3px solid #2e8b57;
            }
        
            .path-step {
                display: flex;
                align-items: center;
                margin: 8px 0;
                padding: 8px;
                background: #3c3c3c;
                border-radius: 5px;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }
        
            .path-step .step-icon {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 10px;
                font-size: 0.8rem;
            }
        
            .path-step.yes .step-icon {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .path-step.no .step-icon {
                background: #696969;
                color: #ffffff;
            }
        
            .dice-section {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin: 15px 0;
                border: 1px solid #5c5c5c;
            }
        
            .dice-result {
                font-size: 3rem;
                font-weight: bold;
                color: #d8d8d8;
                margin: 15px 0;
            }
        
            .result-section {
                background: #2e8b57;
                color: #ffffff;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin-top: 15px;
                border: 1px solid #3c3c3c;
            }
        
            .result-section h2 {
                margin: 0 0 15px 0;
                font-size: 2rem;
                display: none;
            }
        
            .result-section p {
                margin: 10px 0;
                font-size: 32px;
                white-space: pre-line;
                font-weight: bold;
                font-style: italic;
            }
        
            .strategy-details {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                padding: 15px;
                margin-top: 15px;
            }
        
            .strategy-list {
                text-align: left;
                margin: 15px 0;
                list-style: none;
                padding: 0;
            }
        
            .strategy-list li {
                margin: 8px 0;
                padding: 8px 10px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 5px;
                border-left: 3px solid rgba(255, 255, 255, 0.3);
            }
        
            .sub-priority-list {
                list-style: none;
                padding-left: 20px;
                margin-top: 5px;
            }
        
            .sub-priority-list li {
                margin: 5px 0;
                padding: 5px 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                border-left: 2px solid rgba(255, 255, 255, 0.4);
                font-size: 0.9rem;
            }
        
            .hidden {
                display: none;
            }
        
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                    margin: 10px;
                }
                
                .header h1 {
                    font-size: 1.5rem;
                }
                
                .button-group {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn {
                    width: 100%;
                    max-width: 180px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>PBM</h1>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="pathHistory" class="path-history hidden">
                <h4 style="margin-top: 0; color: #495057;">ì§„í–‰ ê²½ë¡œ</h4>
                <div id="pathSteps"></div>
            </div>

            <div id="stepSection" class="step-section">
                <div class="step-header">
                    <div class="step-number" id="stepNumber">1</div>
                    <h2 class="step-title" id="stepTitle">ì‹œì‘</h2>
                </div>
                
                <div class="condition-box" id="conditionBox">
                    ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>
                
                <div class="button-group" id="buttonGroup">
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>

            <div id="diceSection" class="dice-section hidden">
                <h3 style="margin: 0 0 20px 0; color: #2d3436;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (1d10)</h3>
                <div class="dice-result" id="diceResult">?</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="resultSection" class="result-section hidden">
                <h2 id="strategyTitle">ìµœì¢… ë³‘ë ¥ êµ¬ì„±</h2>
                <p id="strategyName"></p>
                <div class="strategy-details" id="strategyDetails"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <script>
            // Implementation notes
            const notes = {
                '[1]': 'ì„ íƒì§€ê°€ ìˆë‹¤ë©´, ë°˜ê²©(Counteroffensive) ì¹´ë“œë³´ë‹¤ ë¨¼ì € JN-25 ì²©ë³´(Intelligence) ì¹´ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.',
                '[2]': 'ì—¬ëŸ¬ ì  ìœ ë‹› ì¤‘ì—ì„œ ì„ íƒí•´ì•¼ í•  ê²½ìš°, ìš°ì„ ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: í•­ëª¨(CV) â†’ ì „í•¨(BB) â†’ ì¤‘ìˆœì–‘í•¨(CA) â†’ êµ¬ì¶•í•¨(DD). ë™ì¼ ìœ í˜•ì¼ ê²½ìš° ë°©ì–´ë ¥ì´ ê°€ì¥ ë†’ì€ ìœ ë‹›ì„ ì„ íƒí•©ë‹ˆë‹¤.',
                '[3]': 'ì—¬ëŸ¬ ì „íˆ¬ í—¥ìŠ¤ê°€ ê°€ëŠ¥í•  ê²½ìš°, ëŒ€ì‘ ì „ëµì˜ ìš°ì„ ìˆœìœ„ ëª©ë¡ì„ ë”°ë¼ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.',
                '[4]': '2ìŠ¤í… ì†ì‹¤ì„ ê°€í•  ë•Œë„ [2]ì™€ ë™ì¼í•˜ê²Œ, CV â†’ BB â†’ CA â†’ DD ìˆœì„œë¡œ, ê°™ì€ ìœ í˜• ì¤‘ì—ì„œëŠ” ë°©ì–´ë ¥ì´ ê°€ì¥ ë†’ì€ ìœ ë‹›ì„ ì„ íƒí•©ë‹ˆë‹¤.',
                '[5]': 'ìš°ì„ ìˆœìœ„ê°€ ë™ì¼í•œ ì „íˆ¬ í—¥ìŠ¤ê°€ ì—¬ëŸ¬ ê°œ ìˆì„ ê²½ìš°, ë¬´ì‘ìœ„ë¡œ ìˆœì„œë¥¼ ê²°ì •í•©ë‹ˆë‹¤.',
                '[6]': 'ìµœìš°ì„  ì „íˆ¬ í—¥ìŠ¤ì˜ ëŒ€ì‘ ë³‘ë ¥ ì¡°ê±´ì„ ë¨¼ì € ì¶©ì¡±í•´ì•¼ í•˜ë©°, ê·¸ë‹¤ìŒì€ ë‘ ë²ˆì§¸, ì„¸ ë²ˆì§¸ ìˆœìœ¼ë¡œ ì¶©ì¡±í•©ë‹ˆë‹¤.',
                '[7]': 'íŠ¹ì • ì „íˆ¬ í—¥ìŠ¤ ì¡°ê±´ì„ ì¶©ì¡±í•  ìˆ˜ ì—†ì„ ê²½ìš°, ë‹¤ìŒ ìš°ì„ ìˆœìœ„ ì „íˆ¬ í—¥ìŠ¤ë¡œ ê±´ë„ˆëœë‹ˆë‹¤. ì´ ê³¼ì •ì„ ë°˜ë³µí•˜ë‹¤ê°€ ë” ì´ìƒ ëŒ€ì‘í•  ì „íˆ¬ í—¥ìŠ¤ê°€ ì—†ìœ¼ë©´ ì¢…ë£Œí•©ë‹ˆë‹¤.',
                '[8]': 'ê°€ìš©(Available)"ì´ë€ ì¹´ë“œë¥¼ ì†ì— ë³´ìœ í•˜ëŠ” ê²ƒ ì™¸ì—ë„, Erasmusê°€ í•´ë‹¹ í˜ì´ì¦ˆì—ì„œ ìµœëŒ€ 3ì¥ì˜ ë³´ë„ˆìŠ¤ ë½‘ê¸° ì œí•œì„ ì•„ì§ ì´ˆê³¼í•˜ì§€ ì•Šì•˜ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.',
                '[9]': 'íŠ¹ì • ì „ëµì— PBMì´ ìˆë‹¤ë©´, ì´ í‘œë¥¼ ì ìš©í•˜ê¸° ì „ì— ë¨¼ì € ê·¸ê²ƒì„ ë”°ë¦…ë‹ˆë‹¤.',
                '[10]': 'ìš°ì„ ìˆœìœ„ í—¥ìŠ¤ê°€ ëª¨ë‘ ì¼ë³¸ AZOIì— ì´ë¯¸ ë“¤ì–´ê°€ ìˆëŠ” ê²½ìš°, ê·¸ ìš°ì„ ìˆœìœ„ëŠ” ê±´ë„ˆëœë‹ˆë‹¤.',
                '[11]': 'ì—¬ëŸ¬ ê³µêµ° ê¸°ì§€ê°€ ìˆì„ ê²½ìš°, ì—¬ëŸ¬ ìš°ì„ ìˆœìœ„ë¥¼ ë™ì‹œì— ì¶©ì¡±í•  ìˆ˜ ìˆëŠ” ê¸°ì§€ë¥¼ ìš°ì„ ì ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.',
                '[12]': 'í•œ ê³µêµ° ê¸°ì§€ì—ëŠ” ê³µì¤‘ ìœ ë‹›ì€ ìµœëŒ€ 1ê°œë§Œ ë°°ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                '[13]': 'ê°€ëŠ¥í•œ ê³µì¤‘ ìœ ë‹› ì¤‘ì—ì„œëŠ” ê°€ì¥ ê°•ë ¥í•œ ìœ ë‹›ì„ ì„ íƒí•©ë‹ˆë‹¤.',
                '[14]': 'ìì› í—¥ìŠ¤ê°€ ì—¬ëŸ¬ê°œì¸ ê²½ìš°, ê°€ì¥ ê°€ê¹Œìš´ ìì› í—¥ìŠ¤ â†’ ë‘ ë²ˆì§¸ë¡œ ê°€ê¹Œìš´ ìì› í—¥ìŠ¤ .. ìˆœìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.',
                '[15]': 'ëŒ€ì‘ ì¹´ë“œì— ë³´ë„ˆìŠ¤ ë½‘ê¸°ê°€ ì í˜€ ìˆì„ ê²½ìš°, ì£¼ì‚¬ìœ„ êµ´ë¦¼ì— -4ë¥¼ ì ìš©í•©ë‹ˆë‹¤.'
            };

            // ë³‘ë ¥ êµ¬ì„± ì •ë³´ ë°ì´í„°
            const strategies = {
                'Air PBM Strategy': { 
                    name: 'ê³µì¤‘ PBM ì „ëµ', 
                    details: [
                        'ë‹¤ìŒ ìš°ì„  ìˆœìœ„ì— ë”°ë¼ AZOIë¥¼ ì „ê°œí•  ìˆ˜ ìˆëŠ” ê³µêµ° ê¸°ì§€ê°€ ìˆëŠ” í—¥ìŠ¤ë¥¼ í–¥í•´ PBMì„ ìˆ˜í–‰í•©ë‹ˆë‹¤ [9][10][11]<li>1. AZOIê°€ ì—†ëŠ” ì¼ë³¸ ì—´ë„ ë°– ë³¸ë¶€.</li><li>2. ì—°í•©êµ° ë³¸ë¶€[13]</li><li>3. ì—°í•©êµ° AZOI ë‚´ ì¼ë³¸êµ° í•­êµ¬</li><li>4. ì—°í•©êµ° AZOI ë‚´ ì¼ë³¸êµ° ê³µêµ° ê¸°ì§€</li><li>5. ì—°í•©êµ° AZOI ë‚´ ì¼ë³¸êµ° ì§€ìƒ ìœ ë‹›</li><li>6. ê°€ì¥ ê°€ê¹Œìš´ ìì› í—¥ìŠ¤(ì—°í•©/ì¼ë³¸êµ°)[14]</li>'
                    ] 
                },
                'Naval PBM Strategy': { 
                    name: 'í•´ìƒ PBM ì „ëµ', 
                    details: [
                        'ìš°ì„  ìˆœìœ„ì— ë”°ë¼ ì•„êµ° í•­êµ¬ê°€ ìˆëŠ” í—¥ìŠ¤ë¥¼ í–¥í•´ í•´ìƒ ìœ ë‹› PBMì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:<li>1. í•´ìƒ ìœ ë‹›ì´ ì—†ê³  ë²”ìœ„ ë‚´ì— ìˆëŠ” ë‚¨í•´ ë³¸ë¶€.</li><li>2. ì§€ìƒ ìœ ë‹›ë§Œ ìˆëŠ” í•­êµ¬</li><li>3. ê°€ì¥ ê°€ê¹Œìš´ í•­êµ¬</li>'
                    ] 
                },
                'AA PBM Strategy': { 
                    name: 'AA ì§€ìƒ PBM ì „ëµ', 
                    details: [
                        'ìš°ì„  ìˆœìœ„ì— ë”°ë¼ ì•„êµ° í•­êµ¬ê°€ ìˆëŠ” í—¥ìŠ¤ë¥¼ í–¥í•´ ì§€ìƒ ìœ ë‹› PBMì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:<li>1. í•´ìƒ ìœ ë‹›ì´ ìˆëŠ” í•­êµ¬.</li><li>2. ê°€ì¥ ê°€ê¹Œìš´ í•­êµ¬.</li>'
                    ] 
                }
            };

            // í•˜ìœ„ ìš°ì„ ìˆœìœ„ ëª©ë¡ (í•„ìš” ì‹œ ì¶”ê°€)
            const subPriorities = {};

            // ì¡°ê±´ ì •ì˜
            const conditions = {
                'A': 'PBMì„ ìˆ˜í–‰í•  ê³µì¤‘ ìœ ë‹›ì´ ìˆìŠµë‹ˆê¹Œ?',
                'B': 'PBMì„ ìˆ˜í–‰í•  í•´ìƒ ìœ ë‹›ì´ ìˆìŠµë‹ˆê¹Œ?',
                'C': 'PBMì— ì‹¤íŒ¨í•œ AA ì§€ìƒ ìœ ë‹›ì´ ìˆìŠµë‹ˆê¹Œ?'
            };

            let currentStep = 'start';
            let pathHistory = [];
            let stepCount = 0;
            let evaluatedConditions = {};

            function startFlow() {
                currentStep = 'A';
                stepCount = 1;
                pathHistory = [];
                evaluatedConditions = {};
                showStep('A');
            }

            function showStep(stepId) {
                const stepSection = document.getElementById('stepSection');
                const stepNumber = document.getElementById('stepNumber');
                const stepTitle = document.getElementById('stepTitle');
                const conditionBox = document.getElementById('conditionBox');
                const buttonGroup = document.getElementById('buttonGroup');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
                const progressFill = document.getElementById('progressFill');
                const pathHistoryDiv = document.getElementById('pathHistory');
                const pathStepsDiv = document.getElementById('pathSteps');

                if (!stepSection || !stepNumber || !stepTitle || !conditionBox || !buttonGroup || !diceSection || !resultSection || !progressFill || !pathHistoryDiv || !pathStepsDiv) {
                    console.error('Show step elements are missing:', { stepSection, stepNumber, stepTitle, conditionBox, buttonGroup, diceSection, resultSection, progressFill, pathHistoryDiv, pathStepsDiv });
                    const missingElements = [];
                    if (!stepSection) missingElements.push('stepSection');
                    if (!stepNumber) missingElements.push('stepNumber');
                    if (!stepTitle) missingElements.push('stepTitle');
                    if (!conditionBox) missingElements.push('conditionBox');
                    if (!buttonGroup) missingElements.push('buttonGroup');
                    if (!diceSection) missingElements.push('diceSection');
                    if (!resultSection) missingElements.push('resultSection');
                    if (!progressFill) missingElements.push('progressFill');
                    if (!pathHistoryDiv) missingElements.push('pathHistoryDiv');
                    if (!pathStepsDiv) missingElements.push('pathStepsDiv');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');

                stepNumber.textContent = stepCount;

                if (stepId === 'DICE') {
                    stepSection.classList.add('hidden');
                    diceSection.classList.remove('hidden');
                    const diceResult = document.getElementById('diceResult');
                    if (diceResult) diceResult.textContent = '?';
                    return;
                }

                if (conditions[stepId]) {
                    stepTitle.textContent = `${stepId} í™•ì¸`;
                    conditionBox.innerHTML = `${conditions[stepId]}`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                        <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                } else if (stepId === 'start') {
                    stepTitle.textContent = 'ì‹œì‘';
                    conditionBox.innerHTML = `PBM ê²°ì • ì‹œì‘`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                    `;
                } else if (stepId === 'End') {
                    stepTitle.textContent = 'ì¢…ë£Œ';
                    conditionBox.innerHTML = `PBM í”„ë¡œì„¸ìŠ¤ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`;
                    buttonGroup.innerHTML = `
                        <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                        ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                    `;
                }

                updateProgress();
                updatePathHistory();
            }

            function selectChoice(conditionId, choice) {
                evaluatedConditions[conditionId] = choice;
                pathHistory.push({ step: conditionId, choice: choice, stepNum: stepCount });
                stepCount++;

                const nextStep = getNextStep(conditionId, choice);

                if (nextStep.startsWith('STRATEGY_')) {
                    const strategy = nextStep.replace('STRATEGY_', '');
                    showResult(strategy);
                } else {
                    currentStep = nextStep;
                    showStep(nextStep);
                }
            }

            function getNextStep(conditionId, choice) {
                switch (conditionId) {
                    case 'A':
                        return choice ? 'STRATEGY_Air PBM Strategy' : 'B';
                    case 'B':
                        return choice ? 'STRATEGY_Naval PBM Strategy' : 'C';
                    case 'C':
                        return choice ? 'STRATEGY_AA PBM Strategy' : 'End';
                    default:
                        return 'start';
                }
            }

            function rollDice() {
                const diceSection = document.getElementById('diceSection');
                const diceResult = document.getElementById('diceResult');
                if (!diceSection || !diceResult) {
                    console.error('Dice section or result element is missing:', { diceSection, diceResult });
                    const missingElements = [];
                    if (!diceSection) missingElements.push('diceSection');
                    if (!diceResult) missingElements.push('diceResult');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                const diceValue = Math.floor(Math.random() * 10); // 0-9
                diceResult.textContent = diceValue;

                let nextStep;
                if (diceValue === 0) {
                    nextStep = 'STRATEGY_Air PBM Strategy';
                } else {
                    nextStep = 'B';
                }

                pathHistory.push({
                    step: 'DICE',
                    choice: diceValue,
                    stepNum: stepCount,
                    isResult: true,
                    result: nextStep.replace('STRATEGY_', '')
                });

                setTimeout(() => {
                    if (nextStep.startsWith('STRATEGY_')) {
                        showResult(nextStep.replace('STRATEGY_', ''));
                    } else {
                        currentStep = nextStep;
                        showStep(nextStep);
                    }
                }, 1000);
            }

            function showResult(strategyKey) {
                const resultSection = document.getElementById('resultSection');
                const strategyTitle = document.getElementById('strategyTitle');
                const strategyName = document.getElementById('strategyName');
                const strategyDetails = document.getElementById('strategyDetails');
                const buttonGroup = resultSection ? resultSection.querySelector('.button-group') : null;

                if (!resultSection || !strategyTitle || !strategyName || !strategyDetails || !buttonGroup) {
                    console.error('Result section elements are missing:', { resultSection, strategyTitle, strategyName, strategyDetails, buttonGroup });
                    const missingElements = [];
                    if (!resultSection) missingElements.push('resultSection');
                    if (!strategyTitle) missingElements.push('strategyTitle');
                    if (!strategyName) missingElements.push('strategyName');
                    if (!strategyDetails) missingElements.push('strategyDetails');
                    if (!buttonGroup) missingElements.push('buttonGroup');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                const strategy = strategies[strategyKey];
                if (!strategy) {
                    console.error('Strategy not found:', strategyKey);
                    alert('í•´ë‹¹ ì „ëµì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.');
                    return;
                }

                stepSection.classList.add('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.remove('hidden');
                strategyTitle.textContent = 'PBM ì „ëµ';
                strategyName.textContent = strategy.name;

                // ì£¼ì„ ì¶”ì¶œì„ ìœ„í•œ ì •ê·œ í‘œí˜„ì‹
                const annotationRegex = /\[\d+\]/g;
                const annotations = new Set();

                // strategy.nameì—ì„œ ì£¼ì„ ì¶”ì¶œ
                if (strategy.name.match(annotationRegex)) {
                    strategy.name.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                }

                // strategy.detailsì—ì„œ ì£¼ì„ ì¶”ì¶œ
                strategy.details.forEach(detail => {
                    if (detail.match(annotationRegex)) {
                        detail.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                    }
                });

                strategyDetails.innerHTML = `
                    <h4 style="margin-top: 0; color: #fff;">ì„¸ë¶€ì‚¬í•­:</h4>
                    <ul class="strategy-list">
                        ${strategy.details.map(detail => `
                            <li>
                                ${detail}
                                ${subPriorities[detail] ? `
                                    <ul class="sub-priority-list">
                                        ${subPriorities[detail].map(sub => `<li>${sub}</li>`).join('')}
                                    </ul>
                                ` : ''}
                            </li>
                        `).join('')}
                    </ul>
                    ${annotations.size > 0 ? `
                        <h4 style="margin-top: 20px; color: #fff;">ì£¼ì„:</h4>
                        <ul class="strategy-list">
                            ${Array.from(annotations).sort().map(annotation => `
                                <li class="impl-note">${annotation}: ${notes[annotation]}</li>
                            `).join('')}
                        </ul>
                    ` : ''}
                `;
                buttonGroup.innerHTML = `
                    <button class="btn btn-primary" onclick="startFlow()">ê³„ì†</button>
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;

                updateProgress();
                updatePathHistory();
            }

            function updateProgress() {
                const progressFill = document.getElementById('progressFill');
                if (progressFill) {
                    const totalSteps = 3; // A, B, C ì¡°ê±´ì— ê¸°ë°˜
                    const progress = Math.min((stepCount / totalSteps) * 100, 100);
                    progressFill.style.width = progress + '%';
                }
            }

            function updatePathHistory() {
                const pathHistoryDiv = document.getElementById('pathHistory');
                const pathStepsDiv = document.getElementById('pathSteps');
                if (!pathHistoryDiv || !pathStepsDiv) {
                    console.error('Path history elements are missing:', { pathHistoryDiv, pathStepsDiv });
                    const missingElements = [];
                    if (!pathHistoryDiv) missingElements.push('pathHistoryDiv');
                    if (!pathStepsDiv) missingElements.push('pathStepsDiv');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                if (pathHistory.length === 0) {
                    pathHistoryDiv.classList.add('hidden');
                    return;
                }

                pathStepsDiv.innerHTML = '';

                pathHistory.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = `path-step ${step.choice && step.step !== 'DICE' ? 'yes' : step.step !== 'DICE' ? 'no' : ''}`;

                    if (step.step === 'DICE') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice}</div>
                            <div>
                                <strong>ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°:</strong> ${step.choice} 
                                ${step.result ? `â†’ ${strategies[step.result].name}` : ''}
                            </div>
                        `;
                    } else if (step.choice === 'success' || step.choice === 'failure') {
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice === 'success' ? 'S' : 'F'}</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ${conditions[step.step] || step.step} â†’ ${step.choice === 'success' ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}
                            </div>
                        `;
                    } else {
                        let conditionText = conditions[step.step] || step.step;
                        stepDiv.innerHTML = `
                            <div class="step-icon">${step.choice ? 'Y' : 'N'}</div>
                            <div>
                                <strong>${step.step}:</strong> 
                                ${conditionText} â†’ ${step.choice ? 'YES' : 'NO'}
                            </div>
                        `;
                    }

                    pathStepsDiv.appendChild(stepDiv);
                });

                pathHistoryDiv.classList.remove('hidden');
            }

            function resetFlow() {
                const stepSection = document.getElementById('stepSection');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
                const pathHistoryDiv = document.getElementById('pathHistory');
                const stepNumber = document.getElementById('stepNumber');
                const stepTitle = document.getElementById('stepTitle');
                const conditionBox = document.getElementById('conditionBox');
                const buttonGroup = document.getElementById('buttonGroup');
                const progressFill = document.getElementById('progressFill');

                if (!stepSection || !diceSection || !resultSection || !pathHistoryDiv || !stepNumber || !stepTitle || !conditionBox || !buttonGroup || !progressFill) {
                    console.error('Reset flow elements are missing:', {
                        stepSection, diceSection, resultSection, pathHistoryDiv, stepNumber, stepTitle, conditionBox, buttonGroup, progressFill
                    });
                    const missingElements = [];
                    if (!stepSection) missingElements.push('stepSection');
                    if (!diceSection) missingElements.push('diceSection');
                    if (!resultSection) missingElements.push('resultSection');
                    if (!pathHistoryDiv) missingElements.push('pathHistoryDiv');
                    if (!stepNumber) missingElements.push('stepNumber');
                    if (!stepTitle) missingElements.push('stepTitle');
                    if (!conditionBox) missingElements.push('conditionBox');
                    if (!buttonGroup) missingElements.push('buttonGroup');
                    if (!progressFill) missingElements.push('progressFill');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                currentStep = 'start';
                stepCount = 0;
                pathHistory = [];
                evaluatedConditions = {};

                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                pathHistoryDiv.classList.add('hidden');
                stepNumber.textContent = '1';
                stepTitle.textContent = 'ì‹œì‘';
                conditionBox.innerHTML = 'PBMì„ ìˆ˜í–‰í•  ìœ ë‹›ì„ ê²°ì •í•©ë‹ˆë‹¤';
                buttonGroup.innerHTML = '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>';
                progressFill.style.width = '0%';
            }

            function goBack() {
                if (pathHistory.length === 0) return;

                const lastStep = pathHistory.pop();
                stepCount--;

                if (lastStep.step !== 'DICE') {
                    delete evaluatedConditions[lastStep.step];
                }

                currentStep = pathHistory.length > 0 ? pathHistory[pathHistory.length - 1].step : 'start';

                const stepSection = document.getElementById('stepSection');
                const diceSection = document.getElementById('diceSection');
                const resultSection = document.getElementById('resultSection');
                if (!stepSection || !diceSection || !resultSection) {
                    console.error('Go back elements are missing:', { stepSection, diceSection, resultSection });
                    const missingElements = [];
                    if (!stepSection) missingElements.push('stepSection');
                    if (!diceSection) missingElements.push('diceSection');
                    if (!resultSection) missingElements.push('resultSection');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                stepSection.classList.remove('hidden');
                diceSection.classList.add('hidden');
                resultSection.classList.add('hidden');
                showStep(currentStep);
            }

            // DOMì´ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹¤í–‰
            document.addEventListener('DOMContentLoaded', () => {
                window.onload = resetFlow;
            });
        </script>
  </template>

  <!--  -->

  <template id="tmpl-offensive">
    <!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ê³µì„¸ í”Œë¡œìš°ì°¨íŠ¸</title>
        <style>
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #2e2e2e;
                min-height: 100vh;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
                color: #d8d8d8;
            }

            .red {
            color: red;
            font-style: italic;
            font-weight: bold;
            }

            .bold {
                color: white;
                font-size: 1.1rem;
                font-weight: bold;
            }
        
            .impl-note {
                font-style: italic;
                font-size: 14px;
                color: #ffffff;
                line-height: 1.6;
                margin: 4px 0;
            }
        
            .container {
                max-width: 800px;
                margin: 0 auto;
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            }
        
            .header {
                text-align: center;
                margin-bottom: 20px;
                padding: 15px;
                background: #4a4a4a;
                border-radius: 8px;
                color: #ffffff;
                border: 1px solid #5c5c5c;
            }
        
            .header h1 {
                margin: 0;
                font-size: 2rem;
                font-weight: 700;
            }
        
            .header p {
                margin: 8px 0 0 0;
                font-size: 1rem;
                font-weight: 400;
            }
        
            .progress-bar {
                background: #4a4a4a;
                border-radius: 5px;
                height: 6px;
                margin-bottom: 20px;
                overflow: hidden;
                border: 1px solid #5c5c5c;
            }
        
            .progress-fill {
                background: #4682b4;
                height: 100%;
                border-radius: 5px;
                transition: width 0.3s ease;
                width: 0%;
            }
        
            .step-section {
                background: #3c3c3c;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 15px;
                border: 1px solid #5c5c5c;
            }
        
            .step-header {
                display: flex;
                align-items: center;
                margin-bottom: 15px;
            }
        
            .step-number {
                background: #4682b4;
                color: #ffffff;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1rem;
                margin-right: 15px;
            }
        
            .step-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: #d8d8d8;
                margin: 0;
            }
        
            .condition-box {
                background: #4a4a4a;
                border-left: 4px solid #4682b4;
                border-radius: 5px;
                padding: 15px;
                margin: 15px 0;
                font-size: 1rem;
                line-height: 1.5;
                color: #c8c8c8;
            }
        
            .condition-box strong {
                color: #4682b4;
                font-size: 1.1rem;
            }
        
            .button-group {
                display: flex;
                gap: 15px;
                justify-content: center;
                margin-top: 20px;
            }
        
            .btn {
                padding: 10px 30px;
                border: none;
                border-radius: 5px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s ease, transform 0.1s ease;
                text-transform: uppercase;
                min-width: 100px;
                font-family: 'Georgia', 'Times New Roman', Times, serif;
            }
        
            .btn-yes {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .btn-yes:hover {
                background: #257a4b;
                transform: translateY(-2px);
            }
        
            .btn-no {
                background: #696969;
                color: #ffffff;
            }
        
            .btn-no:hover {
                background: #585858;
                transform: translateY(-2px);
            }
        
            .btn-primary {
                background: #4682b4;
                color: #ffffff;
            }
        
            .btn-primary:hover {
                background: #3a6b9a;
                transform: translateY(-2px);
            }
        
            .btn-secondary {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-secondary:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .btn-back {
                background: #5c5c5c;
                color: #ffffff;
            }
        
            .btn-back:hover {
                background: #4b4b4b;
                transform: translateY(-2px);
            }
        
            .path-history {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 15px;
                border-left: 3px solid #2e8b57;
            }
        
            .path-step {
                display: flex;
                align-items: center;
                margin: 8px 0;
                padding: 8px;
                background: #3c3c3c;
                border-radius: 5px;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            }
        
            .path-step .step-icon {
                width: 25px;
                height: 25px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                margin-right: 10px;
                font-size: 0.8rem;
            }
        
            .path-step.yes .step-icon {
                background: #2e8b57;
                color: #ffffff;
            }
        
            .path-step.no .step-icon {
                background: #696969;
                color: #ffffff;
            }
        
            .dice-section {
                background: #4a4a4a;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin: 15px 0;
                border: 1px solid #5c5c5c;
            }
        
            .dice-result {
                font-size: 3rem;
                font-weight: bold;
                color: #d8d8d8;
                margin: 15px 0;
            }
        
            .result-section {
                background: #2e8b57;
                color: #ffffff;
                border-radius: 8px;
                padding: 20px;
                text-align: center;
                margin-top: 15px;
                border: 1px solid #3c3c3c;
            }
        
            .result-section h2 {
                margin: 0 0 15px 0;
                font-size: 2rem;
                display: none;
            }
        
            .result-section p {
                margin: 10px 0;
                font-size: 32px;
                white-space: pre-line;
                font-weight: bold;
                font-style: italic;
            }
        
            .strategy-details {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 5px;
                padding: 15px;
                margin-top: 15px;
            }
        
            .strategy-list {
                text-align: left;
                margin: 15px 0;
                list-style: none;
                padding: 0;
            }
        
            .strategy-list li {
                margin: 8px 0;
                padding: 8px 10px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 5px;
                border-left: 3px solid rgba(255, 255, 255, 0.3);
            }
        
            .sub-priority-list {
                list-style: none;
                padding-left: 20px;
                margin-top: 5px;
            }
        
            .sub-priority-list li {
                margin: 5px 0;
                padding: 5px 10px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                border-left: 2px solid rgba(255, 255, 255, 0.4);
                font-size: 0.9rem;
            }
        
            .hidden {
                display: none;
            }
        
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                    margin: 10px;
                }
                
                .header h1 {
                    font-size: 1.5rem;
                }
                
                .button-group {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn {
                    width: 100%;
                    max-width: 180px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>ê³µì„¸ ì ˆì°¨ í”Œë¡œìš°</h1>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div id="pathHistory" class="path-history hidden">
                <h4 style="margin-top: 0; color: #ffffff;">ì§„í–‰ ê²½ë¡œ</h4>
                <div id="pathSteps"></div>
            </div>

            <div id="stepSection" class="step-section">
                <div class="step-header">
                    <div class="step-number" id="stepNumber">1</div>
                    <h2 class="step-title" id="stepTitle">ì‹œì‘</h2>
                </div>
                
                <div class="condition-box" id="conditionBox">
                    ì²« ë²ˆì§¸ ì¡°ê±´ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>
                
                <div class="button-group" id="buttonGroup">
                    <button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>
                </div>
            </div>

            <div id="diceSection" class="dice-section hidden">
                <h3 style="margin: 0 0 20px 0; color: #2d3436;">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° (1d10)</h3>
                <div class="dice-result" id="diceResult">?</div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="rollDice()">ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
                </div>
            </div>

            <div id="resultSection" class="result-section hidden">
                <h2 id="strategyTitle">ìµœì¢… ì „ëµ ê²°ì •</h2>
                <p id="strategyName"></p>
                <div class="strategy-details" id="strategyDetails"></div>
                <div class="button-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>
                </div>
            </div>
        </div>

        <script>
            const notes = {
                '[7.21]': '<span class="bold">[7.21] ê³µê²© í”Œë ˆì´ì–´ ìœ ë‹› í™œì„±í™”</span><br> ê³µê²© í”Œë ˆì´ì–´ëŠ” ê³µì„¸ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ë³´ê¸‰ ìƒíƒœì˜ HQë¥¼ ì„ íƒí•©ë‹ˆë‹¤. <br>í”Œë ˆì´ì–´ëŠ” ê³µê²©ì— ì‚¬ìš©í•˜ëŠ” HQì˜ íš¨ìœ¨ì„± ë“±ê¸‰ê³¼ OC ìˆ˜ì¹˜ ë˜ëŠ” ì´ë²¤íŠ¸ ë³‘ì°¸ ìˆ˜ì¹˜ ì¤‘ í•˜ë‚˜ë¥¼ í•©í•œ ê°’ì— í•´ë‹¹í•˜ëŠ” ìˆ˜ ë§Œí¼ì˜ ìœ ë‹›ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤*.  <br><br><span class="red">í™œì„±í™” ìœ ë‹› ìˆ˜ = HQ íš¨ìœ¨ì„± ë“±ê¸‰ + ì´ë²¤íŠ¸ ë³‘ì°¸ ìˆ˜ì¹˜ / OC ìˆ˜ì¹˜ ì¤‘ í•˜ë‚˜</span> <br><br>ë¯¸êµ° ë° ì—°í•©êµ° HQì´ ì§€ë„ì˜ ë™ìª½ ê°€ì¥ìë¦¬ì— ìˆëŠ” ì ˆëŒ€ ë³´ê¸‰ì›ê³¼ ì—°ê²°í•  ìˆ˜ ì—†ëŠ” ê²½ìš°(6.25), ì¼ë³¸êµ° HQê°€ CBI ì¸í”„ë¼ê°€ ë¶€ì¡±í•œ ê²½ìš°ì—(13.79) HQ íš¨ìœ¨ì„± ìˆ˜ì¹˜ê°€ ë°”ë€” ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™œì„±í™” ìœ ë‹›ì€ ë³´ê¸‰ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤. ìœ ë‹›ì„ í™œì„±í™”í•˜ë ¤ë©´ í•´ë‹¹ HQë¶€í„° í™œì„±í™” ìœ ë‹›ê¹Œì§€ í™œì„±í™” ê²½ë¡œì´ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤(6.3). <br>êµ°ê°„ ê²½ìŸ*Inter-Servie Rivalry*(14.0)ìœ¼ë¡œ í™œì„±í™” ìœ ë‹›ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br><br>ì—°í•©êµ° HQëŠ” ì´ë²¤íŠ¸ ì¹´ë“œ í…ìŠ¤íŠ¸ì— ëª…ì‹œë˜ì§€ ì•ŠëŠ” í•œ íŠ¹ì • êµ­ì ì˜ ìœ ë‹›ë§Œ í™œì„±í™” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. <br> - ë¯¸êµ­(ì˜ˆ: ì¤‘ë¶€, ë‚¨ë¶€(ê³°ë¦¬Ghormley ë˜ëŠ” í™€ì§€Halsey), ë‚¨ì„œë¶€) <br> - ì˜ì—°ë°©(ì˜ˆ: ë§ë¼ì•¼*Malaya*, SEAC)<br> - í•©ë™(ì˜ˆ: ANZAC, ABDA).<br><br><span class="red">*ì¼ë³¸ì—ëŠ” í•œ ê°€ì§€ ìœ í˜•ì˜ HQë§Œ ìˆìŠµë‹ˆë‹¤.</span><br><br>A. ë¯¸êµ­ HQëŠ” ë¯¸êµ­ ìœ ë‹›(ìœ¡êµ° ë° í•´êµ° ëª¨ë‘)ê³¼ ì¤‘êµ­ ìœ ë‹›ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>B. ì˜ì—°ë°© HQëŠ” ì˜ì—°ë°©, ì¤‘êµ­, ë¯¸êµ­ ê³µêµ° ìœ ë‹›(ë¯¸ ìœ¡êµ° ë° í•´ë³‘ ê³µêµ° ìœ ë‹› ëª¨ë‘)ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>C. í•©ë™ HQëŠ” ëª¨ë“  ì—°í•©êµ° ìœ ë‹›ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì°¸ê³ : ë„¤ëœë€ë“œ ìœ ë‹›ì€ í•©ë™ HQë§Œ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>D. ì¼ë³¸ ë³¸ë¶€ëŠ” ëª¨ë“  ì¼ë³¸ ìœ ë‹›ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                '[7.22]': '<span class="bold">[7.22] ìœ ë‹› ì´ë™ í—ˆìš©ëŸ‰</span><br>ê³µê²© ë˜ëŠ” ëŒ€ì‘ ìœ ë‹›ì´ ì´ë™í•  ìˆ˜ ìˆëŠ” ê±°ë¦¬: <br><br> <span class="red">ì´ë™ ê°€ëŠ¥ ê±°ë¦¬ = OC ìˆ˜ì¹˜ * ìœ ë‹› íƒ€ì…ë³„ ê¸°ë³¸ ì´ë™ í—ˆìš©ëŸ‰</span> <br><b>ì´ë™ í—ˆìš©ëŸ‰: í•´ìƒ = 5, ì§€ìƒ = 1, ê³µì¤‘ = ì¼ë°˜/í™•ì¥ ë²”ìœ„)</b> <br><br><b>ì˜ˆì™¸</b>: ì¹´ë“œë¥¼ ECë¡œ ì‚¬ìš©í•œ ê²½ìš°, ì¹´ë“œì˜ OC ìˆ˜ì¹˜ë³´ë‹¤ ë” ë§ì´ ìœ ë‹›ì„ ì´ë™ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ì´ë²¤íŠ¸ê°€ ìš°ì„ í•©ë‹ˆë‹¤.<br> í•­ê³µ ìœ ë‹›ì€ ì´ë™ì˜ ê° "ë‹¨ê³„"ë¥¼ ì•„êµ° ê³µêµ°ê¸°ì§€ì—ì„œ ëë‚´ì•¼ í•˜ë¯€ë¡œ ì´ë™ì´ ì œí•œë©ë‹ˆë‹¤ (8.31). í•´êµ° ìœ ë‹›ì€ ì´ë™ì„ ëë‚¼ ìˆ˜ ìˆëŠ” í—¥ìŠ¤ê°€ ì œí•œë©ë‹ˆë‹¤(8.21).',
                '[7.23]': '<span class="bold">[7.23] ê³µì„¸ ì¤‘ ì´ë™ ë‹¨ê³„</span><br>ê³µì„¸ ì¤‘ì— ìœ ë‹›ì„ ì´ë™í•  ë•ŒëŠ” ë‹¤ë¥¸ ìœ ë‹›ì´ë‚˜ ìœ ë‹› ìŠ¤íƒì„ ì´ë™í•˜ê¸° ì „ì— ê° ìœ ë‹› ìŠ¤íƒ ì´ë™ì„ ëë‚´ì•¼ í•©ë‹ˆë‹¤. <br>ì´ë™ ì¤‘ì—ëŠ” ìœ ë‹›ì„ í”½ì—…í•˜ê±°ë‚˜ ë‚´ë ¤ë†“ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. <br>ê³µì„¸ ì¤‘ì— ì´ë™í•˜ëŠ”ë° ê°€ì¥ í° ì¥ì• ë¬¼ì€ ë¬´ë ¥í™”ë˜ì§€ ì•Šì€ ì ì˜ í•­ê³µ ZOIì˜ ìœ„ì¹˜ì…ë‹ˆë‹¤.',
                '[7.24]': '<span class="bold">[7.24] ì „íˆ¬ í—¥ìŠ¤ ì„ ì–¸í•˜ê¸°</span><br>ê³µê²© í”Œë ˆì´ì–´ëŠ” ê³µê²© ìœ ë‹›ì´ ëª¨ë‘ ì´ë™í•œ í›„ì— ì „íˆ¬ í—¥ìŠ¤ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤. <br>ê³µê²© ìœ ë‹›ê³¼ ëŒ€ì‘ ìœ ë‹›ì´ í•¨ê»˜ ìˆëŠ” ëª¨ë“  í—¥ìŠ¤ë¥¼ ì „íˆ¬ í—¥ìŠ¤ë¡œ ì„ ì–¸í•´ì•¼ í•©ë‹ˆë‹¤. <br>ë‹¤ë¥¸ ì „íˆ¬ì— ì°¸ì—¬í•˜ì§€ ì•Šì€ ê³µê²© í”Œë ˆì´ì–´ì˜ í™œì„±í™”ëœ ê³µì¤‘/í•­ëª¨ ìœ ë‹›ì˜ ë²”ìœ„ ì•ˆì— ì „íˆ¬ í—¥ìŠ¤ê°€ ìˆê³  ì „íˆ¬ í—¥ìŠ¤ì— ëŒ€ì‘ ìœ ë‹›ë§Œ ìˆë‹¤ë©´, í•´ë‹¹ í—¥ìŠ¤ë¥¼ ì „íˆ¬ í—¥ìŠ¤ë¡œ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>ì¤‘êµ­ì— ìˆëŠ” í•´ì•ˆì´ ì•„ë‹Œ í—¥ìŠ¤ëŠ” ì „íˆ¬ í—¥ìŠ¤ë¡œ ì„ ì–¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><br> OCë¥¼ ì‚¬ìš©í•  ë•Œ, í”Œë ˆì´ì–´ëŠ” ì „íˆ¬ í—¥ìŠ¤ í•˜ë‚˜ë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>ëŒ€ì‘ í”Œë ˆì´ì–´ì˜ íŠ¹ìˆ˜ ëŒ€ì‘(7.27)ìœ¼ë¡œ OCë¥¼ ì‚¬ìš©í•  ë•Œ ì—¬ëŸ¬ ì „íˆ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br> ECë¥¼ í”Œë ˆì´í•  ë•Œ, í”Œë ˆì´ì–´ëŠ” ì›í•˜ëŠ” ë§Œí¼ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br> ê³µê²© í”Œë ˆì´ì–´ëŠ” ì„ ì–¸í•œ ì „íˆ¬ í—¥ìŠ¤ë§ˆë‹¤ í•´ë‹¹ í—¥ìŠ¤ ì „íˆ¬ì— ì°¸ê°€í•  ìœ ë‹›ì„ ì •í•´ì•¼ í•©ë‹ˆë‹¤. <br>ì–´ë–¤ ìœ ë‹›ë„ ê³µì„¸ ë‹¹ í•œ ë²ˆ ì´ìƒ ì „íˆ¬ì— ì°¸ì—¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤(ë‹¨, ì•„ë˜ì—ì„œ ì–¸ê¸‰í•˜ë“¯ì´ íŠ¹ì • ìƒí™©ì—ì„œëŠ” íŠ¹ìˆ˜ ëŒ€ì‘ìœ¼ë¡œ ì¸í•´ ìœ ë‹›ì„ êµì²´í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤). <br>ì „íˆ¬ í—¥ìŠ¤ì— ì†í•œ ëª¨ë“  ìœ ë‹›ì€ í•´ë‹¹ ì „íˆ¬ì— ì°¸ì—¬í•´ì•¼ í•©ë‹ˆë‹¤. <br><br>ì•„êµ° í•­êµ¬ì—ì„œ ì´ë™ì„ ë§ˆì¹˜ì§€ ì•Šì€ ëª¨ë“  í•­ê³µëª¨í•¨ ìœ ë‹›ì€ ë²”ìœ„ ë‚´ ì „íˆ¬ í—¥ìŠ¤ì— ì°¸ì—¬í•˜ê±°ë‚˜ ì ì´ í†µì œí•˜ëŠ” ë¹„ì–´ ìˆëŠ” í—¥ìŠ¤ì— ìƒë¥™ ê³µê²©í•˜ëŠ” ì•„êµ° ì§€ìƒ ìœ ë‹›ì„ ì—„í˜¸í•˜ë„ë¡ ì„ ì–¸í•´ì•¼ í•©ë‹ˆë‹¤. <br>í• ë‹¹ëœ ì—„í˜¸ í—¥ìŠ¤ê°€ íŠ¹ìˆ˜ ëŒ€ì‘ìœ¼ë¡œ ì „íˆ¬ í—¥ìŠ¤ê°€ ë˜ë©´ í•­ê³µëª¨í•¨ì€ í•´ë‹¹ ì „íˆ¬ì— ì°¸ì—¬í•´ì•¼ í•©ë‹ˆë‹¤.<br>ì•„êµ° í•­êµ¬ì—ì„œ ì´ë™ì„ ë§ˆì¹œ í•­ê³µëª¨í•¨ê³¼ ì„ ì–¸ëœ ì „íˆ¬ì— ì°¸ì—¬í•˜ì§€ ì•Šì€ í™œì„±í™”ëœ í•­ê³µ ìœ ë‹›ë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë²”ìœ„ ë‚´ ì „íˆ¬ë¥¼ ì—„í˜¸í•˜ë„ë¡ ì§€ì •ë  ìˆ˜ ìˆì§€ë§Œ ë°˜ë“œì‹œ ì°¸ì—¬í•´ì•¼ í•˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.',
                '[7.25]': '<span class="bold">[7.25] ê³µì„¸ ì²©ë³´ ì¡°ê±´ ê²°ì •</span><br>ê³µì„¸ ì²©ë³´ ì¡°ê±´ì€ ê³µì„¸ê°€ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ëª¨ë“  ì „íˆ¬ í—¥ìŠ¤ì— ë™ì¼í•˜ê²Œ ì ìš©ë©ë‹ˆë‹¤.<br> ë”°ë¼ì„œ ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ì²©ë³´ ì¡°ê±´ì„ ë³€ê²½í•˜ëŠ” ë° ì„±ê³µí•˜ë©´, í•´ë‹¹ ê³µì„¸ ë•Œ ì„ ì–¸ëœ ëª¨ë“  ì „íˆ¬ í—¥ìŠ¤ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤. <br><br>A. ê³µì„¸ ì²©ë³´ ì¡°ê±´ì€ ê¸°ë³¸ì ìœ¼ë¡œ ê¸°ìŠµ ê³µê²©(Surprise Attack)ì…ë‹ˆë‹¤. <br><br>B. ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ë‹¤ìŒ ë‘ ê°€ì§€ ì¤‘ í•˜ë‚˜ë¡œ ì²©ë³´ ì¡°ê±´ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>ì²«ì§¸, ì²©ë³´ ì¡°ê±´ì„ ì €ì§€(Intercept) ë˜ëŠ” ë§¤ë³µ(Ambush)ìœ¼ë¡œ ì§€ì •í•˜ëŠ” ëŒ€ì‘ ì¹´ë“œë¥¼ í”Œë ˆì´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ì‘ ì¹´ë“œë¥¼ í”Œë ˆì´í•˜ë©´ ì „ëµ ì¹´ë“œê°€ ì§€ì •í•œ ì²©ë³´ ì¡°ê±´ì„ ëŒ€ì²´í•©ë‹ˆë‹¤. ëŒ€ì‘ ì¹´ë“œë¥¼ ì—¬ëŸ¬ì¥ ì‚¬ìš©í•´ì„œ ì €ì§€ì™€ ë§¤ë³µ ì²©ë³´ ì¡°ê±´ì´ ëª¨ë‘ ì§€ì •ë˜ì—ˆë‹¤ë©´, ì²©ë³´ ì¡°ê±´ì€ ë§¤ë³µì…ë‹ˆë‹¤.<br><br> ë‘˜ì§¸, ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ì¹´ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ê³  ê³µì„¸ ì¹´ë“œì— ê¸°ìŠµ ê³µê²©ì´ ëª…ì‹œë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°(ë‹¨, ì´ ê²½ìš°ì—ë§Œ í•´ë‹¹), ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ì²©ë³´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì²©ë³´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦¬ë©´ ì²©ë³´ ì¡°ê±´ì„ ê¸°ìŠµ ê³µê²©ì—ì„œ ì €ì§€ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë§¤ë³µì€ ë°”ê¿€ ìˆ˜ëŠ” ì—†ê³  ë§¤ë³µìœ¼ë¡œ ë°”ê¾¸ë ¤ë©´ ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•´ì•¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤). ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ì •ë³´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦° í›„ì—ëŠ” ëŒ€ì‘ ì¹´ë“œ í…ìŠ¤íŠ¸ì—ì„œ íŠ¹ë³„íˆ í—ˆìš©í•˜ì§€ ì•ŠëŠ” í•œ, ì²©ë³´ ì¡°ê±´ì„ ë°”ê¾¸ê¸° ìœ„í•´ ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ê³µì„¸ ë‹¹ í•œ ë²ˆë§Œ ì •ë³´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br><br>C. ì²©ë³´ ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ì ˆì°¨ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. ê³µì„¸ë¥¼ ì‹œì‘í•˜ëŠ”ë° ì‚¬ìš©ëœ ì¹´ë“œì—ëŠ” OCì™€ EC ì²©ë³´ ìˆ˜ì¹˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¹´ë“œì˜ OC ìˆ˜ì¹˜ë¡œ ê³µì„¸ê°€ ì‹œì‘ë˜ì—ˆë‹¤ë©´, OC ì²©ë³´ ìˆ˜ì¹˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ê³µì„¸ê°€ EC ê³µì„¸ë¡œ ì‹œì‘ë˜ì—ˆë‹¤ë©´, EC ì²©ë³´ ìˆ˜ì¹˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì£¼ì‚¬ìœ„ êµ´ë¦¼ ê²°ê³¼ê°€ í•´ë‹¹ ê³µì„¸ ì¹´ë“œ ì²©ë³´ ìˆ˜ì¹˜(ì•„ë˜ 7.25.Eì— ë”°ë¼ í•´ë‹¹ë˜ëŠ” ê²½ìš° ìˆ˜ì •ë¨)ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìœ¼ë©´ ì£¼ì‚¬ìœ„ êµ´ë¦¼ì´ ì„±ê³µí•˜ê³  ê³µì„¸ ì²©ë³´ ì¡°ê±´ì´ ì €ì§€ë¡œ ë³€ê²½ë©ë‹ˆë‹¤. ì£¼ì‚¬ìœ„ êµ´ë¦¼ì´ ì§€ì •ëœ ê°’ë³´ë‹¤ í¬ë©´ ì£¼ì‚¬ìœ„ êµ´ë¦¼ì€ ì‹¤íŒ¨í•˜ë©°, ê³µì„¸ ì²©ë³´ ì¡°ê±´ì€ ê¸°ìŠµ ê³µê²©ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤. <br><br>D. ì²©ë³´ ì£¼ì‚¬ìœ„ ê°’ì„ ë³´ì •í•  ìˆ˜ ìˆëŠ” í•œ ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ê³µê²© í”Œë ˆì´ì–´ì˜ ìœ ë‹›ì´ ì´ë™í•˜ëŠ” ë™ì•ˆ ì–¸ì œë“ ì§€ í•´ë‹¹ ìœ ë‹›ì´(ë¬´ë ¥í™” ì—¬ë¶€ì™€ ìƒê´€ì—†ì´) ì ì˜ í•­ê³µ ZOIë¡œ ì§„ì…í•˜ê±°ë‚˜ í†µê³¼í•˜ê±°ë‚˜ ë¹ ì ¸ë‚˜ì˜¤ë©´, ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ìì‹ ì˜ ì²©ë³´ ì£¼ì‚¬ìœ„ êµ´ë¦¼ì—ì„œ 2ë¥¼ ëºë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ìˆ˜ì •ë˜ì§€ ì•Šì€ ì£¼ì‚¬ìœ„ ê²°ê³¼ê°€ 9ì¸ ê²½ìš° í•­ìƒ ì‹¤íŒ¨ë¡œ ê°„ì£¼í•˜ë©° ê¸°ìŠµ ê³µê²©ìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.',
                '[7.26]': '<span class="bold">[7.26] ëŒ€ì‘ ì´ë™</span><br>ì²©ë³´ ì¡°ê±´ì´ ê¸°ìŠµ ê³µê²©ì´ë©´ ëŒ€ì‘ ì´ë™ì„ í•  ìˆ˜ ì—†ìœ¼ë©°, ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ê³µê²© ëŒ€ì‘ ì¹´ë“œë¥¼ í”Œë ˆì´í•  ê¸°íšŒë¥¼ ê°€ì§„ í›„ì— ê³µê²© í”Œë ˆì´ì–´ê°€ ê³µì„¸ë¡œ ë°œìƒí•œ ëª¨ë“  ì „íˆ¬ë¥¼ ì¦‰ì‹œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì²©ë³´ ì¡°ê±´ì´ ì €ì§€ ë˜ëŠ” ë§¤ë³µì¸ ê²½ìš°, ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ë³´ê¸‰ ìƒíƒœì˜ HQ ì¤‘ í•˜ë‚˜ë§Œ ëŒ€ì‘ HQë¡œ ì§€ì •í•  ìˆ˜ ìˆìœ¼ë©°, ì´ HQë¡œ ì „íˆ¬ì— ëŒ€ì‘í•  ìœ ë‹›ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ HQì˜ ë²”ìœ„ ë‚´ì— ì„ ì–¸ëœ ì „íˆ¬ í—¥ìŠ¤ê°€ í•˜ë‚˜ ì´ìƒ ìˆì–´ì•¼ í•˜ë©°(ì´ ë²”ìœ„ëŠ” ì–´ë–¤ ë°©ë²•ìœ¼ë¡œë„ ë§‰ì„ ìˆ˜ ì—†ìŒ), ì¡°ê±´ì— ë§ëŠ” HQê°€ ì—†ìœ¼ë©´ ê³µì„¸ì— ëŒ€ì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‘ HQê°€ í™œì„±í™”í•œ ìœ ë‹›ì€ ë„ë‹¬í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì„ ì–¸í•œ ì „íˆ¬ì— ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë•Œ í•´ë‹¹ ì „íˆ¬ í—¥ìŠ¤ê°€ ëŒ€ì‘ HQ ë²”ìœ„ ë°–ì— ìˆë”ë¼ë„ ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br><br>ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” HQì˜ <span class="red">íš¨ìœ¨ì„± ë“±ê¸‰ + ë°©ì–´ì ë³‘ì°¸ ìˆ˜ì¹˜</span>ë§Œí¼ì˜ ìœ ë‹›ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°˜ê²© ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•œ ê²½ìš°, ë°˜ê²© ëŒ€ì‘ ì¹´ë“œì˜ ë³‘ì°¸ ìˆ˜ì¹˜ê°€ ë°©ì–´ìì˜ ë³‘ì°¸ ìˆ˜ì¹˜ì…ë‹ˆë‹¤. <br>ë°˜ê²© ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ê³µê²© í”Œë ˆì´ì–´ì˜ ì „ëµ ì¹´ë“œì˜ OC ìˆ˜ì¹˜ê°€ ë°©ì–´ìì˜ ë³‘ì°¸ ìˆ˜ì¹˜ì…ë‹ˆë‹¤(OCë¡œ í”Œë ˆì´í–ˆëŠ”ì§€ ECë¡œ í”Œë ˆì´í–ˆëŠ”ì§€ ì—¬ë¶€ì™€ ìƒê´€ì—†ìŠµë‹ˆë‹¤). ëŒ€ì‘ HQëŠ” ë³´ê¸‰ì„ ë°›ê³  ìˆê³  HQê¹Œì§€ í™œì„±í™” ê²½ë¡œê°€ ì´ì–´ì§€ëŠ” ìœ ë‹›ë§Œ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ì‘í•˜ê¸° ìœ„í•œ í™œì„±í™” ê²½ë¡œëŠ” ì  ìœ ë‹›ì´ í¬í•¨ë˜ì–´ ìˆë”ë¼ë„ ì„ ì–¸ëœ ì „íˆ¬ í—¥ìŠ¤ë¥¼ í†µí•´ í˜•ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br><br>ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ í™œì„±í™”í•œ ëª¨ë“  ìœ ë‹›ì€ ì„ ì–¸í•œ ì „íˆ¬ì— ì°¸ì—¬í•´ì•¼ í•©ë‹ˆë‹¤. ì „íˆ¬ì— ì°¸ì—¬í•  ìˆ˜ ìˆë„ë¡ ì´ë™í•  ìˆ˜ ì—†ëŠ” ìœ ë‹›ì€ í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì „íˆ¬ í—¥ìŠ¤ì— ìˆëŠ” ëŒ€ì‘ ìœ ë‹›ì€ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì²©ë³´ ì¡°ê±´ì´ ì €ì§€ ë˜ëŠ” ë§¤ë³µì´ë¼ê³  í•´ì„œ ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ê¼­ ìœ ë‹›ì„ í™œì„±í™”í•´ì•¼í•˜ëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤. ê³µê²© í™œì„±í™”ì— ì ìš©ë˜ëŠ” ëª¨ë“  ì œí•œ ì‚¬í•­ì´ ëŒ€ì‘ í™œì„±í™”ì—ë„ ì ìš©ë©ë‹ˆë‹¤. <br><br>ëŒ€ì‘ ì´ë™ ì¤‘ì— ì—¬ëŸ¬ê°œì˜ ASPë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‘ ì´ë™ ì¤‘ì— í•´êµ° ìˆ˜ì†¡ í¸ì œ ìœ ë‹›(Organic Naval Unit Transport/8.46)ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ì „ëµ ì´ë™ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í™œì„±í™”ëœ í•­ê³µ ë° í•­ê³µëª¨í•¨ ìœ ë‹›ì€ ì „íˆ¬ê°€ ì²˜ë¦¬ë˜ê¸° ì „ì— ëŒ€ì‘ ì´ë™ìœ¼ë¡œ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ë– ë‚  ìˆ˜ ìˆì§€ë§Œ, ë– ë‚œ ì „íˆ¬ í—¥ìŠ¤ì—ì„œ ë²Œì–´ì§€ê³  ìˆëŠ” ì „íˆ¬ì— ê³„ì† ì°¸ì—¬í•´ì•¼ í•©ë‹ˆë‹¤. ì „íˆ¬ í—¥ìŠ¤ì—ì„œ ì‹œì‘í•œ ë‹¤ë¥¸ ìœ ë‹›ì€ í™œì„±í™”ë˜ë”ë¼ë„ í•´ë‹¹ ì „íˆ¬ í—¥ìŠ¤ì— ë‚¨ì•„ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.',
                '[7.27]': '<span class="bold">[7.27] íŠ¹ìˆ˜ ëŒ€ì‘ ì´ë™(SR)</span><br>ìƒëŒ€ ì§€ìƒ ìœ ë‹›ì´ <b>â‘´ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ í†µì œí•˜ê³  ìˆëŠ” ë¹„ì–´ìˆëŠ” ë„ì‹œ, â‘µìì› í—¥ìŠ¤, â‘¶í•­êµ¬, â‘·ëŒ€ì‘ HQ ë²”ìœ„ ë‚´ì— ìˆê³  ëŒ€ì‘ í•­ê³µ ZOI(ë¬´ë ¥í™” ì—¬ë¶€ì™€ ìƒê´€ì—†ì´) ë²”ìœ„ ë‚´ì— ìˆëŠ” ë¹„í–‰ì¥ í—¥ìŠ¤</b>ì—ì„œ ê³µê²© ì´ë™ì„ ëëƒˆë‹¤ë©´, ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” í•˜ë‚˜ ì´ìƒì˜ í•´ë‹¹ í—¥ìŠ¤ì—ì„œ íŠ¹ìˆ˜ ëŒ€ì‘ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ì²©ë³´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ íŠ¹ìˆ˜ ëŒ€ì‘ ì„±ê³µ ì—¬ë¶€ë¥¼ íŒë‹¨í•©ë‹ˆë‹¤(ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì§€ë§Œ, ZOI ë³´ì •ìœ¼ë¡œ -2ë¥¼ ì ìš©í•©ë‹ˆë‹¤). ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ ì„±ê³µí•˜ë©´, í•´ë‹¹ í—¥ìŠ¤ëŠ” ì „íˆ¬ í—¥ìŠ¤ê°€ ë©ë‹ˆë‹¤. ì´ëŠ” ê³µê²© í”Œë ˆì´ì–´ê°€ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ì„ ì–¸í–ˆëŠ”ì§€ëŠ” ìƒê´€ì—†ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í—¥ìŠ¤ ë‘ ê°œ ì´ìƒì´ íŠ¹ìˆ˜ ëŒ€ì‘ì— í•´ë‹¹í•œë‹¤ë©´ ê° í—¥ìŠ¤ë§ˆë‹¤ ì£¼ì‚¬ìœ„ë¥¼ ë”°ë¡œ êµ´ë ¤ì•¼ í•©ë‹ˆë‹¤. <br><br>ì§€ìƒ ì´ë™ë§Œìœ¼ë¡œ ì§„ì…í•œ í—¥ìŠ¤ì—ì„œëŠ” íŠ¹ìˆ˜ ëŒ€ì‘ì„ ì ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¸°ìŠµ ê³µê²© EC ì´ë²¤íŠ¸ì—ì„œ íŠ¹ìˆ˜ ëŒ€ì‘ ê°€ëŠ¥ì„±ì´ ë°œìƒí•˜ë©´ OC ì²©ë³´ ìˆ˜ì¹˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. íŠ¹ìˆ˜ ëŒ€ì‘ë§Œìœ¼ë¡œëŠ” ì²©ë³´ ì¡°ê±´ì´ ë°”ë€Œì§€ ì•ŠìŠµë‹ˆë‹¤. <br><br>ìƒˆë¡œ ìƒì„±ëœ ì „íˆ¬ í—¥ìŠ¤ì—ì„œ ì§„í–‰í•˜ëŠ” ìƒë¥™ ì‘ì „ì„ ì—„í˜¸í•˜ë„ë¡ í• ë‹¹ëœ ëª¨ë“  ê³µì¤‘/í•­ëª¨ ìœ ë‹›ì€ í•´ë‹¹ ì „íˆ¬ì— ì°¸ì—¬í•©ë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±ëœ ì „íˆ¬ í—¥ìŠ¤ì— ë²”ìœ„ ë‚´ì— ë‹¤ë¥¸ ì „íˆ¬ì— ì°¸ì—¬í•˜ê¸°ë¡œ ì„ ì–¸ëœ ê³µì¤‘/í•­ëª¨ ìœ ë‹›ì´ ìˆê³ , ì ì´ í•´ë‹¹ ì „íˆ¬ í—¥ìŠ¤ì— ëŒ€ì‘í•˜ëŠ” ê²½ìš°, í•´ë‹¹ ê³µì¤‘/í•­ëª¨ ìœ ë‹›ì€ ìì‹ ì´ ì ë ¹í•˜ê³  ìˆëŠ” ì „íˆ¬ í—¥ìŠ¤ì—ì„œ ë²Œì–´ì§„ ì „íˆ¬ë¡œ ì „í™˜í•˜ê³  ì´ë¥¼ ë¨¼ì € ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ëŠ” ë©€ë¦¬ì„œ ì´ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ê³µê²©í•˜ëŠ” ëŒ€ì‘ ìœ ë‹›ì—ê² ì ìš©ë˜ì§€ ì•Šìœ¼ë©°, ìƒˆë¡œ ìƒì„±ëœ ì „íˆ¬ í—¥ìŠ¤ì— ëŒ€ì‘ ìœ ë‹›ì´ ë¬¼ë¦¬ì ìœ¼ë¡œ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤. <br><br>í•´ë‹¹ ìœ ë‹›ì˜ ì›ë˜ ë°°í‹€ í—¥ìŠ¤ì— ê³µì„¸ì— ì°¸ì—¬í•œ ë‹¤ë¥¸ ìœ ë‹›ì´ ì—†ë‹¤ë©´ í•´ë‹¹ ìœ„ì¹˜ì—ëŠ” ì „íˆ¬ê°€ ë°œìƒí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ í•´ë‹¹ í—¥ìŠ¤ëŠ” ì—¬ì „íˆ ì „íˆ¬ í—¥ìŠ¤ë¡œ ë‚¨ì•„ ìˆìœ¼ë©° í•´ë‹¹ ì „íˆ¬ í—¥ìŠ¤ì— íˆ¬ì…ëœ ëª¨ë“  ìœ ë‹›ì€ ì „íˆ¬ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šê³  ì „íˆ¬ í—¥ìŠ¤ì— íˆ¬ì…ëœ ìƒíƒœë¡œ ìœ ì§€ë©ë‹ˆë‹¤. ê·œì¹™ì— ë”°ë¼ ì›ë˜ ì „íˆ¬ í—¥ìŠ¤ì— ìˆëŠ” ëª¨ë“  ëŒ€ì‘ ìœ ë‹›ì€ ë‹¤ë¥¸ ì „íˆ¬ì— ì°¸ì—¬í•  ìˆ˜ ì—†ì§€ë§Œ, í™œì„±í™”ë˜ë©´ ì „íˆ¬ í›„ ì´ë™(Post Battle Movement)ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”Œë ˆì´ì–´ê°€ ì „íˆ¬ í—¥ìŠ¤ë¡œ ì„ ì–¸í•œ í—¥ìŠ¤ì—ì„œ ì „íˆ¬ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°ëŠ” ì ìˆ˜í•¨ ê³µê²©ìœ¼ë¡œ ì „íˆ¬ë¥¼ ì²˜ë¦¬í•˜ê¸° ì „ì— ëª¨ë“  ê³µì„¸ ìœ ë‹›ì„ ì œê±°í•˜ëŠ” ê²½ìš°ì™€ ê°™ì´ ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                '[7.28]': '<span class="bold">[7.28] ì „íˆ¬ì™€ ê³µì„¸ ë§ˆë¬´ë¦¬</span><br>ê° ì „íˆ¬ëŠ” ê·œì¹™ 9.0ì— ë”°ë¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ê·¸ í›„, ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ë¨¼ì € í™œì„±í™”ëœ ëª¨ë“  ìœ ë‹›ì— ëŒ€í•´ ì „íˆ¬ í›„ ì´ë™ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤(9.6). ì´ë•Œ ê³µì„¸ê°€ ì¢…ë£Œë˜ê³  ìƒëŒ€ í”Œë ˆì´ì–´ê°€ ì „ëµ ì¹´ë“œë¥¼ ë‚´ê±°ë‚˜, ë‘ í”Œë ˆì´ì–´ ëª¨ë‘ ì¹´ë“œê°€ ì—†ëŠ” ê²½ìš° ê³µì„¸ ë‹¨ê³„ê°€ ì¢…ë£Œë©ë‹ˆë‹¤.',
                '[9.6]': '<span class="bold">[9.6] ì „íˆ¬ í›„ ì´ë™ (Post Battle Movement)</span><br>ì „íˆ¬ í›„ ì´ë™ì€ ì „íˆ¬ ìˆ˜í–‰ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ ê·œì¹™ 7.2ì˜ 13ë²ˆì§¸ ë‹¨ê³„ ë•Œ ì²˜ë¦¬ë©ë‹ˆë‹¤. <br>ì „ëµ ì´ë™ì„ ìˆ˜í–‰í•˜ì§€ ì•Šì€ í™œì„±í™” ìœ ë‹›ë§Œ ì „íˆ¬ í›„ ì´ë™ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br><br>ì „íˆ¬ í›„ ì´ë™ì„ ìˆ˜í–‰í•  ë•Œ, ê³µêµ° ë° í•´êµ° ìœ ë‹›ì˜ ì´ë™ í—ˆìš©ëŸ‰ì€ ê³µì„¸ì— ì‚¬ìš©ëœ ì´ë™ í—ˆìš©ëŸ‰ê³¼ ë™ì¼í•©ë‹ˆë‹¤. <br>ì§€ìƒ ìœ ë‹›ì€ í›„í‡´í•  ë•Œë¥¼ ì œì™¸í•˜ê³  ì „íˆ¬ í›„ ì´ë™ì„ ìˆ˜í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤(9.5). ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ë¨¼ì € ì „íˆ¬ í›„ ì´ë™ì„ ìˆ˜í–‰í•œ í›„ ê³µê²© í”Œë ˆì´ì–´ê°€ ê·¸ ë‹¤ìŒì— ìˆ˜í–‰í•©ë‹ˆë‹¤. <br><br><span class="red">ì „íˆ¬ í›„ ì´ë™ ì¤‘ì—ëŠ” ì–´ë–¤ í˜•íƒœì˜ ì „ëµ ì´ë™ë„ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>',
                '[8.32]': '<span class="bold">[8.32] ê¸´ê¸‰ ê³µì¤‘ ì´ë™ (Emergency Air Move)</span><br><br><br>ê³µì„¸ ë˜ëŠ” ì •ì¹˜ ë‹¨ê³„(êµ­ê°€ í•­ë³µì„ í†µí•´)ì¤‘ì— í”Œë ˆì´ì–´ê°€ í™œì„±í™”ë˜ì§€ ì•Šì€ ì  ê³µì¤‘ ìœ ë‹›ì´ ìœ„ì¹˜í•œ í—¥ìŠ¤ì˜ í†µì œê¶Œì„ ê°€ì ¸ì˜¨ ê²½ìš°, í•´ë‹¹ ê³µì¤‘ ìœ ë‹›ì€ ê¸´ê¸‰ ê³µì¤‘ ì´ë™ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ê³µì„¸ ì¤‘ì— í—¥ìŠ¤ í†µì œê¶Œì´ ë°”ë€ ê²½ìš°, ê³µì„¸ê°€ ëë‚˜ê³  ë‚˜ì„œ ì´ë™í•©ë‹ˆë‹¤. ì •ì¹˜ ë‹¨ê³„ì—ì„œ ë°œìƒí•œ ê²½ìš° í•´ë‹¹ ë‹¨ê³„ê°€ ëë‚œ í›„ ì´ë™í•©ë‹ˆë‹¤. <br><br>ì •ìƒ ë˜ëŠ” í™•ì¥ ë²”ìœ„ ë‚´ì— ì•„êµ° ë¹„í–‰ì¥ì´ ìˆëŠ” ê²½ìš°, ê³µì¤‘ ìœ ë‹›ì€ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë°”ë¡œ ë°°ì¹˜ë©ë‹ˆë‹¤. ì´ ì¡°ê±´ì„ ì¶©ì¡±í•˜ëŠ” ë¹„í–‰ì¥ì´ ë‘ ê³³ ì´ìƒì¼ ê²½ìš°, ì†Œìœ í•œ í”Œë ˆì´ì–´ê°€ ìœ ë‹›ì„ ì´ë™í•  ë¹„í–‰ì¥ì„ ì„ íƒí•©ë‹ˆë‹¤. ë²”ìœ„ ë‚´ì— ì•„êµ° ë¹„í–‰ì¥ì´ ì—†ìœ¼ë©´ ê³µì¤‘ ìœ ë‹›ì€ ì œê±°ë©ë‹ˆë‹¤. ê³µì¤‘ ìœ ë‹›ì´ ì „íˆ¬ì— ì°¸ì—¬í–ˆë”ë¼ë„ ê´„í˜¸ ì•ˆì˜ í™•ì¥ëœ ë²”ìœ„ë¥¼ ê¸´ê¸‰ ê³µì¤‘ ì´ë™ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                '[8.22]': '<span class="bold">[8.22] ê¸´ê¸‰ í•´ìƒ ì´ë™ (Emergency Naval Move)</span><br><br><br>ê³µì„¸ ë˜ëŠ” ì •ì¹˜ ë‹¨ê³„(êµ­ê°€ í•­ë³µì„ í†µí•´)ì¤‘ì— í”Œë ˆì´ì–´ê°€ í™œì„±í™”ë˜ì§€ ì•Šì€ ì  í•´êµ° ìœ ë‹›ì´ ìˆëŠ” í—¥ìŠ¤ í†µì œê¶Œì„ ê°€ì ¸ì™”ë‹¤ë©´ í•´ë‹¹ í•´êµ° ìœ ë‹›ì€ ê¸´ê¸‰ í•´ìƒ ì´ë™ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ê³µì„¸ ì¤‘ì— í—¥ìŠ¤ í†µì œê¶Œì´ ë°”ë€ ê²½ìš°, ê³µì„¸ê°€ ëë‚˜ê³  ë‚˜ì„œ ì´ë™í•©ë‹ˆë‹¤. ì •ì¹˜ ë‹¨ê³„ì—ì„œ ë°œìƒí•œ ê²½ìš° í•´ë‹¹ ë‹¨ê³„ê°€ ëë‚œ í›„ ì´ë™í•©ë‹ˆë‹¤. <br><br>ê¸´ê¸‰ í•´ìƒ ì´ë™ ì‹œ í•´êµ° ìœ ë‹›ì€ ì§€í˜• ìƒê´€ ì—†ì´ 10 í—¥ìŠ¤ê±°ë¦¬ ì´ë‚´ì— ìˆëŠ” ì•„êµ° í•­êµ¬ì— ë°°ì¹˜ë©ë‹ˆë‹¤(ì´ë™í•˜ëŠ” ê²ƒì´ ì•„ë‹˜). ë²”ìœ„ ë‚´ì— ì•„êµ° í•­êµ¬ê°€ ë‘ ê°œ ì´ìƒ ìˆëŠ” ê²½ìš°, ì†Œìœ í•œ í”Œë ˆì´ì–´ê°€ ìœ ë‹›ì„ ì˜®ê¸¸ í•­êµ¬ë¥¼ ì„ íƒí•©ë‹ˆë‹¤. ìƒëŒ€ì˜ í•­ê³µ ZOIì€ ê¸´ê¸‰ í•´ìƒ ì´ë™ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠìŠµë‹ˆë‹¤. 10 í—¥ìŠ¤ ê±°ë¦¬ì— ì•„êµ° í•­êµ¬ê°€ ì—†ìœ¼ë©´ í•´êµ° ìœ ë‹›ì€ ì œê±°ë©ë‹ˆë‹¤.',

            };
            const steps = [
                { id: '1ë‹¨ê³„', text: '<li>ê³µê²© í”Œë ˆì´ì–´ëŠ” ì í•©í•œ HQì˜ í™œì„±í™” ë²”ìœ„ ë‚´ì— ìˆëŠ” ë³´ê¸‰ ìƒíƒœì˜ ìœ ë‹›ì„ í™œì„±í™”í•©ë‹ˆë‹¤[7.21].</li> <li>ì´ë™í•˜ê¸° ì „ì— ì ìš©ë˜ëŠ” EC ì¹´ë“œì˜ ëª¨ë“  ê³µì„¸ ë³´ë„ˆìŠ¤ë¥¼ ì ìš©í•©ë‹ˆë‹¤(ì¦ì› ë³‘ë ¥ ìˆ˜ë ¹ í¬í•¨)</li>' },
                { id: '2ë‹¨ê³„', text: '<li>ê³µê²© í”Œë ˆì´ì–´ê°€ í™œì„±í™”ëœ ìœ ë‹›ì„ ì´ë™í•©ë‹ˆë‹¤ [7.22] [7.23]</li>' },
                { id: '3ë‹¨ê³„', text: '<li>ê³µê²© í”Œë ˆì´ì–´ê°€ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤ [7.24]</li>' },
                { id: '4ë‹¨ê³„', text: '<li>ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ë‚ ì”¨ ëŒ€ì‘ ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³µì„¸ë¥¼ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li> <li>ê³µì„¸ê°€ ì·¨ì†Œë˜ë©´ ëª¨ë“  ìœ ë‹›ì„ ë‹¤ì‹œ ì‹œì‘ ìœ„ì¹˜ë¡œ ë˜ëŒë¦¬ê³ ,</li> <li>ì´ë²¤íŠ¸ ì¦ì› ìœ ë‹›ê³¼ ë³´ì¶© ìœ ë‹›ì„ ì œê±°í•˜ê³ ,</li> <li>ì‚¬ìš©í•œ ê³µì„¸ ì¹´ë“œë¥¼ ë²„ë¦° ì¹´ë“œ ë”ë¯¸ì— ë„£ê³ ,</li> <li>ê³µì„¸ ì¤‘ì— ì‚¬ìš©í•œ ëª¨ë“  ASPë¥¼ ë°˜í™˜í•˜ë©´ ê³µê²©ì´ ì¢…ë£Œë©ë‹ˆë‹¤[7.28].</li>' },
                { id: '5ë‹¨ê³„', text: '<li>ëŒ€ì‘í•˜ê¸° ì „ì— ê³µê²© í”Œë ˆì´ì–´ì˜ EC ì¹´ë“œì—ì„œ ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë³´ë„ˆìŠ¤ë¥¼ ì ìš©í•©ë‹ˆë‹¤.</li>' },
                { id: '6ë‹¨ê³„', text: '<li>íŠ¹ìˆ˜ ëŒ€ì‘ì´ ê°€ëŠ¥í•œ ê²½ìš°, ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ì„œ íŠ¹ìˆ˜ ëŒ€ì‘ìœ¼ë¡œ ì¶”ê°€ ì „íˆ¬ í—¥ìŠ¤ë¥¼ ìƒì„±ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤[7.27].</li> <li>ê·¸ ì´í›„ì— íŠ¹ìˆ˜ ëŒ€ì‘ìœ¼ë¡œ ì¸í•´ ì„ ì–¸ë˜ê±°ë‚˜ ìƒì„±ëœ ì „íˆ¬ í—¥ìŠ¤ê°€ ì—†ë‹¤ë©´, ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” í•´ë‹¹í•˜ëŠ” ê³µê²© ëŒ€ì‘ ì¹´ë“œë¥¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°,</li> <li>13ë‹¨ê³„ì¸ ì „íˆ¬ í›„ ì´ë™ ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</li>' },
                { id: '7ë‹¨ê³„', text: '<li>ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ì ì ˆí•œ ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ì²©ë³´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ì„œ ê³µê²©í•˜ëŠ” ì¸¡ì˜ ì²©ë³´ ì¡°ê±´ ë³€ê²½ì„ ì‹œë„í•©ë‹ˆë‹¤[7.25].</li> <li>ì´ ë‹¨ê³„ê°€ ëë‚¬ì„ ë•Œ ê³µê²©ìì˜ ì²©ë³´ ì¡°ê±´ì´ ê¸°ìŠµ ê³µê²©*Surprise Attack*ì´ë©´ 9ë‹¨ê³„ë¡œ ê±´ë„ˆëœë‹ˆë‹¤.</li>' },
                { id: '8ë‹¨ê³„', text: '<li>ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ê³µê²© í”Œë ˆì´ì–´ê°€ ì„ ì–¸í–ˆê±°ë‚˜ íŠ¹ìˆ˜ ëŒ€ì‘ìœ¼ë¡œ ìƒì„±ëœ ì „íˆ¬ í—¥ìŠ¤ì— ì°¸ì—¬í•  ìœ ë‹›ì„ í™œì„±í™”í•˜ê³  ì´ë™í•©ë‹ˆë‹¤[7.26].' },
                { id: '9ë‹¨ê³„', text: '<li>ëŒ€ì‘ í”Œë ˆì´ì–´ëŠ” ëª¨ë“  ê³µê²© ëŒ€ì‘ ì¹´ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>' },
                { id: '10ë‹¨ê³„', text: '<li>ëŒ€ì‘ í›„ ì ìš©ë˜ëŠ” ëª¨ë“  ê³µì„¸ ë³´ë„ˆìŠ¤ë¥¼ ì ìš©í•©ë‹ˆë‹¤.</li> <li>ì „íˆ¬ ì „ì— ì ìš©ë˜ëŠ” ëª¨ë“  ê³µê²© ëŒ€ì‘ ì¹´ë“œë¥¼ ì ìš©í•©ë‹ˆë‹¤.</li>' },
                { id: '11ë‹¨ê³„', text: '<li>í”Œë ˆì´ì–´ë“¤ì´ ëª¨ë“  ì „íˆ¬ë¥¼ í•´ê²°í•©ë‹ˆë‹¤[7.28].</li>' },
                { id: '12ë‹¨ê³„', text: '<li>ì „íˆ¬ í›„ ì ìš©ë˜ëŠ” ëª¨ë“  ê³µê²© ëŒ€ì‘ ì¹´ë“œë¥¼ ì ìš©í•©ë‹ˆë‹¤.</li>' },
                { id: '13ë‹¨ê³„', text: '<li>í”Œë ˆì´ì–´ëŠ” ì „íˆ¬ í›„ ì´ë™ì„ ì‹¤ì‹œí•©ë‹ˆë‹¤[9.6].</li> <li>ëŒ€ì‘ í”Œë ˆì´ì–´ê°€ ë¨¼ì € ì›€ì§ì´ê³  ê·¸ë‹¤ìŒì— ê³µê²© í”Œë ˆì´ì–´ê°€ ì›€ì§ì…ë‹ˆë‹¤.</li>' },
                { id: '14ë‹¨ê³„', text: '<li>í•„ìš”í•œ ëª¨ë“  ê¸´ê¸‰ í•´ìƒ ì´ë™[8.22]ê³¼ ê¸´ê¸‰ ê³µì¤‘ ì´ë™[8.32]ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li>' },
                { id: 'End', text: 'ê³µì„¸ ì ˆì°¨ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.' }
            ];

            let currentStep = 'start';
            let pathHistory = [];

            function showStep(stepId) {
                const stepSection = document.getElementById('stepSection');
                const stepNumber = document.getElementById('stepNumber');
                const stepTitle = document.getElementById('stepTitle');
                const conditionBox = document.getElementById('conditionBox');
                const buttonGroup = document.getElementById('buttonGroup');
                const progressFill = document.getElementById('progressFill');
                const pathHistoryDiv = document.getElementById('pathHistory');
                const pathStepsDiv = document.getElementById('pathSteps');

                if (!stepSection || !stepNumber || !stepTitle || !conditionBox || !buttonGroup || !progressFill || !pathHistoryDiv || !pathStepsDiv) {
                    console.error('Show step elements are missing:', { stepSection, stepNumber, stepTitle, conditionBox, buttonGroup, progressFill, pathHistoryDiv, pathStepsDiv });
                    const missingElements = [];
                    if (!stepSection) missingElements.push('stepSection');
                    if (!stepNumber) missingElements.push('stepNumber');
                    if (!stepTitle) missingElements.push('stepTitle');
                    if (!conditionBox) missingElements.push('conditionBox');
                    if (!buttonGroup) missingElements.push('buttonGroup');
                    if (!progressFill) missingElements.push('progressFill');
                    if (!pathHistoryDiv) missingElements.push('pathHistoryDiv');
                    if (!pathStepsDiv) missingElements.push('pathStepsDiv');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                stepSection.classList.remove('hidden');

                // ì£¼ì„ ì¶”ì¶œ
                const annotationRegex = /\[\d+\.\d+\]/g;
                const annotations = new Set();
                let textWithAnnotations = '';

                if (stepId === 'start') {
                    stepNumber.textContent = '';
                    stepTitle.textContent = 'ì‹œì‘';
                    textWithAnnotations = 'ê³µì„¸ ì ˆì°¨ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';
                } else {
                    const index = steps.findIndex(s => s.id === stepId);
                    if (index === -1) return;
                    textWithAnnotations = steps[index].text;
                    if (textWithAnnotations.match(annotationRegex)) {
                        textWithAnnotations.match(annotationRegex).forEach(annotation => annotations.add(annotation));
                    }
                    stepNumber.textContent = index + 1;
                    stepTitle.textContent = steps[index].id;
                }

                conditionBox.innerHTML = `
                    ${textWithAnnotations}
                    ${annotations.size > 0 ? `
                        <h4 style="margin-top: 20px; color: #ffffff;">ì°¸ê³  ìë£Œ:</h4>
                        <ul class="strategy-list">
                            ${Array.from(annotations).sort().map(annotation => `
                                <li class="impl-note">${notes[annotation] || ''}</li>
                            `).join('')}
                        </ul>
                    ` : ''}
                `;
                buttonGroup.innerHTML = `
                    ${stepId === 'start' ? '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>' : ''}
                    ${stepId !== 'start' && stepId !== 'End' ? '<button class="btn btn-primary" onclick="nextStep()">ê³„ì†</button>' : ''}
                    ${stepId === 'End' ? '<button class="btn btn-secondary" onclick="resetFlow()">ë‹¤ì‹œ ì‹œì‘</button>' : ''}
                    ${pathHistory.length > 0 ? '<button class="btn btn-back" onclick="goBack()">ì´ì „</button>' : ''}
                `;

                const progress = stepId === 'start' ? 0 : ((steps.findIndex(s => s.id === stepId) + 1) / steps.length) * 100;
                progressFill.style.width = progress + '%';

                if (stepId !== 'start') {
                    pathHistory.push({ step: steps.find(s => s.id === stepId).id, stepNum: steps.findIndex(s => s.id === stepId) + 1 });
                    updatePathHistory();
                }
            }

            function startFlow() {
                currentStep = '1ë‹¨ê³„';
                showStep(currentStep);
            }

            function nextStep() {
                const currentIndex = steps.findIndex(s => s.id === currentStep);
                if (currentIndex < steps.length - 1) {
                    currentStep = steps[currentIndex + 1].id;
                    showStep(currentStep);
                }
            }

            function updatePathHistory() {
                const pathHistoryDiv = document.getElementById('pathHistory');
                const pathStepsDiv = document.getElementById('pathSteps');
                if (!pathHistoryDiv || !pathStepsDiv) {
                    console.error('Path history elements are missing:', { pathHistoryDiv, pathStepsDiv });
                    const missingElements = [];
                    if (!pathHistoryDiv) missingElements.push('pathHistoryDiv');
                    if (!pathStepsDiv) missingElements.push('pathStepsDiv');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                if (pathHistory.length === 0) {
                    pathHistoryDiv.classList.add('hidden');
                    return;
                }

                pathStepsDiv.innerHTML = '';
                pathHistory.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = 'path-step';
                    stepDiv.innerHTML = `
                        <div class="step-icon">${step.stepNum}</div>
                        <div><strong>${step.step}:</strong> ${steps.find(s => s.id === step.step).text}</div>
                    `;
                    pathStepsDiv.appendChild(stepDiv);
                });

                pathHistoryDiv.classList.remove('hidden');
            }

            function resetFlow() {
                const stepSection = document.getElementById('stepSection');
                const stepNumber = document.getElementById('stepNumber');
                const stepTitle = document.getElementById('stepTitle');
                const conditionBox = document.getElementById('conditionBox');
                const buttonGroup = document.getElementById('buttonGroup');
                const progressFill = document.getElementById('progressFill');
                const pathHistoryDiv = document.getElementById('pathHistory');

                if (!stepSection || !stepNumber || !stepTitle || !conditionBox || !buttonGroup || !progressFill || !pathHistoryDiv) {
                    console.error('Reset flow elements are missing:', { stepSection, stepNumber, stepTitle, conditionBox, buttonGroup, progressFill, pathHistoryDiv });
                    const missingElements = [];
                    if (!stepSection) missingElements.push('stepSection');
                    if (!stepNumber) missingElements.push('stepNumber');
                    if (!stepTitle) missingElements.push('stepTitle');
                    if (!conditionBox) missingElements.push('conditionBox');
                    if (!buttonGroup) missingElements.push('buttonGroup');
                    if (!progressFill) missingElements.push('progressFill');
                    if (!pathHistoryDiv) missingElements.push('pathHistoryDiv');
                    console.error('Missing element IDs:', missingElements);
                    alert('í˜ì´ì§€ì— í•„ìš”í•œ ìš”ì†Œê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. HTMLì„ í™•ì¸í•´ ì£¼ì„¸ìš”. ëˆ„ë½ëœ ID: ' + missingElements.join(', '));
                    return;
                }

                currentStep = 'start';
                pathHistory = [];
                stepSection.classList.remove('hidden');
                stepNumber.textContent = '';
                stepTitle.textContent = 'ì‹œì‘';
                conditionBox.innerHTML = 'ê³µì„¸ ì ˆì°¨ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';
                buttonGroup.innerHTML = '<button class="btn btn-primary" onclick="startFlow()">ì‹œì‘í•˜ê¸°</button>';
                progressFill.style.width = '0%';
                pathHistoryDiv.classList.add('hidden');
            }

            function goBack() {
                if (pathHistory.length <= 1) return;

                pathHistory.pop();
                currentStep = pathHistory[pathHistory.length - 1].step;
                showStep(currentStep);
            }

            document.addEventListener('DOMContentLoaded', () => {
                window.onload = resetFlow;
            });
        </script>
    </body>
    </html>
    
  </template>


  <script>
    // í…œí”Œë¦¿ ë‚´ìš©ì„ ê° iframeì˜ srcdocìœ¼ë¡œ ì£¼ì… (í•œ íŒŒì¼ ë‚´ì— ëª¨ë‘ í¬í•¨)
    const map = {
      early: { frame: 'frame-early', tmpl: 'tmpl-early' },
      mid:   { frame: 'frame-mid',   tmpl: 'tmpl-mid' },
      late:  { frame: 'frame-late',  tmpl: 'tmpl-late' },
      card:  { frame: 'frame-card',  tmpl: 'tmpl-card' },
      task:  { frame: 'frame-task',  tmpl: 'tmpl-task' },
      resp:  { frame: 'frame-resp',  tmpl: 'tmpl-resp' },
      pbm:   { frame: 'frame-pbm',   tmpl: 'tmpl-pbm' },
      offensive:   { frame: 'frame-offensive',   tmpl: 'tmpl-offensive' },
    };

    // ìµœì´ˆ 1íšŒ: ëª¨ë“  í˜ì´ì§€ë¥¼ ë¯¸ë¦¬ ë¡œë“œ(ìƒíƒœ ìœ ì§€ ëª©ì ). í•„ìš” ì—†ìœ¼ë©´ ì²« íƒ­ë§Œ ë¡œë“œí•´ë„ ë¨.
    Object.keys(map).forEach(key => {
      const f = document.getElementById(map[key].frame);
      const t = document.getElementById(map[key].tmpl);
      if (f && t) f.srcdoc = t.innerHTML;
    });

    // íƒ­ ì „í™˜
    const tabs = document.getElementById('tabs');
    tabs.addEventListener('click', (e) => {
      if (e.target.tagName !== 'BUTTON') return;
      const target = e.target.getAttribute('data-target');
      if (!target || !map[target]) return;

      // ë²„íŠ¼ active
      tabs.querySelectorAll('button').forEach(b => b.classList.remove('active'));
      e.target.classList.add('active');

      // í”„ë ˆì„ ì „í™˜
      document.querySelectorAll('.frame').forEach(f => f.classList.remove('active'));
      document.getElementById(map[target].frame).classList.add('active');
    });

    const calcBtn = document.getElementById('calculator-btn');
    const calcModal = document.getElementById('calculator-modal');
    const calcDisplay = document.getElementById('calc-display');
    const calcHistory = document.getElementById('calc-history');
    const historyToggle = document.getElementById('history-toggle');
    const alliedText = document.getElementById('allied-text');
    const japaneseText = document.getElementById('japanese-text');

    let currentInput = '';
    let history = [];
    let expression = '';

    calcBtn.addEventListener('click', () => {
        calcModal.style.display = calcModal.style.display === 'block' ? 'none' : 'block';
    });

    // í‚¤íŒ¨ë“œ ì…ë ¥ ì²˜ë¦¬
    document.addEventListener('keydown', (e) => {
        if (calcModal.style.display === 'block') {
            if (/[0-9]/.test(e.key)) {
                currentInput += e.key;
                calcDisplay.value = expression + currentInput;
            } else if (e.key === '+') {
                appendToDisplay('+');
            } else if (e.key === 'Enter') {
                calculate();
            } else if (e.key === 'Escape') {
                clearDisplay();
            } else if (e.key === 'Backspace') {
                backspace();
            }
        }
    });

    function appendToDisplay(value) {
        if (value === '+') {
            if (currentInput) {
                expression += currentInput + ' + ';
                currentInput = '';
                calcDisplay.value = expression;
            }
        } else {
            currentInput += value;
            calcDisplay.value = expression + currentInput;
        }
    }

    function multiply(factor) {
        if (currentInput) {
            let result = parseFloat(currentInput) * factor;
            // *0.25, *0.5, *1, *1.5, *2 ëª¨ë‘ ì†Œìˆ˜ì  ì˜¬ë¦¼ ì²˜ë¦¬
            if ([0.25, 0.5, 1, 1.5, 2].includes(factor)) {
                result = Math.ceil(result);
            }
            addToHistory(`${currentInput} * ${factor} = ${result}`);
            currentInput = result.toString();
            calcDisplay.value = expression + currentInput;
        }
    }

    function calculate() {
        if (currentInput) {
            expression += currentInput;
            try {
                const result = eval(expression);
                addToHistory(`${expression} = ${result}`);
                currentInput = result.toString();
                expression = '';
                calcDisplay.value = currentInput; // ê²°ê³¼ê°’ ìœ ì§€
            } catch (e) {
                calcDisplay.value = 'Error';
                currentInput = '';
                expression = '';
            }
        } else {
            calcDisplay.value = currentInput || '0'; // currentInput ìœ ì§€ ë˜ëŠ” ê¸°ë³¸ê°’
        }
    }

    function backspace() {
        if (currentInput) {
            currentInput = currentInput.slice(0, -1);
        } else if (expression) {
            expression = expression.trim().slice(0, -2).trim();
        }
        calcDisplay.value = expression + currentInput;
    }

    function clearDisplay() {
        currentInput = '';
        expression = '';
        calcDisplay.value = '';
    }

    function addToHistory(entry) {
        history.push(entry);
        if (history.length > 10) history.shift();
        calcHistory.innerHTML = history.map(h => `<li>${h}</li>`).join('');
    }

    // ì…ë ¥ì°½ ì§ì ‘ ì…ë ¥ ë¹„í™œì„±í™”
    calcDisplay.addEventListener('input', (e) => {
        e.preventDefault();
        calcDisplay.value = expression + currentInput;
    });

    // ì¶”ê°€: ì´ì „ ê¸°ë¡ í† ê¸€
    historyToggle.addEventListener('click', () => {
        if (calcHistory.style.display === 'none') {
            calcHistory.style.display = 'block';
            historyToggle.classList.add('open');
            historyToggle.textContent = 'â–²';
        } else {
            calcHistory.style.display = 'none';
            historyToggle.classList.remove('open');
            historyToggle.textContent = 'â–¼';
        }
    });

    // ì¶”ê°€: ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
    function dragStart(e) {
        e.dataTransfer.setData('text/plain', calcDisplay.value);
    }

    alliedText.addEventListener('dragover', (e) => e.preventDefault());
    alliedText.addEventListener('drop', (e) => {
        e.preventDefault();
        alliedText.textContent = e.dataTransfer.getData('text/plain');
    });

    japaneseText.addEventListener('dragover', (e) => e.preventDefault());
    japaneseText.addEventListener('drop', (e) => {
        e.preventDefault();
        japaneseText.textContent = e.dataTransfer.getData('text/plain');
    });

    // ì¶”ê°€: ë°•ìŠ¤ ì´ˆê¸°í™” í•¨ìˆ˜
    function clearBox(boxId) {
        document.getElementById(boxId).textContent = '';
    }


    const diceBtn = document.getElementById('dice-btn');
    const diceModal = document.getElementById('dice-modal');

    diceBtn.addEventListener('click', () => {
        diceModal.style.display = diceModal.style.display === 'block' ? 'none' : 'block';
    });

    function rollDice(diceId, resultId) {
        const diceButton = document.getElementById(diceId);
        const resultDisplay = document.getElementById(resultId);
        diceButton.textContent = '?'; // ì´ˆê¸° ë¬¼ìŒí‘œ
        diceButton.classList.add('spin');
        setTimeout(() => {
            const result = Math.floor(Math.random() * 10);
            diceButton.classList.remove('spin');
            diceButton.textContent = result; // ì• ë‹ˆë©”ì´ì…˜ í›„ ìˆ«ì í‘œì‹œ
            resultDisplay.textContent = result;
        }, 700);
    }


  </script>
</body>
</html>
