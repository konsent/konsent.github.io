<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Erasmus Bot - Axis of Determination</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f4f4;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #007bff;
            border-radius: 8px;
            color: white;
        }

        .header h1 {
            margin: 0;
            font-size: 2rem;
        }

        .header p {
            margin: 8px 0 0 0;
            font-size: 1rem;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 5px;
            height: 6px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: #007bff;
            height: 100%;
            border-radius: 5px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .step-section {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            background: #007bff;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            margin-right: 15px;
        }

        .step-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .condition-box {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-size: 1rem;
            line-height: 1.5;
            color: #495057;
        }

        .condition-box strong {
            color: #007bff;
            font-size: 1.1rem;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 30px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
            text-transform: uppercase;
            min-width: 100px;
        }

        .btn-yes {
            background: #28a745;
            color: white;
        }

        .btn-yes:hover {
            background: #218838;
        }

        .btn-no {
            background: #dc3545;
            color: white;
        }

        .btn-no:hover {
            background: #c82333;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-back {
            background: #6c757d;
            color: white;
        }

        .btn-back:hover {
            background: #5a6268;
        }

        .path-history {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid #28a745;
        }

        .path-step {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .path-step .step-icon {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.8rem;
        }

        .path-step.yes .step-icon {
            background: #28a745;
            color: white;
        }

        .path-step.no .step-icon {
            background: #dc3545;
            color: white;
        }

        .dice-section {
            background: #fff3cd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
        }

        .dice-result {
            font-size: 3rem;
            font-weight: bold;
            color: #2d3436;
            margin: 15px 0;
        }

        .result-section {
            background: #28a745;
            color: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-top: 15px;
        }

        .result-section h2 {
            margin: 0 0 15px 0;
            font-size: 2rem;
        }

        .result-section p {
            font-size: 1.2rem;
            margin: 10px 0;
        }

        .strategy-details {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
        }

        .strategy-list {
            text-align: left;
            margin: 15px 0;
            list-style: none;
            padding: 0;
        }

        .strategy-list li {
            margin: 8px 0;
            padding: 8px 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            border-left: 3px solid rgba(255, 255, 255, 0.5);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 180px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Japanese Erasmus Bot</h1>
            <p>Opening Phase - Axis of Determination</p>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div id="pathHistory" class="path-history hidden">
            <h4 style="margin-top: 0; color: #495057;">진행 경로</h4>
            <div id="pathSteps"></div>
        </div>

        <div id="stepSection" class="step-section">
            <div class="step-header">
                <div class="step-number" id="stepNumber">1</div>
                <h2 class="step-title" id="stepTitle">시작</h2>
            </div>
            
            <div class="condition-box" id="conditionBox">
                <strong>Step 1:</strong> 첫 번째 조건을 확인해주세요.
            </div>
            
            <div class="button-group" id="buttonGroup">
                <button class="btn btn-primary" onclick="startFlow()">시작하기</button>
            </div>
        </div>

        <div id="diceSection" class="dice-section hidden">
            <h3 style="margin: 0 0 20px 0; color: #2d3436;">주사위 굴리기 (1d10)</h3>
            <div class="dice-result" id="diceResult">?</div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="rollDice()">주사위 굴리기</button>
            </div>
        </div>

        <div id="resultSection" class="result-section hidden">
            <h2 id="strategyTitle">최종 전략 결정</h2>
            <p id="strategyName"></p>
            <div class="strategy-details" id="strategyDetails"></div>
            <div class="button-group" style="margin-top: 30px;">
                <button class="btn btn-secondary" onclick="resetFlow()">다시 시작</button>
            </div>
        </div>
    </div>

    <script>
        // 전략 정보 데이터
        const strategies = {
            'Aggressive Air Superiority': {
                name: '공격적 제공권 전략',
                details: [
                    '1. Neutralize Allied HQs',
                    '2. DEI Surrender',
                    '3. Malaya Surrender'
                ]
            },
            'Conservative Air Superiority': {
                name: '보수적 제공권 전략',
                details: [
                    '1. Neutralize Allied HQs',
                    '2. DEI Neutralization'
                ]
            },
            'Aggressive Southern Resource': {
                name: '공격적 남방 자원 전략',
                details: [
                    '1. DEI Surrender',
                    '2. Malaya Surrender',
                    '3. Philippines Surrender',
                    '4. Use Roll 1d10!'
                ]
            },
            'Conservative Southern Resource': {
                name: '보수적 남방 자원 전략',
                details: [
                    '1. DEI Neutralization',
                    '2. Malaya Surrender',
                    '3. Philippine Surrender',
                    '4. Use Roll 1d10!'
                ]
            },
            'Defense Perimeter Strategy': {
                name: '방어선 전략',
                details: [
                    '1. Australian Mandates',
                    '2. New Guinea'
                ]
            },
            'CBI Strategy': {
                name: 'CBI 전략',
                details: [
                    '1. Burma Surrender',
                    '2. China Surrender'
                ]
            },
            'Central Pacific Strategy': {
                name: '중부 태평양 전략',
                details: [
                    '1. NW New Guinea',
                    '2. Attu/Kiska',
                    '3. Defend Marshalls',
                    '4. Midway'
                ]
            },
            'Event Strategy': {
                name: '이벤트 전략',
                details: [
                    '1. WiE if Allied WiE value positive, else FOQ',
                    '2. ISR end if Japan under ISR, else FOQ',
                    '3. ISR create if Allies under strategic agreement, else FOQ',
                    '4. Tokyo Rose to FOQ',
                    '5. Replacements to FOQ',
                    '6. Weather card to FOQ',
                    '7. Tojo, play as TOC unless play as event puts US PW at zero',
                    '8. Others: If no FOQ put card into the FOQ'
                ]
            }
        };

        // 조건 정의
        const conditions = {
            'A': 'Allied HQ\'s in Philippines, DEI and Malaya OOS?',
            'B': 'Are the DEI surrender objectives occupied?',
            'C': 'Does Japan have 3 or more cards?',
            'D': 'Does Japan control less than 13 resource hexes?',
            'E': 'Does Japan control 13 or more resource hexes?',
            'F': 'Is the logistics evaluation value 20 or more?',
            'G': 'Is it game turn 3 or later?',
            'H': 'Is the logistics evaluation value 19 or less?',
            'I': 'Does Japan have AZOI over all DEI ports?',
            'J': 'Does Japan control Rabaul and Guadalcanal?',
            'K': 'Does Japan control or have AZOI over 4 out of 6 New Guinea ports?',
            'L': 'Is any one of Malaya, Philippines or DEI one hex short of being conquered?',
            'M': 'Has the Defense Perimeter Strategy objective #1 been achieved?'
        };

        let currentStep = 'start';
        let pathHistory = [];
        let stepCount = 0;
        let evaluatedConditions = {};

        function startFlow() {
            currentStep = 'A';
            stepCount = 1;
            pathHistory = [];
            evaluatedConditions = {};
            showStep('A');
        }

        function showStep(stepId) {
            const stepNumber = document.getElementById('stepNumber');
            const stepTitle = document.getElementById('stepTitle');
            const conditionBox = document.getElementById('conditionBox');
            const buttonGroup = document.getElementById('buttonGroup');

            stepNumber.textContent = stepCount;
            
            if (stepId === 'DICE') {
                document.getElementById('stepSection').classList.add('hidden');
                document.getElementById('diceSection').classList.remove('hidden');
                return;
            }

            // 복합 조건들을 처리
            if (stepId.includes('_CHECK') || stepId.includes('_FOR_') || stepId.includes('_FINAL')) {
                showComplexConditionStep(stepId);
                return;
            }

            // 기본 조건들 처리
            if (conditions[stepId]) {
                stepTitle.textContent = `조건 ${stepId} 확인`;
                conditionBox.innerHTML = `<strong>Step ${stepCount}:</strong> ${conditions[stepId]}`;
                
                buttonGroup.innerHTML = `
                    <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                    <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                    ${pathHistory.length > 0 ? `<button class="btn btn-back" onclick="goBack()">이전으로</button>` : ''}
                `;
            }

            updateProgress();
            updatePathHistory();
        }
        

        function selectChoice(conditionId, choice) {
            evaluatedConditions[conditionId] = choice;
            pathHistory.push({ step: conditionId, choice: choice, stepNum: stepCount });
            stepCount++;

            const nextStep = getNextStep(conditionId, choice);
            
            if (nextStep.startsWith('STRATEGY_')) {
                const strategy = nextStep.replace('STRATEGY_', '');
                showResult(strategy);
            } else if (nextStep === 'DICE') {
                currentStep = 'DICE';
                showStep('DICE');
            } else {
                currentStep = nextStep;
                showStep(nextStep);
            }
        }

        function getNextStep(conditionId, choice) {
            // 플로우차트 로직 구현
            switch(conditionId) {
                case 'A':
                    return choice ? 'B' : 'CD_CHECK';
                    
                case 'B':
                    if (choice) {
                        // C+ (E or H+I) 확인 필요
                        return 'C_FOR_E_OR_HI';
                    } else {
                        return 'G';
                    }
                    
                case 'C_FOR_E_OR_HI':
                    if (choice) {
                        return 'E_OR_HI_CHECK';
                    } else {
                        return 'CJE_BIK_CHECK';
                    }
                    
                case 'E_OR_HI_CHECK':
                    // E 또는 (H AND I) 체크
                    if (choice) {
                        return 'STRATEGY_Defense Perimeter Strategy';
                    } else {
                        return 'CJE_BIK_CHECK';
                    }
                    
                case 'CJE_BIK_CHECK':
                    // C+J+E+ (B or I or K) 체크
                    if (choice) {
                        return 'DICE';
                    } else {
                        return 'CL_CHECK';
                    }
                    
                case 'CL_CHECK':
                    // C+L 체크
                    if (choice) {
                        return 'STRATEGY_Aggressive Southern Resource';
                    } else {
                        return 'M';
                    }
                    
                case 'G':
                    return choice ? 'STRATEGY_Aggressive Southern Resource' : 'CD_CHECK';
                    
                case 'CD_CHECK':
                    // C+D 체크
                    if (choice) {
                        return 'F_FOR_CD';
                    } else {
                        return 'ACD_CHECK';
                    }
                    
                case 'F_FOR_CD':
                    // 6번 F (C+D에서 오는 F)
                    return choice ? 'STRATEGY_Aggressive Air Superiority' : 'STRATEGY_Conservative Air Superiority';
                    
                case 'ACD_CHECK':
                    // A+C+D 체크
                    if (choice) {
                        return 'F_FOR_ACD';
                    } else {
                        return 'C_FOR_E_OR_HI_FINAL';
                    }
                    
                case 'F_FOR_ACD':
                    // 10번 F (A+C+D에서 오는 F)
                    return choice ? 'STRATEGY_Aggressive Southern Resource' : 'STRATEGY_Conservative Southern Resource';
                    
                case 'C_FOR_E_OR_HI_FINAL':
                    if (choice) {
                        return 'E_OR_HI_CHECK_FINAL';
                    } else {
                        return 'STRATEGY_Conservative Southern Resource';
                    }
                    
                case 'E_OR_HI_CHECK_FINAL':
                    return choice ? 'STRATEGY_Defense Perimeter Strategy' : 'STRATEGY_Conservative Southern Resource';
                    
                case 'M':
                    return choice ? 'STRATEGY_Defense Perimeter Strategy' : 'STRATEGY_Aggressive Southern Resource';
                    
                default:
                    return 'STRATEGY_Defense Perimeter Strategy';
            }
        }

        function goBack() {
            if (pathHistory.length === 0) return;
            const lastStep = pathHistory.pop();
            stepCount--;
            delete evaluatedConditions[lastStep.step];
            if (complexConditionState && complexConditionState.results[lastStep.step] !== undefined) {
                delete complexConditionState.results[lastStep.step];
                const prevCondition = complexConditionState.getPreviousCondition(lastStep.step);
                if (prevCondition) {
                    currentStep = prevCondition;
                    showStep(prevCondition);
                } else {
                    complexConditionState = null;
                    currentStep = pathHistory.length > 0 ? pathHistory[pathHistory.length - 1].step : 'A';
                    showStep(currentStep);
                }
            } else {
                currentStep = lastStep.step;
                showStep(currentStep);
            }
            updateProgress();
            updatePathHistory();
        }

        function rollDice() {
            const diceValue = Math.floor(Math.random() * 10); // 0-9
            document.getElementById('diceResult').textContent = diceValue;
            
            let strategy;
            if (diceValue >= 0 && diceValue <= 2) {
                strategy = 'Event Strategy';
            } else if (diceValue >= 3 && diceValue <= 6) {
                strategy = 'CBI Strategy';
            } else if (diceValue >= 7 && diceValue <= 9) {
                strategy = 'Central Pacific Strategy';
            }
            
            pathHistory.push({ 
                step: 'DICE', 
                choice: diceValue, 
                stepNum: stepCount,
                isResult: true,
                result: strategy
            });
            
            setTimeout(() => showResult(strategy), 1000);
        }

        function showResult(strategyKey) {
            const strategy = strategies[strategyKey];
            
            document.getElementById('stepSection').classList.add('hidden');
            document.getElementById('diceSection').classList.add('hidden');
            
            document.getElementById('strategyName').textContent = strategy.name;
            
            const detailsDiv = document.getElementById('strategyDetails');
            detailsDiv.innerHTML = `
                <h4 style="margin-top: 0; color: #fff;">전략 세부사항:</h4>
                <ul class="strategy-list">
                    ${strategy.details.map(detail => `<li>${detail}</li>`).join('')}
                </ul>
            `;
            
            document.getElementById('resultSection').classList.remove('hidden');
            updateProgress(100);
            updatePathHistory();
        }

        function updateProgress() {
            const totalSteps = 15; // 대략적인 최대 단계 수
            const progress = Math.min((stepCount / totalSteps) * 100, 100);
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updatePathHistory() {
            if (pathHistory.length === 0) return;
            
            const pathHistoryDiv = document.getElementById('pathHistory');
            const pathStepsDiv = document.getElementById('pathSteps');
            
            pathStepsDiv.innerHTML = '';
            
            pathHistory.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = `path-step ${step.choice ? 'yes' : 'no'}`;
                
                if (step.step === 'DICE') {
                    stepDiv.innerHTML = `
                        <div class="step-icon">${step.choice}</div>
                        <div>
                            <strong>주사위 굴리기:</strong> ${step.choice} 
                            ${step.result ? `→ ${strategies[step.result].name}` : ''}
                        </div>
                    `;
                } else {
                    stepDiv.innerHTML = `
                        <div class="step-icon">${step.choice ? 'Y' : 'N'}</div>
                        <div>
                            <strong>Step ${step.stepNum} (${step.step}):</strong> 
                            ${conditions[step.step]} → ${step.choice ? 'YES' : 'NO'}
                        </div>
                    `;
                }
                
                pathStepsDiv.appendChild(stepDiv);
            });
            
            pathHistoryDiv.classList.remove('hidden');
        }

        function resetFlow() {
            currentStep = 'start';
            stepCount = 0;
            pathHistory = [];
            evaluatedConditions = {};
            
            document.getElementById('stepSection').classList.remove('hidden');
            document.getElementById('diceSection').classList.add('hidden');
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('pathHistory').classList.add('hidden');
            
            document.getElementById('stepNumber').textContent = '1';
            document.getElementById('stepTitle').textContent = '시작';
            document.getElementById('conditionBox').innerHTML = '<strong>Step 1:</strong> 첫 번째 조건을 확인해주세요.';
            document.getElementById('buttonGroup').innerHTML = '<button class="btn btn-primary" onclick="startFlow()">시작하기</button>';
            document.getElementById('progressFill').style.width = '0%';
        }

        function showComplexConditionStep(stepId) {
            const stepNumber = document.getElementById('stepNumber');
            const stepTitle = document.getElementById('stepTitle');
            const conditionBox = document.getElementById('conditionBox');
            const buttonGroup = document.getElementById('buttonGroup');

            stepNumber.textContent = stepCount;
            
            let conditionText = '';
            let displayTitle = '';
            
            switch(stepId) {
                case 'CD_CHECK':
                    displayTitle = '복합 조건 C+D';
                    conditionText = 'Does Japan have 3 or more cards AND control less than 13 resource hexes?';
                    break;
                case 'CJE_BIK_CHECK':
                    displayTitle = '복합 조건 C+J+E+(B or I or K)';
                    conditionText = 'Does Japan have 3+ cards AND control Rabaul/Guadalcanal AND control 13+ resource hexes AND (DEI surrender objectives occupied OR have AZOI over all DEI ports OR control/AZOI over 4+ New Guinea ports)?';
                    break;
                case 'ACD_CHECK':
                    displayTitle = '복합 조건 A+C+D';
                    conditionText = 'Are Allied HQs OOS AND Japan has 3+ cards AND controls less than 13 resource hexes?';
                    break;
                case 'E_OR_HI_CHECK':
                case 'E_OR_HI_CHECK_FINAL':
                    displayTitle = '복합 조건 E or (H+I)';
                    conditionText = 'Does Japan control 13+ resource hexes OR (logistics value ≤19 AND have AZOI over all DEI ports)?';
                    break;
                case 'CL_CHECK':
                    displayTitle = '복합 조건 C+L';
                    conditionText = 'Does Japan have 3+ cards AND any of Malaya/Philippines/DEI is one hex short of conquest?';
                    break;
                case 'C_FOR_E_OR_HI':
                    displayTitle = '조건 C';
                    conditionText = 'Does Japan have 3 or more cards?';
                    break;
                case 'C_FOR_E_OR_HI_FINAL':
                    displayTitle = '조건 C (최종 확인)';
                    conditionText = 'Does Japan have 3 or more cards?';
                    break;
                case 'F_FOR_CD':
                    displayTitle = '조건 F (제공권 결정)';
                    conditionText = 'Is the logistics evaluation value 20 or more?';
                    break;
                case 'F_FOR_ACD':
                    displayTitle = '조건 F (남방자원 결정)';
                    conditionText = 'Is the logistics evaluation value 20 or more?';
                    break;
                default:
                    displayTitle = '조건 확인';
                    conditionText = 'Unknown condition';
            }

            stepTitle.textContent = displayTitle;
            conditionBox.innerHTML = `<strong>Step ${stepCount}:</strong> ${conditionText}`;
            
            buttonGroup.innerHTML = `
                <button class="btn btn-yes" onclick="selectChoice('${stepId}', true)">YES</button>
                <button class="btn btn-no" onclick="selectChoice('${stepId}', false)">NO</button>
                ${pathHistory.length > 0 ? `<button class="btn btn-back" onclick="goBack()">이전으로</button>` : ''}
            `;

            updateProgress();
            updatePathHistory();
        }

        // 페이지 로드 시 초기화
        window.onload = function() {
            resetFlow();
        };
    </script>
</body>
</html>